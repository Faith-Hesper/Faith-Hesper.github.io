import{r as e,A as l,y as a,o as s,c as t,w as u,b as d,I as c,H as i,i as n,l as o,C as r,$ as _,a as p,g as f,d as m,t as v,e as h,h as w,F as b,u as g,m as y,s as x,q as k,J as V,K as C,v as j,j as N,k as T,L as P,G as A,x as D,M as U}from"./index-BrufAkfy.js";import{_ as q,o as I,r as Y}from"./uni-app.es.BDelRtJL.js";import{_ as M,a as S,U as O}from"./uqrcode.bREo767u.js";import{_ as F}from"./modal_closer.DtdM0G4E.js";const $=q({__name:"dtPicker",props:{timestamp:{type:Number,default:0},emptyText:{type:String,default:""},placeholder:{type:String,default:""}},emits:["dtPickerChanged"],setup(r,{emit:_}){const p=r,f=_,m=(new Date).getTime(),v=e([]);let h=null,w="",b=null,g=null;const y=e([0,0,0]),x=e();l((()=>{const e=[""],l=[p.emptyText];for(let a=0;a<20;a++){e.push(C(m+864e5*a,"YYYY-MM-dd"));let s=C(m+864e5*a,"M月d日");0==a&&(s+=" （今天）"),1==a&&(s+=" （明天）"),2==a&&(s+=" （后天）"),l.push(s);const t=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],u=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],d=[];d[0]=l,d[1]=t,d[2]=u,v.value=d,h=e,w=l,b=t,g=u}}));const k=()=>{x.value=j();var e=h[y.value[0]],l=b[y.value[1]],a=g[y.value[2]],s="";e&&(s=e+" "+l+":"+a);var t=0;s&&(t=new Date(s.replace(/-/g,"/")).getTime()),f("dtPickerChanged",{detail:{value:t}})},V=e=>{var l=y.value;l[e.detail.column]=e.detail.value,y.value=l},C=(e,l)=>{const a=new Date;return a.setTime(e),a.VP_FORMAT(l)},j=()=>{var e=w[y.value[0]],l=b[y.value[1]],a=g[y.value[2]];return""==h[y.value[0]]?e:e+" "+l+":"+a};return console.log(p,"props"),a(p.timestamp,(e=>{(e=>{if(h){if(e>0)var l=h,a=b,s=g;e<m&&(e=m);for(var t=C(e,"YYYY-MM-dd"),u=C(e,"hh"),d=C(e,"mm"),c=o(y.value),i=0;i<l.length;i++)if(t==l[i]){c[0]=i;break}for(i=0;i<a.length;i++)if(u==a[i]){c[1]=i;break}for(i=0;i<s.length;i++)if(d==s[i]){c[2]=i;break}y.value=c,x.value=j()}})(e)}),{immediate:!0}),(e,l)=>{const a=c,o=i,_=n;return s(),t(_,null,{default:u((()=>[d(o,{mode:"multiSelector",onChange:k,onColumnchange:V,value:y.value,range:v.value},{default:u((()=>[d(a,{disabled:!0,"placeholder-style":"color:#bbbbbb",placeholder:r.placeholder,value:x.value},null,8,["placeholder","value"])])),_:1},8,["value","range"])])),_:1})}}},[["__scopeId","data-v-586c75ca"]]),z=q({__name:"index",setup(l){const a=f(),q=e(),z=e();I((e=>{console.log(e,"options"),W(e)}));const G=e({}),H=e([]),J=e(0),K=r({starttime:"",address:{userName:"",cityName:"",countyName:"",detailInfo:""},receiveAddress:"",tel:"",demand:""}),L=r({page_xy:"",page_fw:""}),R=r({name:""}),B=e(!1),E=r({phone:"",validCode:""}),Q=r({validText:"获取验证码",time:60}),W=e=>{a.globalData.utils.request({url:"/Service/order",data:{svid:e.svid},success:l=>{console.log(l),G.value=l.data.service,H.value=l.data.hospitals;const a=o(H.value);if(e.hid>0)for(let s=0;s<a.length;s++)if(a[s].id==e.hid){J.value=s,K.price=a[s].service_price;break}}})},X=()=>{},Z=e=>{const l=parseInt(e.detail.value);J.value=l,K.price=o(H.value)[l].service_price},ee=e=>{K.starttime=e.detail.value},le=()=>{y({url:"../clients/index?act=select"})};_("clientChange",(e=>{console.log(e),R.name=e.name,R.id=e.user_id,R.sex=e.sex,R.age=e.age,R.mobile=e.mobile}));const ae=()=>{B.value=!B.value},se=()=>{uni.chooseAddress({success:e=>{console.log(e),K.address.userName=e.userName,K.address.cityName=e.cityName,K.address.countyName=e.countyName,K.address.detailInfo=e.detailInfo},fail:e=>{console.log(e,"err")}})};let te;const ue=()=>{if(console.log(q.value),!B.value)return x({title:"请先阅读并同意用于协议和服务协议",icon:"none",duration:1e3});const e=o(K),l=o(G.value),a=o(H.value),s=o(R);if(e.service_code=l.code,e.service_id=l.id,e.service_name=l.name,e.service_stype=l.stype,l.stype<100){if(0==J.value)return x({title:"请选择医院",icon:"none",duration:1e3});e.hospital_id=a[J.value].id,e.hospital_name=a[J.value].name}if(!e.starttime)return x({title:"请选择时间",icon:"none",duration:1e3});if(10==l.stype||15==l.stype||20==l.stype){if(!s.id)return x({title:"请选择就诊人",icon:"none",duration:1e3});if(e.client={},e.client.age=s.age,e.client.mobile=s.mobile,e.client.name=s.name,e.client.sex=s.sex,15==l.stype&&!e.receiveAddress)return x({title:"请填写就诊人所在地址",icon:"none",duration:1e3})}return 30!=l.stype&&40!=l.stype||e.address.userName?e.tel?(console.log(e,"orderData"),te=e,void(k("token")?oe(te):q.value.open("center"))):x({title:"请填写您的联系方式",icon:"none",duration:1e3}):x({title:"请选择收件信息",icon:"none",duration:1e3})},de=()=>{q.value.close()},ce=()=>{if(!E.phone||!E.validCode)return x({title:"请检查填写数据",icon:"none",duration:1e3});a.globalData.utils.request({url:"/user/authentication",method:"POST",data:{tel:E.phone,code:E.validCode},success:e=>{V("token",e.data.token),oe(te)},fail:e=>{x({title:e.msg,icon:"none",duration:1e3})}})};let ie=!1;const ne=()=>{if(!E.phone)return x({title:"请输入手机号",icon:"none",duration:1e3});if(ie)return;const e=setInterval((()=>{Q.time<=0?(Q.validText="获取验证码",Q.time=60,ie=!1,clearInterval(e)):(Q.time-=1,Q.validText=`剩余${Q.time}s`)}),1e3);ie=!0,a.globalData.utils.request({url:"/get/code",method:"POST",data:{tel:E.phone},success:e=>{x({title:"验证码发送成功，请尽快验证！",icon:"none",duration:1e3})},fail:e=>{x({title:e.msg,icon:"none",duration:1e3})}})},oe=e=>{a.globalData.utils.request({url:"/pay/createOrder",method:"POST",header:{token:k("token")},data:e,success:e=>{z.value.open("center");const l=new O;l.data=e.wx_code,l.size=150,l.make();var a=C("qrcode");l.canvasContext=a,l.drawCanvas()},fail:e=>{}})},re=()=>{j({url:"../order/index"})};return(e,l)=>{const a=N,o=n,r=T,_=c,f=i,y=Y(p("dtPicker"),$),x=P,k=A,V=D,C=Y(p("uni-popup"),M),j=U;return s(),t(o,null,{default:u((()=>[d(o,{class:"od-banner"},{default:u((()=>[d(a,{class:"od-banner-icon",src:S,mode:"widthFix"}),d(o,{class:"od-jd od-jd-0"},{default:u((()=>[d(o,{class:"od-jd-out"},{default:u((()=>[d(o,{class:"od-jd-in"})])),_:1}),d(o,{class:"vp-flex od-jd-text"},{default:u((()=>[d(o,{class:"vp-flex_1"},{default:u((()=>[d(r,{class:"od-jd-st-0"},{default:u((()=>[m("填写订单")])),_:1})])),_:1}),d(o,{class:"vp-flex_1"},{default:u((()=>[d(r,{class:"od-jd-st-10"},{default:u((()=>[m("在线支付")])),_:1})])),_:1}),d(o,{class:"vp-flex_1"},{default:u((()=>[d(r,{class:"od-jd-st-20"},{default:u((()=>[m("专人服务")])),_:1})])),_:1}),d(o,{class:"vp-flex_1"},{default:u((()=>[d(r,{class:"od-jd-st-30"},{default:u((()=>[m("服务完成")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(a,{class:"serv-icon",src:G.value.icon_image?G.value.icon_image_url:"../../static/resource/images/avatar.jpg"},null,8,["src"])])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(r,{class:"serv-name"},{default:u((()=>[m(v(G.value.name),1)])),_:1})])),_:1}),d(o,{class:"weui-cell__ft"},{default:u((()=>[d(o,{class:"f5 ic_info",onClick:X},{default:u((()=>[m("服务内容")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),10==G.value.stype||15==G.value.stype||20==G.value.stype?(s(),h(b,{key:0},[d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("就诊医院")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(f,{onChange:Z,value:J.value,range:H.value,"range-key":"name"},{default:u((()=>[d(_,{type:"text",disabled:!0,placeholder:"请选择要就诊的医院",value:H.value[J.value].name,"placeholder-class":"vp-placeholder"},null,8,["value"])])),_:1},8,["value","range"])])),_:1})])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("就诊时间")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(y,{onDtPickerChanged:ee,timestamp:K.starttime,placeholder:"请选择就诊时间"},null,8,["timestamp"])])),_:1})])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input",onClick:le},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("就诊人")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(_,{class:"weui-input","placeholder-class":"vp-placeholder",placeholder:"请选择就诊人",style:{"text-align":"right"},disabled:!0,value:R.name,type:"text"},null,8,["value"])])),_:1})])),_:1})])),_:1}),15==G.value.stype?(s(),t(o,{key:0,class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("接送地址")])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(_,{class:"weui-input",name:"receiveAddress",style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请填写就诊人所在地址",modelValue:K.receiveAddress,"onUpdate:modelValue":l[0]||(l[0]=e=>K.receiveAddress=e)},null,8,["modelValue"])])),_:1})])),_:1})):w("",!0),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("联系电话")])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(_,{class:"weui-input",type:"number",name:"tel",style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请填写您的联系电话",modelValue:K.tel,"onUpdate:modelValue":l[1]||(l[1]=e=>K.tel=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-tt"},{default:u((()=>[m("服务需求")])),_:1}),d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__bd"},{default:u((()=>[d(x,{name:"demand","auto-height":"",placeholder:"请简单描述您要就诊的科室..","placeholder-class":"vp-placeholder",style:{"min-height":"150rpx"},modelValue:K.demand,"onUpdate:modelValue":l[2]||(l[2]=e=>K.demand=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})],64)):w("",!0),30==G.value.stype||40==G.value.stype?(s(),h(b,{key:1},[d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("所在医院")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(f,{onChange:Z,value:J.value,range:H.value,"range-key":"name"},{default:u((()=>[d(_,{type:"text",disabled:!0,placeholder:"请选择就诊所在医院",value:H.value[J.value].name,"placeholder-class":"vp-placeholder"},null,8,["value"])])),_:1},8,["value","range"])])),_:1})])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("服务时间")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(y,{onDtPickerChanged:ee,timestamp:K.starttime,placeholder:"请选择期望服务时间"},null,8,["timestamp"])])),_:1})])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input",onClick:se},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("收件信息")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(_,{class:"weui-input",disabled:!0,style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请选择收件信息",value:K.address.userName?K.address.userName+"("+K.address.cityName+K.address.countyName+K.address.detailInfo+")":""},null,8,["value"])])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("联系电话")])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(_,{class:"weui-input",type:"number",name:"tel",style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请填写您的联系电话",modelValue:K.tel,"onUpdate:modelValue":l[3]||(l[3]=e=>K.tel=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-tt"},{default:u((()=>[m("服务需求")])),_:1}),d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__bd"},{default:u((()=>[d(x,{name:"demand","auto-height":"",placeholder:"如有其他服务要求请在此填写..","placeholder-class":"vp-placeholder",style:{"min-height":"150rpx"},modelValue:K.demand,"onUpdate:modelValue":l[4]||(l[4]=e=>K.demand=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})],64)):w("",!0),110==G.value.stype?(s(),h(b,{key:2},[d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[d(o,{class:"weui-label"},{default:u((()=>[m("服务时间")])),_:1})])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(o,null,{default:u((()=>[d(y,{onDtPickerChanged:ee,timestamp:K.starttime,placeholder:"请选择期望服务时间"},null,8,["timestamp"])])),_:1})])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input",onClick:le},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("服务对象")])),_:1}),d(o,{class:"weui-cell__bd"}),d(o,{class:"weui-cell__ft weui-cell__ft_in-access"},{default:u((()=>[d(_,{class:"weui-input",disabled:!0,style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请选择服务对象",value:R.name},null,8,["value"])])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("服务地址")])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(_,{class:"weui-input",name:"receiveAddress",style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请填写服务所在地址",modelValue:K.receiveAddress,"onUpdate:modelValue":l[5]||(l[5]=e=>K.receiveAddress=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__hd"},{default:u((()=>[m("联系电话")])),_:1}),d(o,{class:"weui-cell__bd"},{default:u((()=>[d(_,{class:"weui-input",type:"number",name:"tel",style:{"text-align":"right"},"placeholder-class":"vp-placeholder",placeholder:"请填写您的联系电话",modelValue:K.tel,"onUpdate:modelValue":l[6]||(l[6]=e=>K.tel=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),d(o,{class:"pub-box"},{default:u((()=>[d(o,{class:"pub-box-tt"},{default:u((()=>[m("服务需求")])),_:1}),d(o,{class:"pub-box-bd"},{default:u((()=>[d(o,{class:"weui-cell weui-cell_input"},{default:u((()=>[d(o,{class:"weui-cell__bd"},{default:u((()=>[d(x,{name:"demand","auto-height":"",placeholder:"请简单描述您要就诊的科室..","placeholder-class":"vp-placeholder",style:{"min-height":"150rpx"},modelValue:K.demand,"onUpdate:modelValue":l[7]||(l[7]=e=>K.demand=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})],64)):w("",!0),d(o,{style:{height:"300rpx"}}),d(o,{class:"vp-foot"},{default:u((()=>[d(o,{style:{background:"#ffffff",padding:"20rpx"}},{default:u((()=>[d(o,{class:"xieyi",style:{"text-align":"center"}},{default:u((()=>[d(r,{class:g("is_xieyi "+(B.value?"is_xieyi_on":"")),onClick:ae},{default:u((()=>[m("我已阅读并同意")])),_:1},8,["class"]),d(k,{url:L.page_xy},{default:u((()=>[m("《用户协议》")])),_:1},8,["url"]),d(r,null,{default:u((()=>[m("和")])),_:1}),d(k,{url:L.page_fw},{default:u((()=>[m("《服务协议》")])),_:1},8,["url"])])),_:1}),d(o,null,{default:u((()=>[d(V,{class:g("btnp "+(B.value?"":"btnp-disabled")),onClick:ue},{default:u((()=>[m(" 确认下单 "),K.price>0?(s(),h(b,{key:0},[m("（支付"+v(K.price)+"元）",1)],64)):w("",!0)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),d(C,{ref_key:"popup",ref:q,type:"center","is-mask-click":!1,"background-color":"#fff"},{default:u((()=>[d(o,{class:"popup-content"},{default:u((()=>[d(o,{class:"group"},{default:u((()=>[d(_,{class:"uni-input",type:"tel",modelValue:E.phone,"onUpdate:modelValue":l[8]||(l[8]=e=>E.phone=e),placeholder:"手机号"},null,8,["modelValue"])])),_:1}),d(o,{class:"group"},{default:u((()=>[d(_,{class:"uni-input",modelValue:E.validCode,"onUpdate:modelValue":l[9]||(l[9]=e=>E.validCode=e),placeholder:"验证码"},null,8,["modelValue"]),d(r,{class:"valid-text",onClick:ne},{default:u((()=>[m(v(Q.validText),1)])),_:1})])),_:1})])),_:1}),d(o,{class:"btns"},{default:u((()=>[d(o,{class:"cancal",onClick:de},{default:u((()=>[m("取消")])),_:1}),d(o,{class:"ok",onClick:ce},{default:u((()=>[m("确定")])),_:1})])),_:1})])),_:1},512),d(C,{ref_key:"qrcodePopup",ref:z,type:"center","is-mask-click":!1,"background-color":"#fff"},{default:u((()=>[d(o,{class:"pay-box"},{default:u((()=>[d(a,{onClick:re,src:F,style:{display:"block",width:"30rpx",height:"30rpx"}}),d(o,{class:"text-center"},{default:u((()=>[m("微信支付")])),_:1}),d(j,{id:"qrcode","canvas-id":"qrcode",style:{width:"300rpx",height:"300rpx"}}),d(o,{class:"text-center"},{default:u((()=>[m("请用本人微信扫描以上二维码")])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-a2189a93"]]);export{z as default};
