define(["./arrayRemoveDuplicates-d0608faf","./BoundingRectangle-3100662d","./Transforms-b1e48e05","./Cartesian2-0a34ed75","./Cartesian3-e96ac170","./ComponentDatatype-63fd8cd4","./CoplanarPolygonGeometryLibrary-50b6889f","./defaultValue-9f6a6288","./defined-64766648","./Ellipsoid-fa58f06f","./Geometry-dd0ae099","./GeometryAttribute-5ac032ac","./GeometryAttributes-3de79df5","./GeometryInstance-a555221e","./GeometryPipeline-92c34dd1","./IndexDatatype-ed8b21cb","./Math-56779564","./Matrix3-59918a96","./PolygonGeometryLibrary-37fe200f","./PolygonPipeline-d79010c3","./VertexFormat-01d05a0d","./GeographicProjection-868b0b16","./Matrix2-e52b9454","./RuntimeError-cfbf2bc8","./Resource-be841477","./combine-ac72e009","./defer-7878b392","./WebGLConstants-7f557f93","./OrientedBoundingBox-fa9d7c73","./EllipsoidTangentPlane-8f36a7e0","./AxisAlignedBoundingBox-8b4e9f9c","./IntersectionTests-39c3b1c1","./Plane-f9bf6226","./AttributeCompression-44abee07","./EncodedCartesian3-e0f0a7d1","./ArcType-26a3f38d","./EllipsoidRhumbLine-cea00df6"],(function(e,t,n,o,r,a,i,s,l,c,y,p,u,m,d,g,C,h,x,b,f,P,A,G,L,w,F,v,E,_,T,k,D,V,R,H,I){"use strict";const M=new r.Cartesian3,B=new t.BoundingRectangle,O=new o.Cartesian2,z=new o.Cartesian2,S=new r.Cartesian3,N=new r.Cartesian3,j=new r.Cartesian3,Q=new r.Cartesian3,q=new r.Cartesian3,J=new r.Cartesian3,U=new n.Quaternion,Y=new h.Matrix3,W=new h.Matrix3,Z=new r.Cartesian3;function K(e,t,i,s,c,m,d,x,f){const P=e.positions;let A=b.PolygonPipeline.triangulate(e.positions2D,e.holes);A.length<3&&(A=[0,1,2]);const G=g.IndexDatatype.createTypedArray(P.length,A.length);G.set(A);let L=Y;if(0!==s){let e=n.Quaternion.fromAxisAngle(d,s,U);if(L=h.Matrix3.fromQuaternion(e,L),t.tangent||t.bitangent){e=n.Quaternion.fromAxisAngle(d,-s,U);const o=h.Matrix3.fromQuaternion(e,W);x=r.Cartesian3.normalize(h.Matrix3.multiplyByVector(o,x,x),x),t.bitangent&&(f=r.Cartesian3.normalize(r.Cartesian3.cross(d,x,f),f))}}else L=h.Matrix3.clone(h.Matrix3.IDENTITY,L);const w=z;t.st&&(w.x=i.x,w.y=i.y);const F=P.length,v=3*F,E=new Float64Array(v),_=t.normal?new Float32Array(v):void 0,T=t.tangent?new Float32Array(v):void 0,k=t.bitangent?new Float32Array(v):void 0,D=t.st?new Float32Array(2*F):void 0;let V=0,R=0,H=0,I=0,B=0;for(let e=0;e<F;e++){const n=P[e];if(E[V++]=n.x,E[V++]=n.y,E[V++]=n.z,t.st)if(l.defined(c)&&c.positions.length===F)D[B++]=c.positions[e].x,D[B++]=c.positions[e].y;else{const e=m(h.Matrix3.multiplyByVector(L,n,M),O);o.Cartesian2.subtract(e,w,e);const t=C.CesiumMath.clamp(e.x/i.width,0,1),r=C.CesiumMath.clamp(e.y/i.height,0,1);D[B++]=t,D[B++]=r}t.normal&&(_[R++]=d.x,_[R++]=d.y,_[R++]=d.z),t.tangent&&(T[I++]=x.x,T[I++]=x.y,T[I++]=x.z),t.bitangent&&(k[H++]=f.x,k[H++]=f.y,k[H++]=f.z)}const S=new u.GeometryAttributes;return t.position&&(S.position=new p.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:E})),t.normal&&(S.normal=new p.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(S.tangent=new p.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T})),t.bitangent&&(S.bitangent=new p.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.st&&(S.st=new p.GeometryAttribute({componentDatatype:a.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new y.Geometry({attributes:S,indices:G,primitiveType:y.PrimitiveType.TRIANGLES})}function X(e){const t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=e.textureCoordinates,a=s.defaultValue(e.vertexFormat,f.VertexFormat.DEFAULT);this._vertexFormat=f.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=c.Ellipsoid.clone(s.defaultValue(e.ellipsoid,c.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this._textureCoordinates=n,this.packedLength=x.PolygonGeometryLibrary.computeHierarchyPackedLength(t,r.Cartesian3)+f.VertexFormat.packedLength+c.Ellipsoid.packedLength+(l.defined(n)?x.PolygonGeometryLibrary.computeHierarchyPackedLength(n,o.Cartesian2):1)+2}X.fromPositions=function(e){return new X({polygonHierarchy:{positions:(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,textureCoordinates:e.textureCoordinates})},X.pack=function(e,t,n){return n=s.defaultValue(n,0),n=x.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n,r.Cartesian3),c.Ellipsoid.pack(e._ellipsoid,t,n),n+=c.Ellipsoid.packedLength,f.VertexFormat.pack(e._vertexFormat,t,n),n+=f.VertexFormat.packedLength,t[n++]=e._stRotation,l.defined(e._textureCoordinates)?n=x.PolygonGeometryLibrary.packPolygonHierarchy(e._textureCoordinates,t,n,o.Cartesian2):t[n++]=-1,t[n++]=e.packedLength,t};const $=c.Ellipsoid.clone(c.Ellipsoid.UNIT_SPHERE),ee=new f.VertexFormat,te={polygonHierarchy:{}};return X.unpack=function(e,t,n){t=s.defaultValue(t,0);const a=x.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t,r.Cartesian3);t=a.startingIndex,delete a.startingIndex;const i=c.Ellipsoid.unpack(e,t,$);t+=c.Ellipsoid.packedLength;const y=f.VertexFormat.unpack(e,t,ee);t+=f.VertexFormat.packedLength;const p=e[t++],u=-1===e[t]?void 0:x.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t,o.Cartesian2);l.defined(u)?(t=u.startingIndex,delete u.startingIndex):t++;const m=e[t++];return l.defined(n)||(n=new X(te)),n._polygonHierarchy=a,n._ellipsoid=c.Ellipsoid.clone(i,n._ellipsoid),n._vertexFormat=f.VertexFormat.clone(y,n._vertexFormat),n._stRotation=p,n._textureCoordinates=u,n.packedLength=m,n},X.createGeometry=function(t){const o=t._vertexFormat,a=t._polygonHierarchy,s=t._stRotation,c=t._textureCoordinates,p=l.defined(c);let u=a.positions;if(u=e.arrayRemoveDuplicates(u,r.Cartesian3.equalsEpsilon,!0),u.length<3)return;let h=S,b=N,f=j,P=q;const A=J;if(!i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(u,Q,P,A))return;if(h=r.Cartesian3.cross(P,A,h),h=r.Cartesian3.normalize(h,h),!r.Cartesian3.equalsEpsilon(Q,r.Cartesian3.ZERO,C.CesiumMath.EPSILON6)){const e=t._ellipsoid.geodeticSurfaceNormal(Q,Z);r.Cartesian3.dot(h,e)<0&&(h=r.Cartesian3.negate(h,h),P=r.Cartesian3.negate(P,P))}const G=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(Q,P,A),L=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(Q,P,A);o.tangent&&(b=r.Cartesian3.clone(P,b)),o.bitangent&&(f=r.Cartesian3.clone(A,f));const w=x.PolygonGeometryLibrary.polygonsFromHierarchy(a,p,G,!1),F=w.hierarchy,v=w.polygons,E=p?x.PolygonGeometryLibrary.polygonsFromHierarchy(c,!0,(function(e){return e}),!1).polygons:void 0;if(0===F.length)return;u=F[0].outerRing;const _=n.BoundingSphere.fromPoints(u),T=x.PolygonGeometryLibrary.computeBoundingRectangle(h,L,u,s,B),k=[];for(let e=0;e<v.length;e++){const t=new m.GeometryInstance({geometry:K(v[e],o,T,s,p?E[e]:void 0,L,h,b,f)});k.push(t)}const D=d.GeometryPipeline.combineInstances(k)[0];D.attributes.position.values=new Float64Array(D.attributes.position.values),D.indices=g.IndexDatatype.createTypedArray(D.attributes.position.values.length/3,D.indices);const V=D.attributes;return o.position||delete V.position,new y.Geometry({attributes:V,indices:D.indices,primitiveType:D.primitiveType,boundingSphere:_})},function(e,t){return l.defined(t)&&(e=X.unpack(e,t)),X.createGeometry(e)}}));
