define(["./Transforms-b1e48e05","./BoxGeometry-a420c0e9","./Cartesian3-e96ac170","./Color-cad7c885","./CylinderGeometry-3fdea38e","./defined-64766648","./EllipsoidGeometry-c8fde476","./IndexDatatype-ed8b21cb","./Matrix2-e52b9454","./createTaskProcessorWorker-03824364","./Ellipsoid-fa58f06f","./defaultValue-9f6a6288","./Math-56779564","./GeographicProjection-868b0b16","./Matrix3-59918a96","./Cartesian2-0a34ed75","./Resource-be841477","./combine-ac72e009","./defer-7878b392","./RuntimeError-cfbf2bc8","./ComponentDatatype-63fd8cd4","./WebGLConstants-7f557f93","./Geometry-dd0ae099","./GeometryAttribute-5ac032ac","./GeometryAttributes-3de79df5","./GeometryOffsetAttribute-2579b8d2","./VertexFormat-01d05a0d","./CylinderGeometryLibrary-ae3f9c2b"],(function(e,t,n,r,i,a,o,s,d,c,l,f,u,h,p,b,y,x,g,m,C,k,I,M,B,w,A,O){"use strict";function v(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}const L=new n.Cartesian3,E=d.Matrix4.packedLength+n.Cartesian3.packedLength,G=d.Matrix4.packedLength+2,U=d.Matrix4.packedLength+n.Cartesian3.packedLength,S=n.Cartesian3.packedLength+1,T={modelMatrix:new d.Matrix4,boundingVolume:new e.BoundingSphere};function V(e,t){let r=t*E;const i=n.Cartesian3.unpack(e,r,L);r+=n.Cartesian3.packedLength;const a=d.Matrix4.unpack(e,r,T.modelMatrix);d.Matrix4.multiplyByScale(a,i,a);const o=T.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=Math.sqrt(3),T}function F(e,t){let r=t*G;const i=e[r++],a=e[r++],o=n.Cartesian3.fromElements(i,i,a,L),s=d.Matrix4.unpack(e,r,T.modelMatrix);d.Matrix4.multiplyByScale(s,o,s);const c=T.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,c.center),c.radius=Math.sqrt(2),T}function R(e,t){let r=t*U;const i=n.Cartesian3.unpack(e,r,L);r+=n.Cartesian3.packedLength;const a=d.Matrix4.unpack(e,r,T.modelMatrix);d.Matrix4.multiplyByScale(a,i,a);const o=T.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=1,T}function P(e,t){let r=t*S;const i=e[r++],a=n.Cartesian3.unpack(e,r,L),o=d.Matrix4.fromTranslation(a,T.modelMatrix);d.Matrix4.multiplyByUniformScale(o,i,o);const s=T.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,s.center),s.radius=1,T}const W=new n.Cartesian3;function Z(t,i,o,s,c){if(!a.defined(i))return;const l=o.length,f=s.attributes.position.values,u=s.indices,h=t.positions,p=t.vertexBatchIds,b=t.indices,y=t.batchIds,x=t.batchTableColors,g=t.batchedIndices,m=t.indexOffsets,C=t.indexCounts,k=t.boundingVolumes,I=t.modelMatrix,M=t.center;let B=t.positionOffset,w=t.batchIdIndex,A=t.indexOffset;const O=t.batchedIndicesOffset;for(let t=0;t<l;++t){const a=c(i,t),s=a.modelMatrix;d.Matrix4.multiply(I,s,s);const l=o[t],L=f.length;for(let e=0;e<L;e+=3){const t=n.Cartesian3.unpack(f,e,W);d.Matrix4.multiplyByPoint(s,t,t),n.Cartesian3.subtract(t,M,t),n.Cartesian3.pack(t,h,3*B+e),p[w++]=l}const E=u.length;for(let e=0;e<E;++e)b[A+e]=u[e]+B;const G=t+O;g[G]=new v({offset:A,count:E,color:r.Color.fromRgba(x[l]),batchIds:[l]}),y[G]=l,m[G]=A,C[G]=E,k[G]=e.BoundingSphere.transform(a.boundingVolume,s),B+=L/3,A+=E}t.positionOffset=B,t.batchIdIndex=w,t.indexOffset=A,t.batchedIndicesOffset+=l}const D=new n.Cartesian3,j=new d.Matrix4;function q(t,n,i){const a=i.length,o=2+a*e.BoundingSphere.packedLength+1+function(e){const t=e.length;let n=0;for(let i=0;i<t;++i)n+=r.Color.packedLength+3+e[i].batchIds.length;return n}(n),s=new Float64Array(o);let d=0;s[d++]=t,s[d++]=a;for(let t=0;t<a;++t)e.BoundingSphere.pack(i[t],s,d),d+=e.BoundingSphere.packedLength;const c=n.length;s[d++]=c;for(let e=0;e<c;++e){const t=n[e];r.Color.pack(t.color,s,d),d+=r.Color.packedLength,s[d++]=t.offset,s[d++]=t.count;const i=t.batchIds,a=i.length;s[d++]=a;for(let e=0;e<a;++e)s[d++]=i[e]}return s}return c.createTaskProcessorWorker((function(e,r){const c=a.defined(e.boxes)?new Float32Array(e.boxes):void 0,l=a.defined(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,f=a.defined(e.cylinders)?new Float32Array(e.cylinders):void 0,u=a.defined(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,h=a.defined(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,p=a.defined(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,b=a.defined(e.spheres)?new Float32Array(e.spheres):void 0,y=a.defined(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,x=a.defined(c)?l.length:0,g=a.defined(f)?u.length:0,m=a.defined(h)?p.length:0,C=a.defined(b)?y.length:0,k=t.BoxGeometry.getUnitBox(),I=i.CylinderGeometry.getUnitCylinder(),M=o.EllipsoidGeometry.getUnitEllipsoid(),B=k.attributes.position.values,w=I.attributes.position.values,A=M.attributes.position.values;let O=B.length*x;O+=w.length*g,O+=A.length*(m+C);const v=k.indices,L=I.indices,E=M.indices;let G=v.length*x;G+=L.length*g,G+=E.length*(m+C);const U=new Float32Array(O),S=new Uint16Array(O/3),T=s.IndexDatatype.createTypedArray(O/3,G),W=x+g+m+C,_=new Uint16Array(W),N=new Array(W),Q=new Uint32Array(W),Y=new Uint32Array(W),z=new Array(W);!function(e){const t=new Float64Array(e);let r=0;n.Cartesian3.unpack(t,r,D),r+=n.Cartesian3.packedLength,d.Matrix4.unpack(t,r,j)}(e.packedBuffer);const H={batchTableColors:new Uint32Array(e.batchTableColors),positions:U,vertexBatchIds:S,indices:T,batchIds:_,batchedIndices:N,indexOffsets:Q,indexCounts:Y,boundingVolumes:z,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:j,center:D};Z(H,c,l,k,V),Z(H,f,u,I,F),Z(H,h,p,M,R),Z(H,b,y,M,P);const J=q(T.BYTES_PER_ELEMENT,N,z);return r.push(U.buffer,S.buffer,T.buffer),r.push(_.buffer,Q.buffer,Y.buffer),r.push(J.buffer),{positions:U.buffer,vertexBatchIds:S.buffer,indices:T.buffer,indexOffsets:Q.buffer,indexCounts:Y.buffer,batchIds:_.buffer,packedBuffer:J.buffer}}))}));
