define((function(){"use strict";return function(){var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,o=3406,a=2276,t=1567,i=3784,c=5793,s=2896;function f(){}function u(e,n){for(var r,o,a=0,t=[],i=16;i>0&&!e[i-1];)i--;t.push({children:[],index:0});var c,s=t[0];for(r=0;r<i;r++){for(o=0;o<e[r];o++){for((s=t.pop()).children[s.index]=n[a];s.index>0;)s=t.pop();for(s.index++,t.push(s);t.length<=r;)t.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c;a++}r+1<i&&(t.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c)}return t[0].children}function l(e,n,r){return 64*((e.blocksPerLine+1)*n+r)}function h(n,r,o,a,t,i,c,s,f){o.precision,o.samplesPerLine,o.scanLines;var u=o.mcusPerLine,h=o.progressive;o.maxH,o.maxV;var v=r,m=0,b=0;function d(){if(b>0)return b--,m>>b&1;if(255===(m=n[r++])){var e=n[r++];if(e)throw"unexpected marker: "+(m<<8|e).toString(16)}return b=7,m>>>7}function k(e){for(var n=e;;){if("number"==typeof(n=n[d()]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}}function p(e){for(var n=0;e>0;)n=n<<1|d(),e--;return n}function g(e){if(1===e)return 1===d()?1:-1;var n=p(e);return n>=1<<e-1?n:n+(-1<<e)+1}var C=0;var D,P=0;function w(e,n,r,o,a){var t=r%u;n(e,l(e,(r/u|0)*e.v+o,t*e.h+a))}function L(e,n,r){n(e,l(e,r/e.blocksPerLine|0,r%e.blocksPerLine))}var y,x,T,A,_,U,Y=a.length;U=h?0===i?0===s?function(e,n){var r=k(e.huffmanTableDC),o=0===r?0:g(r)<<f;e.blockData[n]=e.pred+=o}:function(e,n){e.blockData[n]|=d()<<f}:0===s?function(n,r){if(C>0)C--;else for(var o=i,a=c;o<=a;){var t=k(n.huffmanTableAC),s=15&t,u=t>>4;if(0!==s){var l=e[o+=u];n.blockData[r+l]=g(s)*(1<<f),o++}else{if(u<15){C=p(u)+(1<<u)-1;break}o+=16}}}:function(n,r){for(var o,a,t=i,s=c,u=0;t<=s;){var l=e[t];switch(P){case 0:if(u=(a=k(n.huffmanTableAC))>>4,0==(o=15&a))u<15?(C=p(u)+(1<<u),P=4):(u=16,P=1);else{if(1!==o)throw"invalid ACn encoding";D=g(o),P=u?2:3}continue;case 1:case 2:n.blockData[r+l]?n.blockData[r+l]+=d()<<f:0==--u&&(P=2===P?3:0);break;case 3:n.blockData[r+l]?n.blockData[r+l]+=d()<<f:(n.blockData[r+l]=D<<f,P=0);break;case 4:n.blockData[r+l]&&(n.blockData[r+l]+=d()<<f)}t++}4===P&&0==--C&&(P=0)}:function(n,r){var o=k(n.huffmanTableDC),a=0===o?0:g(o);n.blockData[r]=n.pred+=a;for(var t=1;t<64;){var i=k(n.huffmanTableAC),c=15&i,s=i>>4;if(0!==c){var f=e[t+=s];n.blockData[r+f]=g(c),t++}else{if(s<15)break;t+=16}}};var H,I,M,R,V=0;for(I=1===Y?a[0].blocksPerLine*a[0].blocksPerColumn:u*o.mcusPerColumn,t||(t=I);V<I;){for(x=0;x<Y;x++)a[x].pred=0;if(C=0,1===Y)for(y=a[0],_=0;_<t;_++)L(y,U,V),V++;else for(_=0;_<t;_++){for(x=0;x<Y;x++)for(M=(y=a[x]).h,R=y.v,T=0;T<R;T++)for(A=0;A<M;A++)w(y,U,V,T,A);V++}if(b=0,(H=n[r]<<8|n[r+1])<=65280)throw"marker was not found";if(!(H>=65488&&H<=65495))break;r+=2}return r-v}function v(e,f,u){for(var l,h,v,m,b,d,k,p,g,C,D,P,w,L,y,x,T,A=e.quantizationTable,_=e.blockData,U=0;U<64;U+=8)g=_[f+U],C=_[f+U+1],D=_[f+U+2],P=_[f+U+3],w=_[f+U+4],L=_[f+U+5],y=_[f+U+6],x=_[f+U+7],g*=A[U],0!=(C|D|P|w|L|y|x)?(C*=A[U+1],D*=A[U+2],P*=A[U+3],w*=A[U+4],L*=A[U+5],y*=A[U+6],x*=A[U+7],h=(l=(l=c*g+128>>8)+(h=c*w+128>>8)+1>>1)-h,T=(v=D)*i+(m=y)*t+128>>8,v=v*t-m*i+128>>8,k=(b=(b=s*(C-x)+128>>8)+(k=L<<4)+1>>1)-k,d=(p=(p=s*(C+x)+128>>8)+(d=P<<4)+1>>1)-d,m=(l=l+(m=T)+1>>1)-m,v=(h=h+v+1>>1)-v,T=b*a+p*o+2048>>12,b=b*o-p*a+2048>>12,p=T,T=d*r+k*n+2048>>12,d=d*n-k*r+2048>>12,k=T,u[U]=l+p,u[U+7]=l-p,u[U+1]=h+k,u[U+6]=h-k,u[U+2]=v+d,u[U+5]=v-d,u[U+3]=m+b,u[U+4]=m-b):(T=c*g+512>>10,u[U]=T,u[U+1]=T,u[U+2]=T,u[U+3]=T,u[U+4]=T,u[U+5]=T,u[U+6]=T,u[U+7]=T);for(var Y=0;Y<8;++Y)g=u[Y],0!=((C=u[Y+8])|(D=u[Y+16])|(P=u[Y+24])|(w=u[Y+32])|(L=u[Y+40])|(y=u[Y+48])|(x=u[Y+56]))?(h=(l=4112+((l=c*g+2048>>12)+(h=c*w+2048>>12)+1>>1))-h,T=(v=D)*i+(m=y)*t+2048>>12,v=v*t-m*i+2048>>12,m=T,k=(b=(b=s*(C-x)+2048>>12)+(k=L)+1>>1)-k,d=(p=(p=s*(C+x)+2048>>12)+(d=P)+1>>1)-d,T=b*a+p*o+2048>>12,b=b*o-p*a+2048>>12,p=T,T=d*r+k*n+2048>>12,d=d*n-k*r+2048>>12,g=(g=(l=l+m+1>>1)+p)<16?0:g>=4080?255:g>>4,C=(C=(h=h+v+1>>1)+(k=T))<16?0:C>=4080?255:C>>4,D=(D=(v=h-v)+d)<16?0:D>=4080?255:D>>4,P=(P=(m=l-m)+b)<16?0:P>=4080?255:P>>4,w=(w=m-b)<16?0:w>=4080?255:w>>4,L=(L=v-d)<16?0:L>=4080?255:L>>4,y=(y=h-k)<16?0:y>=4080?255:y>>4,x=(x=l-p)<16?0:x>=4080?255:x>>4,_[f+Y]=g,_[f+Y+8]=C,_[f+Y+16]=D,_[f+Y+24]=P,_[f+Y+32]=w,_[f+Y+40]=L,_[f+Y+48]=y,_[f+Y+56]=x):(T=(T=c*g+8192>>14)<-2040?0:T>=2024?255:T+2056>>4,_[f+Y]=T,_[f+Y+8]=T,_[f+Y+16]=T,_[f+Y+24]=T,_[f+Y+32]=T,_[f+Y+40]=T,_[f+Y+48]=T,_[f+Y+56]=T)}function m(e,n){for(var r=n.blocksPerLine,o=n.blocksPerColumn,a=new Int16Array(64),t=0;t<o;t++)for(var i=0;i<r;i++){v(n,l(n,t,i),a)}return n.blockData}function b(e){return e<=0?0:e>=255?255:e}return f.prototype={parse:function(n){function r(){var e=n[a]<<8|n[a+1];return a+=2,e}function o(e){for(var n=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),o=0;o<e.components.length;o++){z=e.components[o];var a=Math.ceil(Math.ceil(e.samplesPerLine/8)*z.h/e.maxH),t=Math.ceil(Math.ceil(e.scanLines/8)*z.v/e.maxV),i=n*z.h,c=64*(r*z.v)*(i+1);z.blockData=new Int16Array(c),z.blocksPerLine=a,z.blocksPerColumn=t}e.mcusPerLine=n,e.mcusPerColumn=r}var a=0;n.length;var t,i,c,s,f=null,l=null,v=[],b=[],d=[],k=r();if(65496!==k)throw"SOI not found";for(k=r();65497!==k;){var p,g,C;switch(k){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var D=(c=void 0,s=void 0,c=r(),s=n.subarray(a,a+c-2),a+=s.length,s);65504===k&&74===D[0]&&70===D[1]&&73===D[2]&&70===D[3]&&0===D[4]&&(f={version:{major:D[5],minor:D[6]},densityUnits:D[7],xDensity:D[8]<<8|D[9],yDensity:D[10]<<8|D[11],thumbWidth:D[12],thumbHeight:D[13],thumbData:D.subarray(14,14+3*D[12]*D[13])}),65518===k&&65===D[0]&&100===D[1]&&111===D[2]&&98===D[3]&&101===D[4]&&0===D[5]&&(l={version:D[6],flags0:D[7]<<8|D[8],flags1:D[9]<<8|D[10],transformCode:D[11]});break;case 65499:for(var P=r()+a-2;a<P;){var w=n[a++],L=new Uint16Array(64);if(w>>4==0)for(g=0;g<64;g++)L[e[g]]=n[a++];else{if(w>>4!=1)throw"DQT: invalid table spec";for(g=0;g<64;g++)L[e[g]]=r()}v[15&w]=L}break;case 65472:case 65473:case 65474:if(t)throw"Only single frame JPEGs supported";r(),(t={}).extended=65473===k,t.progressive=65474===k,t.precision=n[a++],t.scanLines=r(),t.samplesPerLine=r(),t.components=[],t.componentIds={};var y,x=n[a++],T=0,A=0;for(p=0;p<x;p++){y=n[a];var _=n[a+1]>>4,U=15&n[a+1];T<_&&(T=_),A<U&&(A=U);var Y=n[a+2];C=t.components.push({h:_,v:U,quantizationTable:v[Y]}),t.componentIds[y]=C-1,a+=3}t.maxH=T,t.maxV=A,o(t);break;case 65476:var H=r();for(p=2;p<H;){var I=n[a++],M=new Uint8Array(16),R=0;for(g=0;g<16;g++,a++)R+=M[g]=n[a];var V=new Uint8Array(R);for(g=0;g<R;g++,a++)V[g]=n[a];p+=17+R,(I>>4==0?d:b)[15&I]=u(M,V)}break;case 65501:r(),i=r();break;case 65498:r();var z,j=n[a++],q=[];for(p=0;p<j;p++){var S=t.componentIds[n[a++]];z=t.components[S];var B=n[a++];z.huffmanTableDC=d[B>>4],z.huffmanTableAC=b[15&B],q.push(z)}var E=n[a++],G=n[a++],J=n[a++],N=h(n,a,t,q,i,E,G,J>>4,15&J);a+=N;break;case 65535:255!==n[a]&&a--;break;default:if(255===n[a-3]&&n[a-2]>=192&&n[a-2]<=254){a-=3;break}throw"unknown JPEG marker "+k.toString(16)}k=r()}for(this.width=t.samplesPerLine,this.height=t.scanLines,this.jfif=f,this.adobe=l,this.components=[],p=0;p<t.components.length;p++)z=t.components[p],this.components.push({output:m(0,z),scaleX:z.h/t.maxH,scaleY:z.v/t.maxV,blocksPerLine:z.blocksPerLine,blocksPerColumn:z.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(e,n){var r,o,a,t,i,c,s,f,u,l,h,v=this.width/e,m=this.height/n,b=0,d=this.components.length,k=e*n*d,p=new Uint8Array(k),g=new Uint32Array(e),C=4294967288;for(s=0;s<d;s++){for(o=(r=this.components[s]).scaleX*v,a=r.scaleY*m,b=s,h=r.output,t=r.blocksPerLine+1<<3,i=0;i<e;i++)f=0|i*o,g[i]=(f&C)<<3|7&f;for(c=0;c<n;c++)for(l=t*((f=0|c*a)&C)|(7&f)<<3,i=0;i<e;i++)p[b]=h[l+g[i]],b+=d}var D=this.decodeTransform;if(D)for(s=0;s<k;)for(f=0,u=0;f<d;f++,s++,u+=2)p[s]=(p[s]*D[u]>>8)+D[u+1];return p},_isColorConversionNeeded:function(){return!(!this.adobe||!this.adobe.transformCode)||3===this.numComponents},_convertYccToRgb:function(e){for(var n,r,o,a=0,t=e.length;a<t;a+=3)n=e[a],r=e[a+1],o=e[a+2],e[a]=b(n-179.456+1.402*o),e[a+1]=b(n+135.459-.344*r-.714*o),e[a+2]=b(n-226.816+1.772*r);return e},_convertYcckToRgb:function(e){for(var n,r,o,a,t=0,i=0,c=e.length;i<c;i+=4){n=e[i];var s=(r=e[i+1])*(-660635669420364e-19*r+.000437130475926232*(o=e[i+2])-54080610064599e-18*n+.00048449797120281*(a=e[i+3])-.154362151871126)-122.67195406894+o*(-.000957964378445773*o+.000817076911346625*n-.00477271405408747*a+1.53380253221734)+n*(.000961250184130688*n-.00266257332283933*a+.48357088451265)+a*(-.000336197177618394*a+.484791561490776),f=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*o+.000659397001245577*n+.000426105652938837*a-.176491792462875)+o*(-.000778269941513683*o+.00130872261408275*n+.000770482631801132*a-.151051492775562)+n*(.00126935368114843*n-.00265090189010898*a+.25802910206845)+a*(-.000318913117588328*a-.213742400323665),u=r*(-.000570115196973677*r-263409051004589e-19*o+.0020741088115012*n-.00288260236853442*a+.814272968359295)-20.810012546947+o*(-153496057440975e-19*o-.000132689043961446*n+.000560833691242812*a-.195152027534049)+n*(.00174418132927582*n-.00255243321439347*a+.116935020465145)+a*(-.000343531996510555*a+.24165260232407);e[t++]=b(s),e[t++]=b(f),e[t++]=b(u)}return e},_convertYcckToCmyk:function(e){for(var n,r,o,a=0,t=e.length;a<t;a+=4)n=e[a],r=e[a+1],o=e[a+2],e[a]=b(434.456-n-1.402*o),e[a+1]=b(119.541-n+.344*r+.714*o),e[a+2]=b(481.816-n-1.772*r);return e},_convertCmykToRgb:function(e){for(var n,r,o,a,t=0,i=-16581375,c=1/255/255,s=0,f=e.length;s<f;s+=4){var u=(n=e[s])*(-4.387332384609988*n+54.48615194189176*(r=e[s+1])+18.82290502165302*(o=e[s+2])+212.25662451639585*(a=e[s+3])-72734.4411664936)+r*(1.7149763477362134*r-5.6096736904047315*o-17.873870861415444*a-1401.7366389350734)+o*(-2.5217340131683033*o-21.248923337353073*a+4465.541406466231)-a*(21.86122147463605*a+48317.86113160301),l=n*(8.841041422036149*n+60.118027045597366*r+6.871425592049007*o+31.159100130055922*a-20220.756542821975)+r*(-15.310361306967817*r+17.575251261109482*o+131.35250912493976*a-48691.05921601825)+o*(4.444339102852739*o+9.8632861493405*a-6341.191035517494)-a*(20.737325471181034*a+47890.15695978492),h=n*(.8842522430003296*n+8.078677503112928*r+30.89978309703729*o-.23883238689178934*a-3616.812083916688)+r*(10.49593273432072*r+63.02378494754052*o+50.606957656360734*a-28620.90484698408)+o*(.03296041114873217*o+115.60384449646641*a-49363.43385999684)-a*(22.33816807309886*a+45932.16563550634);e[t++]=u>=0?255:u<=i?0:255+u*c|0,e[t++]=l>=0?255:l<=i?0:255+l*c|0,e[t++]=h>=0?255:h<=i?0:255+h*c|0}return e},getData:function(e,n,r){if(this.numComponents>4)throw"Unsupported color mode";var o=this._getLinearizedBlockData(e,n);if(3===this.numComponents)return this._convertYccToRgb(o);if(4===this.numComponents){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(o):this._convertYcckToCmyk(o);if(r)return this._convertCmykToRgb(o)}return o}},f}()}));
