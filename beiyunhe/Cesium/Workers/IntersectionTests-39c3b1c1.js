define(["exports","./Cartesian3-e96ac170","./Ellipsoid-fa58f06f","./defaultValue-9f6a6288","./defined-64766648","./Transforms-b1e48e05","./Math-56779564","./Matrix3-59918a96"],(function(t,n,e,a,i,r,s,o){"use strict";const c={};function u(t,n,e){const a=t+n;return s.CesiumMath.sign(t)!==s.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}c.computeDiscriminant=function(t,n,e){return n*n-4*t*e},c.computeRealRoots=function(t,n,e){let a;if(0===t)return 0===n?[]:[-e/n];if(0===n){if(0===e)return[0,0];const n=Math.abs(e),i=Math.abs(t);if(n<i&&n/i<s.CesiumMath.EPSILON14)return[0,0];if(n>i&&i/n<s.CesiumMath.EPSILON14)return[];if(a=-e/t,a<0)return[];const r=Math.sqrt(a);return[-r,r]}if(0===e)return a=-n/t,a<0?[a,0]:[0,a];const i=u(n*n,-(4*t*e),s.CesiumMath.EPSILON14);if(i<0)return[];const r=-.5*u(n,s.CesiumMath.sign(n)*Math.sqrt(i),s.CesiumMath.EPSILON14);return n>0?[r/t,e/r]:[e/r,r/t]};var l=c;const C={};function M(t,n,e,a){const i=t,r=n/3,s=e/3,o=a,c=i*s,u=r*o,l=r*r,C=s*s,M=i*s-l,h=i*o-r*s,m=r*o-C,d=4*M*m-h*h;let f,g;if(d<0){let t,n,e;l*u>=c*C?(t=i,n=M,e=-2*r*M+i*h):(t=o,n=m,e=-o*h+2*s*m);const a=-(e<0?-1:1)*Math.abs(t)*Math.sqrt(-d);g=-e+a;const p=g/2,w=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),R=g===a?-w:-n/w;return f=n<=0?w+R:-e/(w*w+R*R+n),l*u>=c*C?[(f-r)/i]:[-o/(f+s)]}const p=M,w=-2*r*M+i*h,R=m,S=-o*h+2*s*m,O=Math.sqrt(d),x=Math.sqrt(3)/2;let y=Math.abs(Math.atan2(i*O,-w)/3);f=2*Math.sqrt(-p);let P=Math.cos(y);g=f*P;let N=f*(-P/2-x*Math.sin(y));const b=g+N>2*r?g-r:N-r,q=i,L=b/q;y=Math.abs(Math.atan2(o*O,-S)/3),f=2*Math.sqrt(-R),P=Math.cos(y),g=f*P,N=f*(-P/2-x*Math.sin(y));const I=-o,E=g+N<2*s?g+s:N+s,v=I/E,z=-b*E-q*I,T=(s*z-r*(b*I))/(-r*z+s*(q*E));return L<=T?L<=v?T<=v?[L,T,v]:[L,v,T]:[v,L,T]:L<=v?[T,L,v]:T<=v?[T,v,L]:[v,T,L]}C.computeDiscriminant=function(t,n,e,a){const i=n*n,r=e*e;return 18*t*n*e*a+i*r-27*(t*t)*(a*a)-4*(t*r*e+i*n*a)},C.computeRealRoots=function(t,n,e,a){let i,r;if(0===t)return l.computeRealRoots(n,e,a);if(0===n){if(0===e){if(0===a)return[0,0,0];r=-a/t;const n=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[n,n,n]}return 0===a?(i=l.computeRealRoots(t,0,e),0===i.Length?[0]:[i[0],0,i[1]]):M(t,0,e,a)}return 0===e?0===a?(r=-n/t,r<0?[r,0,0]:[0,0,r]):M(t,n,0,a):0===a?(i=l.computeRealRoots(t,n,e),0===i.length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]):M(t,n,e,a)};var h=C;const m={};function d(t,n,e,a){const i=t*t,r=n-3*i/8,o=e-n*t/2+i*t/8,c=a-e*t/4+n*i/16-3*i*i/256,u=h.computeRealRoots(1,2*r,r*r-4*c,-o*o);if(u.length>0){const n=-t/4,e=u[u.length-1];if(Math.abs(e)<s.CesiumMath.EPSILON14){const t=l.computeRealRoots(1,r,c);if(2===t.length){const e=t[0],a=t[1];let i;if(e>=0&&a>=0){const t=Math.sqrt(e),i=Math.sqrt(a);return[n-i,n-t,n+t,n+i]}if(e>=0&&a<0)return i=Math.sqrt(e),[n-i,n+i];if(e<0&&a>=0)return i=Math.sqrt(a),[n-i,n+i]}return[]}if(e>0){const t=Math.sqrt(e),a=(r+e-o/t)/2,i=(r+e+o/t)/2,s=l.computeRealRoots(1,t,a),c=l.computeRealRoots(1,-t,i);return 0!==s.length?(s[0]+=n,s[1]+=n,0!==c.length?(c[0]+=n,c[1]+=n,s[1]<=c[0]?[s[0],s[1],c[0],c[1]]:c[1]<=s[0]?[c[0],c[1],s[0],s[1]]:s[0]>=c[0]&&s[1]<=c[1]?[c[0],s[0],s[1],c[1]]:c[0]>=s[0]&&c[1]<=s[1]?[s[0],c[0],c[1],s[1]]:s[0]>c[0]&&s[0]<c[1]?[c[0],s[0],c[1],s[1]]:[s[0],c[0],s[1],c[1]]):s):0!==c.length?(c[0]+=n,c[1]+=n,c):[]}}return[]}function f(t,n,e,a){const i=t*t,r=-2*n,o=e*t+n*n-4*a,c=i*a-e*n*t+e*e,u=h.computeRealRoots(1,r,o,c);if(u.length>0){const r=u[0],o=n-r,c=o*o,C=t/2,M=o/2,h=c-4*a,m=c+4*Math.abs(a),d=i-4*r,f=i+4*Math.abs(r);let g,p,w,R,S,O;if(r<0||h*f<d*m){const n=Math.sqrt(d);g=n/2,p=0===n?0:(t*M-e)/n}else{const n=Math.sqrt(h);g=0===n?0:(t*M-e)/n,p=n/2}0===C&&0===g?(w=0,R=0):s.CesiumMath.sign(C)===s.CesiumMath.sign(g)?(w=C+g,R=r/w):(R=C-g,w=r/R),0===M&&0===p?(S=0,O=0):s.CesiumMath.sign(M)===s.CesiumMath.sign(p)?(S=M+p,O=a/S):(O=M-p,S=a/O);const x=l.computeRealRoots(1,w,S),y=l.computeRealRoots(1,R,O);if(0!==x.length)return 0!==y.length?x[1]<=y[0]?[x[0],x[1],y[0],y[1]]:y[1]<=x[0]?[y[0],y[1],x[0],x[1]]:x[0]>=y[0]&&x[1]<=y[1]?[y[0],x[0],x[1],y[1]]:y[0]>=x[0]&&y[1]<=x[1]?[x[0],y[0],y[1],x[1]]:x[0]>y[0]&&x[0]<y[1]?[y[0],x[0],y[1],x[1]]:[x[0],y[0],x[1],y[1]]:x;if(0!==y.length)return y}return[]}m.computeDiscriminant=function(t,n,e,a,i){const r=t*t,s=n*n,o=s*n,c=e*e,u=c*e,l=a*a,C=l*a,M=i*i;return s*c*l-4*o*C-4*t*u*l+18*t*n*e*C-27*r*l*l+256*(r*t)*(M*i)+i*(18*o*e*a-4*s*u+16*t*c*c-80*t*n*c*a-6*t*s*l+144*r*e*l)+M*(144*t*s*e-27*s*s-128*r*c-192*r*n*a)},m.computeRealRoots=function(t,n,e,a,i){if(Math.abs(t)<s.CesiumMath.EPSILON15)return h.computeRealRoots(n,e,a,i);const r=n/t,o=e/t,c=a/t,u=i/t;let l=r<0?1:0;switch(l+=o<0?l+1:l,l+=c<0?l+1:l,l+=u<0?l+1:l,l){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return d(r,o,c,u);case 1:case 2:case 5:case 8:case 11:return f(r,o,c,u);default:return}};var g=m;function p(t,e){e=n.Cartesian3.clone(a.defaultValue(e,n.Cartesian3.ZERO)),n.Cartesian3.equals(e,n.Cartesian3.ZERO)||n.Cartesian3.normalize(e,e),this.origin=n.Cartesian3.clone(a.defaultValue(t,n.Cartesian3.ZERO)),this.direction=e}p.clone=function(t,e){if(i.defined(t))return i.defined(e)?(e.origin=n.Cartesian3.clone(t.origin),e.direction=n.Cartesian3.clone(t.direction),e):new p(t.origin,t.direction)},p.getPoint=function(t,e,a){return i.defined(a)||(a=new n.Cartesian3),a=n.Cartesian3.multiplyByScalar(t.direction,e,a),n.Cartesian3.add(t.origin,a,a)};const w={rayPlane:function(t,e,a){i.defined(a)||(a=new n.Cartesian3);const r=t.origin,o=t.direction,c=e.normal,u=n.Cartesian3.dot(c,o);if(Math.abs(u)<s.CesiumMath.EPSILON15)return;const l=(-e.distance-n.Cartesian3.dot(c,r))/u;return l<0?void 0:(a=n.Cartesian3.multiplyByScalar(o,l,a),n.Cartesian3.add(r,a,a))}},R=new n.Cartesian3,S=new n.Cartesian3,O=new n.Cartesian3,x=new n.Cartesian3,y=new n.Cartesian3;w.rayTriangleParametric=function(t,e,i,r,o){o=a.defaultValue(o,!1);const c=t.origin,u=t.direction,l=n.Cartesian3.subtract(i,e,R),C=n.Cartesian3.subtract(r,e,S),M=n.Cartesian3.cross(u,C,O),h=n.Cartesian3.dot(l,M);let m,d,f,g,p;if(o){if(h<s.CesiumMath.EPSILON6)return;if(m=n.Cartesian3.subtract(c,e,x),f=n.Cartesian3.dot(m,M),f<0||f>h)return;if(d=n.Cartesian3.cross(m,l,y),g=n.Cartesian3.dot(u,d),g<0||f+g>h)return;p=n.Cartesian3.dot(C,d)/h}else{if(Math.abs(h)<s.CesiumMath.EPSILON6)return;const t=1/h;if(m=n.Cartesian3.subtract(c,e,x),f=n.Cartesian3.dot(m,M)*t,f<0||f>1)return;if(d=n.Cartesian3.cross(m,l,y),g=n.Cartesian3.dot(u,d)*t,g<0||f+g>1)return;p=n.Cartesian3.dot(C,d)*t}return p},w.rayTriangle=function(t,e,a,r,s,o){const c=w.rayTriangleParametric(t,e,a,r,s);if(i.defined(c)&&!(c<0))return i.defined(o)||(o=new n.Cartesian3),n.Cartesian3.multiplyByScalar(t.direction,c,o),n.Cartesian3.add(t.origin,o,o)};const P=new p;w.lineSegmentTriangle=function(t,e,a,r,s,o,c){const u=P;n.Cartesian3.clone(t,u.origin),n.Cartesian3.subtract(e,t,u.direction),n.Cartesian3.normalize(u.direction,u.direction);const l=w.rayTriangleParametric(u,a,r,s,o);if(!(!i.defined(l)||l<0||l>n.Cartesian3.distance(t,e)))return i.defined(c)||(c=new n.Cartesian3),n.Cartesian3.multiplyByScalar(u.direction,l,c),n.Cartesian3.add(u.origin,c,c)};const N={root0:0,root1:0};function b(t,e,a){i.defined(a)||(a=new r.Interval);const s=t.origin,o=t.direction,c=e.center,u=e.radius*e.radius,l=n.Cartesian3.subtract(s,c,O),C=function(t,n,e,a){const i=n*n-4*t*e;if(i<0)return;if(i>0){const e=1/(2*t),r=Math.sqrt(i),s=(-n+r)*e,o=(-n-r)*e;return s<o?(a.root0=s,a.root1=o):(a.root0=o,a.root1=s),a}const r=-n/(2*t);return 0!==r?(a.root0=a.root1=r,a):void 0}(n.Cartesian3.dot(o,o),2*n.Cartesian3.dot(o,l),n.Cartesian3.magnitudeSquared(l)-u,N);if(i.defined(C))return a.start=C.root0,a.stop=C.root1,a}w.raySphere=function(t,n,e){if(e=b(t,n,e),i.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};const q=new p;w.lineSegmentSphere=function(t,e,a,r){const s=q;n.Cartesian3.clone(t,s.origin);const o=n.Cartesian3.subtract(e,t,s.direction),c=n.Cartesian3.magnitude(o);if(n.Cartesian3.normalize(o,o),r=b(s,a,r),!(!i.defined(r)||r.stop<0||r.start>c))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,c),r};const L=new n.Cartesian3,I=new n.Cartesian3;function E(t,n,e){const a=t+n;return s.CesiumMath.sign(t)!==s.CesiumMath.sign(n)&&Math.abs(a/Math.max(Math.abs(t),Math.abs(n)))<e?0:a}w.rayEllipsoid=function(t,e){const a=e.oneOverRadii,i=n.Cartesian3.multiplyComponents(a,t.origin,L),s=n.Cartesian3.multiplyComponents(a,t.direction,I),o=n.Cartesian3.magnitudeSquared(i),c=n.Cartesian3.dot(i,s);let u,l,C,M,h;if(o>1){if(c>=0)return;const t=c*c;if(u=o-1,l=n.Cartesian3.magnitudeSquared(s),C=l*u,t<C)return;if(t>C){M=c*c-C,h=-c+Math.sqrt(M);const t=h/l,n=u/h;return t<n?new r.Interval(t,n):{start:n,stop:t}}const e=Math.sqrt(u/l);return new r.Interval(e,e)}return o<1?(u=o-1,l=n.Cartesian3.magnitudeSquared(s),C=l*u,M=c*c-C,h=-c+Math.sqrt(M),new r.Interval(0,h/l)):c<0?(l=n.Cartesian3.magnitudeSquared(s),new r.Interval(0,-c/l)):void 0};const v=new n.Cartesian3,z=new n.Cartesian3,T=new n.Cartesian3,U=new n.Cartesian3,W=new n.Cartesian3,B=new o.Matrix3,V=new o.Matrix3,Z=new o.Matrix3,A=new o.Matrix3,D=new o.Matrix3,F=new o.Matrix3,G=new o.Matrix3,Y=new n.Cartesian3,_=new n.Cartesian3,j=new e.Cartographic;w.grazingAltitudeLocation=function(t,e){const a=t.origin,r=t.direction;if(!n.Cartesian3.equals(a,n.Cartesian3.ZERO)){const t=e.geodeticSurfaceNormal(a,v);if(n.Cartesian3.dot(r,t)>=0)return a}const c=i.defined(this.rayEllipsoid(t,e)),u=e.transformPositionToScaledSpace(r,v),C=n.Cartesian3.normalize(u,u),M=n.Cartesian3.mostOrthogonalAxis(u,U),h=n.Cartesian3.normalize(n.Cartesian3.cross(M,C,z),z),m=n.Cartesian3.normalize(n.Cartesian3.cross(C,h,T),T),d=B;d[0]=C.x,d[1]=C.y,d[2]=C.z,d[3]=h.x,d[4]=h.y,d[5]=h.z,d[6]=m.x,d[7]=m.y,d[8]=m.z;const f=o.Matrix3.transpose(d,V),p=o.Matrix3.fromScale(e.radii,Z),w=o.Matrix3.fromScale(e.oneOverRadii,A),R=D;R[0]=0,R[1]=-r.z,R[2]=r.y,R[3]=r.z,R[4]=0,R[5]=-r.x,R[6]=-r.y,R[7]=r.x,R[8]=0;const S=o.Matrix3.multiply(o.Matrix3.multiply(f,w,F),R,F),O=o.Matrix3.multiply(o.Matrix3.multiply(S,p,G),d,G),x=o.Matrix3.multiplyByVector(S,a,W),y=function(t,e,a,i,r){const c=i*i,u=r*r,C=(t[o.Matrix3.COLUMN1ROW1]-t[o.Matrix3.COLUMN2ROW2])*u,M=r*(i*E(t[o.Matrix3.COLUMN1ROW0],t[o.Matrix3.COLUMN0ROW1],s.CesiumMath.EPSILON15)+e.y),h=t[o.Matrix3.COLUMN0ROW0]*c+t[o.Matrix3.COLUMN2ROW2]*u+i*e.x+a,m=u*E(t[o.Matrix3.COLUMN2ROW1],t[o.Matrix3.COLUMN1ROW2],s.CesiumMath.EPSILON15),d=r*(i*E(t[o.Matrix3.COLUMN2ROW0],t[o.Matrix3.COLUMN0ROW2])+e.z);let f;const p=[];if(0===d&&0===m){if(f=l.computeRealRoots(C,M,h),0===f.length)return p;const t=f[0],e=Math.sqrt(Math.max(1-t*t,0));if(p.push(new n.Cartesian3(i,r*t,r*-e)),p.push(new n.Cartesian3(i,r*t,r*e)),2===f.length){const t=f[1],e=Math.sqrt(Math.max(1-t*t,0));p.push(new n.Cartesian3(i,r*t,r*-e)),p.push(new n.Cartesian3(i,r*t,r*e))}return p}const w=d*d,R=m*m,S=d*m,O=C*C+R,x=2*(M*C+S),y=2*h*C+M*M-R+w,P=2*(h*M-S),N=h*h-w;if(0===O&&0===x&&0===y&&0===P)return p;f=g.computeRealRoots(O,x,y,P,N);const b=f.length;if(0===b)return p;for(let t=0;t<b;++t){const e=f[t],a=e*e,o=Math.max(1-a,0),c=Math.sqrt(o);let u;u=s.CesiumMath.sign(C)===s.CesiumMath.sign(h)?E(C*a+h,M*e,s.CesiumMath.EPSILON12):s.CesiumMath.sign(h)===s.CesiumMath.sign(M*e)?E(C*a,M*e+h,s.CesiumMath.EPSILON12):E(C*a+M*e,h,s.CesiumMath.EPSILON12);const l=u*E(m*e,d,s.CesiumMath.EPSILON15);l<0?p.push(new n.Cartesian3(i,r*e,r*c)):l>0?p.push(new n.Cartesian3(i,r*e,r*-c)):0!==c?(p.push(new n.Cartesian3(i,r*e,r*-c)),p.push(new n.Cartesian3(i,r*e,r*c)),++t):p.push(new n.Cartesian3(i,r*e,r*c))}return p}(O,n.Cartesian3.negate(x,v),0,0,1);let P,N;const b=y.length;if(b>0){let t=n.Cartesian3.clone(n.Cartesian3.ZERO,_),i=Number.NEGATIVE_INFINITY;for(let e=0;e<b;++e){P=o.Matrix3.multiplyByVector(p,o.Matrix3.multiplyByVector(d,y[e],Y),Y);const s=n.Cartesian3.normalize(n.Cartesian3.subtract(P,a,U),U),c=n.Cartesian3.dot(s,r);c>i&&(i=c,t=n.Cartesian3.clone(P,t))}const u=e.cartesianToCartographic(t,j);return i=s.CesiumMath.clamp(i,0,1),N=n.Cartesian3.magnitude(n.Cartesian3.subtract(t,a,U))*Math.sqrt(1-i*i),N=c?-N:N,u.height=N,e.cartographicToCartesian(u,new n.Cartesian3)}};const k=new n.Cartesian3;w.lineSegmentPlane=function(t,e,a,r){i.defined(r)||(r=new n.Cartesian3);const o=n.Cartesian3.subtract(e,t,k),c=a.normal,u=n.Cartesian3.dot(c,o);if(Math.abs(u)<s.CesiumMath.EPSILON6)return;const l=n.Cartesian3.dot(c,t),C=-(a.distance+l)/u;return C<0||C>1?void 0:(n.Cartesian3.multiplyByScalar(o,C,r),n.Cartesian3.add(t,r,r),r)},w.trianglePlaneIntersection=function(t,e,a,i){const r=i.normal,s=i.distance,o=n.Cartesian3.dot(r,t)+s<0,c=n.Cartesian3.dot(r,e)+s<0,u=n.Cartesian3.dot(r,a)+s<0;let l,C,M=0;if(M+=o?1:0,M+=c?1:0,M+=u?1:0,1!==M&&2!==M||(l=new n.Cartesian3,C=new n.Cartesian3),1===M){if(o)return w.lineSegmentPlane(t,e,i,l),w.lineSegmentPlane(t,a,i,C),{positions:[t,e,a,l,C],indices:[0,3,4,1,2,4,1,4,3]};if(c)return w.lineSegmentPlane(e,a,i,l),w.lineSegmentPlane(e,t,i,C),{positions:[t,e,a,l,C],indices:[1,3,4,2,0,4,2,4,3]};if(u)return w.lineSegmentPlane(a,t,i,l),w.lineSegmentPlane(a,e,i,C),{positions:[t,e,a,l,C],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===M){if(!o)return w.lineSegmentPlane(e,t,i,l),w.lineSegmentPlane(a,t,i,C),{positions:[t,e,a,l,C],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return w.lineSegmentPlane(a,e,i,l),w.lineSegmentPlane(t,e,i,C),{positions:[t,e,a,l,C],indices:[2,0,4,2,4,3,1,3,4]};if(!u)return w.lineSegmentPlane(t,a,i,l),w.lineSegmentPlane(e,a,i,C),{positions:[t,e,a,l,C],indices:[0,1,4,0,4,3,2,3,4]}}};var H=w;t.IntersectionTests=H,t.Ray=p}));
