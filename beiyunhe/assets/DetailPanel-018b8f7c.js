import{_ as ie}from"./return_icon-1226930e.js";import{_ as ue}from"./rightArr-ad89d80a.js";import{_ as ce}from"./tb-7f100319.js";import{_ as de,e as me,u as fe,f as c,J as h,g as pe,r as u,o as _,c as S,a as s,t as P,b as a,w as n,v as w,x as q,C as ve,F as ge,i as _e,A as x}from"./index-267246aa.js";import{D as Ae}from"./DialogView-3471b073.js";import{D as be}from"./DialyLog-424f1f79.js";import{D as ke}from"./dialogDynamotorSheet-37e78b1c.js";import{i as ye,j as he,k as Ie}from"./patrolGuard-eead8834.js";import{a as T,b as De}from"./securityManagementAPI-1e058741.js";import"./engineeringAPI-b1b8a18c.js";import"./axios-da025460.js";import"./unit-ac192840.js";import"./index-1899286b.js";const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABddJREFUWEftVm1sVGUWfs477QwtdaGgskbFDSo/1GRFUZaP7FK1lLkDdmZMmiioYFQ0KpuVFaVzZz/oTAusCUrWXQoq66IhoumdUnqnRWRI3PpJ/IomGqOR1TVBXVsxSz9m7vvsvtNOAmXagf3DH99/M/ec533e8/GcIzjDR87w/fiRQNEIJFLuUmi5USk4jeGgezpp2k36/rn3YPWaJQu/ExFdyvckAk1OuhnU64yjiFAgt8UiwWfHA2rZ+0p1LvvD7wEuAnExAD8gAxAc8Al2zJ1UkaqpqckVwziBQNJJ362pWyH4VkQ2kmgBkfOV+2Y1Lq37qBhAsr2zllp2kZwqgAeRLwhMAfmTkUekVQC3N1rWNyUJNDmdO0EsF5E/2xHrgURb+hFCt4jgL3YkdN9ogBYn/bMc+N7IZZurpHJ9Pweu08IX85cT8cZIsNlEcqwInhCB5pR7mUf2gJisRK0iWElys4g8Y0esFaNBEo77N5K3C9STdjR4F0lJOO5XAH4qUA12NPhCwSfhpG8WJUdj9Ys7j8c5qQaSjhvUwB6QZYU6oNKJeP2S3x3vuMV1A0cH8W+CMikg5622rKMb9rw0PZsbOgzgvXg0dGXBPul0NWh6O0XJ03bYundcAuZjc5v7Kw38msLpArmSAEWkwQ4HnYJzc6p7jqdzr4uS1+2wNdf839pxqPLr7JFeQLTy+66ZPNH/eW9v/zqCjcN+0hOPWgtKEjjeIJnqvEVr7ASQUz5f1ITwiUymqrevP0NytogcsCPW9QWfJsd9FOQaAKYFTeX7BfI9wUki8oUdsaafFgFjnHTSKwg+DWAI4DIAa0lcKyKf+QOBRWut6z8tgJJUyVRXI6jvhEgViYwPfMYDOkTwrh0JzTptAiMk7ia4laSpaAXBK5MCssTkvpTYJFLp1dT6cQX1RCwavP//ItCyd/+MXHboTZBTIdg3cVp1+MF58/pLXT7i944AZ0HxWrs+dOi0CST3dl/BIW8fwfNE5PlzLjz31lWzZ2fHuzyTyZT19A4so+j1IKaLyDY7Yq0a7VNyGg5Xu+cCnCJKtsbqg/eNpfHJjq6rdM7bRnKiQGYMSzIgkOfmV1esKCbH4xJoSnXdAK0dgFWisMEOh/IzothJtnXfoZHbnq+P/BzBD6Rk4FN/jdcv7hrLb0wCiVQ6AtJofEBEHrYj1qaxQJrb0lFPuAukX0Q8Ed7WWG/tGk+CC1hFCeTbjvpJmuhB7olHLfOyoqcp1blSNLYbW1F8ClR3/q9Nj0Fx4eiCKwZwshS3d9Voz9svMC9Ry2ORxbvHDLvjPkZgtZmYgCwz2p9sSz+koTcB8nWZ3z933ZIbPhuvWE8gYJaJj5305wAvEKWix0vvaJAmx10PMj5SZN+UT8BVD1vWl8Oa4W7R5AMAPqkor5z326U1355SDbS0u7NyHt8WkbQdsaxEe+dsavmNUrIxVh9834CYiZdMpbeQvB+CPiF6CIQE+KDsLP+CR2prvx9Ww/RukjdB8MYFkysXrqypGSiZgmbHDXukGTib49HQg4mUu42adxV+m97+R9+xHcM7A46Ulfnq5lQFPuzp699DMigiB2fOvKiu4fLLh3ZkMhP+1df/EskFStQfYpHgH0sTMPuA5oeGdTwS+kVLe9clnqdXIhDYdn6lOvJlb//zAG8U4LC/vLx27dJFnxhQM5y+6zt2EMTVRqhi4eDNpgOa2zpnesDHo8fzmEqYXyhS7msg5pi+n1lv2Q0iXqLz5YswOPB3Ar8U4KPyCVJbyHcBLNm+fxq9wVcJzBBgy/zqyjWv9fbP98CDInjTjoTmlIyAMdjQ0fXzbFYfMMqXzzHkK5KXjCyab1WUV1hjFdWmjn2XDuayr4I42+yVIKbkhUmpe+LhYOspETBGiY6Xz2d28DEA1+UlGDgsgtazL5z2aKkZkE+b1kYXFoA4qhQ2xcLWxlPqgmJGf+runvhQXd1/xuvlYt9aDx0qL0V2uIXP8PmRwH8Beh6mPyVNUDIAAAAASUVORK5CYII=";const Se={class:"detail"},we={class:"row"},Ue={class:"form"},Fe={class:"text"},Ne={class:"form"},Ve={class:"text"},ze={class:"bt"},Pe={class:"fill"},qe={class:"left"},xe={class:"middle"},Te={class:"img-list"},Je=["src"],Be={class:"right"},Le={class:"select-list"},We={__name:"DetailPanel",setup(Re){const U=me(),F=fe(),k=c(!1),N=c({}),V=c(),A=c([]),d=c(0),y=c(!1),I=c(),m=h({formId:"",formType:""});let D=h({});const J=c(!1),g=h({name:"巡查任务",userName:"王一博",status:""}),l=h({name:"巡查任务",userName:"王一博",areas:"",formId:"",card:"",point:"",pictures:"",status:"",mark:""}),f=c([]),z=c(""),B=(t,e)=>{console.log(t,e)},L=async(t,e)=>{console.log(t,e);const o=new FormData;o.append("file",t.file);const{code:i,data:p}=await he(o),v=f.value.length,b=v?v-1:0;if(i===1)f.value[b]={name:p.fileName,url:p.fileUrl};else return f.value.slice(b+1),x.error("上传失败"),!1;return!0};function W(t){console.log(t)}function R(){F.push("/patrolGuard/waitInspect/view")}function j(t){d.value=t,m.formId="",m.formType=""}function E(){I.value.resetFields()}function Y(){return f.value.map(e=>e.url).join(",")}function Q(t){l.status=String(t.eqStatus),l.mark=t.mark,l.formId=t.formId,l.formType=t.formType,t.pictures===""?f.value=[]:f.value=X(t.pictures),console.log(l.pictures.length)}function X(t){return!t||t==""?[]:t.split(",").map(e=>({name:e,url:e}))}async function M(){try{const{code:t,data:e}=await ye({taskId:g.formId});if(t===1){if(e.length<1||!e)return;const o=e[0];o&&(Q(o),A.value[0].finish=!0)}}catch(t){console.log(t)}}function H(){try{console.log(f.value),I.value.validate(async t=>{if(!t)return;console.log(d.value);const e=ee(d.value),o={formId:m.formId,formType:m.formType,taskId:g.formId,eqStatus:Number(l.status),mark:l.mark,point:e,areas:"",pictures:Y()},{code:i,data:p}=await Ie(o);i===1&&(x({message:`完成${e}点位巡查`,type:"success"}),d.value=d.value+1,A.value[d.value].finish=!0,console.log(p))})}catch(t){console.error("获取数据失败",t)}}function C(t){if(D.id=l.formId,t==="dialy"){k.value=!0;return}y.value=!0}const K=()=>{y.value=!1};async function O(){try{const t=q(V.value.formData);let e=T;m.formId!=""?e=De:e=T;const{code:o,data:i}=await e(t);o===1&&(N.value=i,m.formId=i==null?void 0:i.id,m.formType=0,J.value=!0,k.value=!1)}catch(t){console.log(t)}}const Z=t=>{y.value=!1,console.log(t),D=t,m.formId=t.id,m.formType=1};function G(t){if(d.value>t.value-1&&t.finish)return"success";if(d.value<t.value-1)return"process";if(t.finish)return"finish"}function $(t){return t.split("、").map((i,p)=>({label:i,value:p,finish:!1}))}function ee(t){return A.value[t].label}return pe(()=>{var t;try{g.formId=(t=U.query)==null?void 0:t.id;const e=localStorage.getItem("inspectData"),o=JSON.parse(e);g.name=o.name,g.userName=o.userName,g.status=o.status,M(),A.value=$(o.content),console.log(U,F)}catch(e){console.log(e)}}),(t,e)=>{const o=u("el-step"),i=u("el-steps"),p=u("el-tooltip"),v=u("el-form-item"),b=u("el-radio"),te=u("el-radio-group"),se=u("Plus"),oe=u("el-icon"),ae=u("el-upload"),le=u("el-input"),re=u("el-form"),ne=u("el-popover");return _(),S("div",Se,[s("div",{class:"header"},[e[6]||(e[6]=s("div",{class:"img"},null,-1)),e[7]||(e[7]=s("span",{class:"title"},"办理",-1)),s("div",{class:"plan",onClick:R},e[5]||(e[5]=[s("img",{src:ie,alt:""},null,-1),s("span",{class:"text"},"返回",-1)]))]),s("div",we,[s("div",Ue,[e[8]||(e[8]=s("label",{for:""},"任务名称",-1)),s("span",Fe,P(l.name),1)]),s("div",Ne,[e[9]||(e[9]=s("label",{for:""},"巡查人员",-1)),s("span",Ve,P(l.userName),1)])]),s("div",ze,[e[13]||(e[13]=s("div",{class:"tip"},[s("img",{src:ue,alt:"",srcset:""}),s("span",{class:"title"},"巡查点位")],-1)),s("div",Pe,[s("div",qe,[a(i,{class:"custom-steps",direction:"vertical",active:d.value},{default:n(()=>[(_(!0),S(ge,null,_e(A.value,r=>(_(),w(o,{onClick:je=>j(r.value),status:G(r),title:r.label,key:r.label},null,8,["onClick","status","title"]))),128))]),_:1},8,["active"])]),s("div",xe,[a(re,{class:"custom-form",ref_key:"formRef",ref:I,model:l,"label-width":"150px","label-position":"right"},{default:n(()=>[a(v,{label:"巡检打卡",prop:"card"},{default:n(()=>[a(p,{title:"不支持"},{default:n(()=>e[10]||(e[10]=[s("div",{class:"card"},"打卡",-1)])),_:1})]),_:1}),a(v,{label:"设备设施状态",prop:"status",required:""},{default:n(()=>[a(te,{class:"radio-select",modelValue:l.status,"onUpdate:modelValue":e[0]||(e[0]=r=>l.status=r)},{default:n(()=>[a(b,{label:"正常",value:"1"}),a(b,{label:"不正常",value:"0"})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"照片",prop:"pictures"},{default:n(()=>[s("div",Te,[a(ae,{class:"avatar-uploader",accept:"image/*","auto-upload":"false",action:"","file-list":f.value,"onUpdate:fileList":e[1]||(e[1]=r=>f.value=r),"list-type":"picture-card","on-change":W,"http-request":L,"on-success":B},{default:n(()=>[z.value?(_(),S("img",{key:0,src:z.value,class:"avatar"},null,8,Je)):(_(),w(oe,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[a(se)]),_:1}))]),_:1},8,["file-list"])])]),_:1}),a(v,{label:"描述",prop:"mark"},{default:n(()=>[a(le,{class:"custom-input",modelValue:l.mark,"onUpdate:modelValue":e[2]||(e[2]=r=>l.mark=r),type:"textarea"},null,8,["modelValue"])]),_:1}),s("div",{class:"footer"},[s("div",{class:"reset-btn",onClick:E},"取消"),s("div",{class:"search-btn",onClick:H},"确定")])]),_:1},8,["model"])]),s("div",Be,[s("div",{class:"btn gray",onClick:C},e[11]||(e[11]=[s("img",{src:Ce,alt:""},null,-1),s("span",{class:"text"},"一键报修",-1)])),a(ne,{placement:"bottom",trigger:"hover"},{reference:n(()=>e[12]||(e[12]=[s("div",{class:"btn",style:{"margin-top":"15px"}},[s("img",{src:ce,alt:""}),s("span",{class:"text"},"填报表单")],-1)])),default:n(()=>[s("div",Le,[s("div",{class:"select-btn",onClick:e[3]||(e[3]=r=>C("dialy"))},"日常检查运行记录"),s("div",{class:"select-btn",onClick:C},"发电机检查运行记录")])]),_:1})])])]),a(Ae,{width:"70%",visible:k.value,title:"记录表","onUpdate:visible":e[4]||(e[4]=r=>k.value=r),onSubmit:O},{default:n(()=>[a(be,{ref_key:"sheetTabe",ref:V,data:N.value},null,8,["data"])]),_:1},8,["visible"]),y.value?(_(),w(ke,{key:0,data:q(D),onCloseSheet:K,onSubSheet:Z},null,8,["data"])):ve("",!0)])}}},st=de(We,[["__scopeId","data-v-0b19c621"]]);export{st as default};
