import{_ as te}from"./zdjh-bc3a60d2.js";import{_ as ae}from"./fb-38cdc08b.js";import{_ as Q,J as j,f,s as G,r as d,o as _,v as T,w as n,a as i,t as A,b as t,c as S,i as H,F as E,x as K,u as le,bq as oe,D as ne,d as $,C as se}from"./index-267246aa.js";import{g as re}from"./securityManagementAPI-1e058741.js";import{g as ie,a as ue,b as de,c as ce,d as me,e as pe}from"./patrolGuard-eead8834.js";import{D as fe}from"./DialogView-3471b073.js";import"./axios-da025460.js";import"./index-1899286b.js";const ge={class:"title"},_e={__name:"DetailModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:""},data:{default:{name:"",content:[""],userName:"",userId:"",time:""}},onSubmit:{default:()=>{}}},emits:["update:visible"],setup(q,{emit:B}){const h=q,k=B,g=j({total:20,pageNum:1,pageSize:20}),z=f([]),D=f([]),M=f(),N=G(()=>h.visible),u=G(()=>{let s=h.data;return typeof s.content=="string"&&(s.content=s.content.split("、")),s}),C=f({name:[{required:!0,message:"请输入巡查计划名称",trigger:"blur"}],content:[{required:!0,message:"请选择巡查点位",trigger:"change"}],userId:[{required:!0,message:"请选择巡查人员",trigger:"change"}],time:[{type:"date",required:!0,message:"请选择巡查日期",trigger:"change"}]});async function v(){const s=await m("point",{current:g.pageNum,size:g.pageSize});s&&(z.value=s)}v();async function Y(){const s=await m("user",{current:g.pageNum,size:g.pageSize});s&&(D.value=s.records)}Y();async function m(s,l){const b={point:ie,user:re};try{const c=b[s],{code:y,data:V}=await c(l);return y===1?V:!1}catch(c){return console.error(`${s}操作失败`,c),!1}}function p(){k("update:visible",!1)}function O(){M.value.validate(s=>{if(s){let l=K(u);l.userName=D.value.filter(b=>b.id===l.userId)[0].name,Array.isArray(l.content)&&(l.content=l.content.join("、")),h.onSubmit(K(l))}else return console.log("error submit!!"),!1})}return(s,l)=>{const b=d("el-input"),c=d("el-form-item"),y=d("el-option"),V=d("el-select"),R=d("el-date-picker"),F=d("el-form"),L=d("el-dialog");return _(),T(L,{modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=r=>N.value=r),"before-close":p,class:"custom-dialog","append-to-body":!0,width:"30%"},{header:n(()=>[i("div",ge,A(q.title),1)]),footer:n(()=>[i("div",{class:"dialog-footer flex content-center"},[i("div",{class:"reset-btn",onClick:p},"取 消"),i("div",{class:"search-btn",type:"primary",onClick:O},"确 定")])]),default:n(()=>[t(F,{model:u.value,"label-width":"auto",rules:C.value,"label-position":"left",ref_key:"formRef",ref:M,class:"custom-form"},{default:n(()=>[t(c,{label:"巡查计划名称",prop:"name"},{default:n(()=>[t(b,{class:"custom-input",modelValue:u.value.name,"onUpdate:modelValue":l[0]||(l[0]=r=>u.value.name=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"巡查点位",prop:"content"},{default:n(()=>[t(V,{class:"custom-select","popper-class":"custom-select",modelValue:u.value.content,"onUpdate:modelValue":l[1]||(l[1]=r=>u.value.content=r),multiple:""},{default:n(()=>[(_(!0),S(E,null,H(z.value,r=>(_(),T(y,{label:r.name,value:r.name,key:r.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"巡查人员",prop:"userId"},{default:n(()=>[t(V,{modelValue:u.value.userId,"onUpdate:modelValue":l[2]||(l[2]=r=>u.value.userId=r)},{default:n(()=>[(_(!0),S(E,null,H(D.value,r=>(_(),T(y,{label:r.name,value:r.id,key:r.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"巡查日期",prop:"time"},{default:n(()=>[t(R,{type:"date",class:"custom-input","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},modelValue:u.value.time,"onUpdate:modelValue":l[3]||(l[3]=r=>u.value.time=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}},ve=Q(_e,[["__scopeId","data-v-462b69ca"]]);const be={class:"control"},ye={class:"table"},we={class:"table-cell"},ke={class:"table-page"},Ve={class:"upload"},he={key:0,src:ae,alt:"",srcset:""},De={__name:"view",setup(q){const B=new Date().getFullYear().toString(),h=new Date().getMonth()-1,k=f("upload"),g=f("发布"),z=le(),D=[{prop:"time",label:"巡查日期"},{prop:"name",label:"巡查计划名称",width:"120px"},{prop:"userName",label:"巡查人员"},{prop:"content",label:"巡查点位"}],M=[{time:"2024-03-09 18:00:00",name:"日常巡查",status:"待发布",userName:"白海龙",content:"启闭机、电气设备、视频监控"},{time:"2024-03-09 18:00:00",name:"日常巡查",status:"未发布",userName:"白海龙",content:"启闭机、电气设备、视频监控"},{time:"2024-03-09 18:00:00",name:"日常巡查",status:"已发布",userName:"白海龙",content:"启闭机、电气设备、视频监控"}],N=f(),u=f(!1),C=f({}),v=f(!1),Y=f(M),m=j({time:"",month:B+"-"+h,name:"",userName:""}),p=j({total:20,pageNum:1,pageSize:15});oe(p);function O(o){return{color:""+{待发布:"#19deff",未发布:"#ffc002",已发布:"#19ffa1"}[o]}}function s(o){return["未发布","已发布"][o]}function l(o,e){switch(k.value=e,C.value=JSON.parse(JSON.stringify(o)),e){case"upload":g.value="发布",v.value=!0;break;case"delete":g.value="删除",v.value=!0;break;default:u.value=!0}}function b(o){localStorage.setItem("inspectData",JSON.stringify(o)),z.push({path:"/patrolGuard/finishInspect/detail",query:{id:o.id,back:"inspectPlan"}})}async function c(){try{const{code:o,data:e}=await ue({current:p.pageNum,size:p.pageSize,name:m.name,time:m.time,sortParam:"time",userName:m.userName});console.log(e),o===1&&(p.total=e.total,Y.value=e.records)}catch(o){console.error("获取数据失败",o)}}async function y(o,e){const J={create:de,edit:ce,upload:me,delete:pe};try{const w=J[o],{code:U}=await w(e);return U===1?(await c(),!0):!1}catch(w){return console.error(`${o}操作失败`,w),!1}}function V(o){const e=k.value==="create"?"create":"edit";y(e,o),u.value=!1}function R(){const o=C.value,e=k.value==="upload"?"upload":"delete";y(e,o),v.value=!1}function F(o){p.pageSize=o,c()}function L(o){p.pageNum=o,c()}function r(){p.pageNum=1,c()}function W(){N.value.resetFields()}return c(),(o,e)=>{const J=d("el-date-picker"),w=d("el-form-item"),U=d("el-input"),X=d("el-form"),P=d("el-table-column"),I=d("el-button"),Z=d("el-table"),ee=d("el-pagination");return _(),S("div",null,[i("div",be,[t(X,{inline:!0,model:m,"label-width":"auto","label-position":"left",ref_key:"formRef",ref:N,class:"custom-form"},{default:n(()=>[t(w,{label:"日期",prop:"time"},{default:n(()=>[t(J,{style:{width:"185px"},modelValue:m.time,"onUpdate:modelValue":e[0]||(e[0]=a=>m.time=a),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","popper-class":"custom-select",type:"date"},null,8,["modelValue"])]),_:1}),t(w,{label:"计划名称",prop:"name"},{default:n(()=>[t(U,{class:"custom-input",modelValue:m.name,"onUpdate:modelValue":e[1]||(e[1]=a=>m.name=a)},null,8,["modelValue"])]),_:1}),t(w,{label:"巡查人员",prop:"userName"},{default:n(()=>[t(U,{class:"custom-input",modelValue:m.userName,"onUpdate:modelValue":e[2]||(e[2]=a=>m.userName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),i("div",{class:"searchBar-btns"},[i("div",{class:"reset-btn",onClick:W},"重置"),i("div",{class:"search-btn",onClick:r},"查询")]),i("div",{class:"plan",onClick:e[3]||(e[3]=a=>l({},"create"))},e[6]||(e[6]=[i("img",{src:te,alt:""},null,-1),i("span",{class:"text"},"制定巡查计划",-1)]))]),i("div",ye,[t(Z,{data:Y.value,class:"custom-table deep","max-height":"72vh","highlight-current-row":""},{default:n(()=>[t(P,{type:"index",label:"序号",align:"center",width:"70"}),(_(),S(E,null,H(D,(a,x)=>t(P,{key:x,prop:a.prop,label:a.label,width:a.width,align:"center","show-overflow-tooltip":""},null,8,["prop","label","width"])),64)),t(P,{label:"状态",align:"center",width:"120"},{default:n(a=>[i("div",{class:"tag",style:ne(O(s(a.row.status)))},A(s(a.row.status)),5)]),_:1}),t(P,{label:"操作",align:"center",width:"180"},{default:n(a=>[i("div",we,[t(I,{type:"primary",text:"",onClick:x=>l(a.row,"edit"),link:"",disabled:!!a.row.status},{default:n(()=>e[7]||(e[7]=[$("编辑")])),_:2},1032,["onClick","disabled"]),t(I,{type:"primary",text:"",onClick:x=>b(a.row),link:""},{default:n(()=>e[8]||(e[8]=[$("详情")])),_:2},1032,["onClick"]),t(I,{type:"primary",text:"",onClick:x=>l(a.row,"upload"),link:"",disabled:!!a.row.status},{default:n(()=>e[9]||(e[9]=[$("发布")])),_:2},1032,["onClick","disabled"]),t(I,{type:"danger",text:"",onClick:x=>l(a.row,"delete"),link:"",disabled:!!a.row.status},{default:n(()=>e[10]||(e[10]=[$("删除")])),_:2},1032,["onClick","disabled"])])]),_:1})]),_:1},8,["data"]),i("div",ke,[t(ee,{class:"custom-pagination",onSizeChange:F,onCurrentChange:L,"current-page":p.pageNum,"page-size":p.pageSize,layout:"total, prev, pager, next, jumper",total:p.total,background:""},null,8,["current-page","page-size","total"])])]),t(ve,{visible:u.value,title:"巡查计划",data:C.value,onSubmit:V,"onUpdate:visible":e[4]||(e[4]=a=>u.value=a)},null,8,["visible","data"]),t(fe,{visible:v.value,title:g.value,onSubmit:R,"onUpdate:visible":e[5]||(e[5]=a=>v.value=a)},{default:n(()=>[i("div",Ve,[k.value==="upload"?(_(),S("img",he)):se("",!0),i("span",null,"请确认，是否"+A(g.value)+"此计划",1)])]),_:1},8,["visible","title"])])}}},Pe=Q(De,[["__scopeId","data-v-731f3da0"]]);export{Pe as default};
