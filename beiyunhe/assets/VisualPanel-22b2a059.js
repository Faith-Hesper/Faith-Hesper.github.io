import{A as ke,V as be,_ as Ve,a as De}from"./AlertInfo-7b6acee0.js";import{_ as he,f as L,s as Q,g as Be,k as Ue,r as q,o as X,v as Ee,w as N,a as _,t as ue,b as E,u as We,J as Ye,c as $,F as qe,i as He}from"./index-267246aa.js";import{D as ze}from"./DialogView-3471b073.js";import{V as Xe}from"./VideoPlayer-d1de450a.js";import{C as Ke,B as W,D as Qe,H as je,u as se,l as Y,J as Je,K as Ze,N as $e,O as et,Q as tt,R as it,G as v,T as rt,W as nt,X as at,Y as st,Z as ot,_ as lt,$ as Te,a0 as Pe,a1 as we,a2 as D,V as de,z as fe,a3 as ht,a4 as xe,a5 as ut,a6 as dt,E as j,a7 as S,a8 as ft,j as z,P as oe,L as ee,o as ct,n as _t,p as pt,a9 as ce,aa as Fe,q as vt,ab as gt,ac as yt,ad as mt,ae as Le,af as Ct,ag as J,ah as Z,ai as O,aj as te,ak as le,w as V,al as B,am as Et,an as Tt,ao as Pt,ap as wt,aq as A,ar as Oe,as as Ie,at as Ne,au as xt,av as Ft,aw as Lt,ax as Ot,h as It,S as Nt,ay as St,A as Mt,M as Se}from"./MapOl-a1e36690.js";import"./swiper_2-b5bbd5a5.js";import"./zrdj-5148eed2.js";import"./xt-2a738f85.js";import"./VideoPlayer.vue_vue_type_style_index_0_scoped_54907636_lang-824477ca.js";const I={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};var Rt=globalThis&&globalThis.__extends||function(){var d=function(n,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},d(n,t)};return function(n,t){d(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),F={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Gt=function(d){Rt(n,d);function n(t){var e=d.call(this)||this;return e.options=t,e.id=t.id,e.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,e.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,e.element=document.createElement("div"),e.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Ke,e.element.style.position="absolute",e.autoPan=t.autoPan!==void 0?t.autoPan:!1,e.autoPanAnimation=t.autoPanAnimation||{},e.autoPanMargin=t.autoPanMargin!==void 0?t.autoPanMargin:20,e.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},e.mapPostrenderListenerKey=null,e.addEventListener(W(F.ELEMENT),e.handleElementChanged),e.addEventListener(W(F.MAP),e.handleMapChanged),e.addEventListener(W(F.OFFSET),e.handleOffsetChanged),e.addEventListener(W(F.POSITION),e.handlePositionChanged),e.addEventListener(W(F.POSITIONING),e.handlePositioningChanged),t.element!==void 0&&e.setElement(t.element),e.setOffset(t.offset!==void 0?t.offset:[0,0]),e.setPositioning(t.positioning!==void 0?t.positioning:I.TOP_LEFT),t.position!==void 0&&e.setPosition(t.position),e}return n.prototype.getElement=function(){return this.get(F.ELEMENT)},n.prototype.getId=function(){return this.id},n.prototype.getMap=function(){return this.get(F.MAP)},n.prototype.getOffset=function(){return this.get(F.OFFSET)},n.prototype.getPosition=function(){return this.get(F.POSITION)},n.prototype.getPositioning=function(){return this.get(F.POSITIONING)},n.prototype.handleElementChanged=function(){Qe(this.element);var t=this.getElement();t&&this.element.appendChild(t)},n.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(je(this.element),se(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=Y(t,Je.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}},n.prototype.render=function(){this.updatePixelPosition()},n.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},n.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(F.POSITION)&&this.autoPan&&this.panIntoView()},n.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},n.prototype.setElement=function(t){this.set(F.ELEMENT,t)},n.prototype.setMap=function(t){this.set(F.MAP,t)},n.prototype.setOffset=function(t){this.set(F.OFFSET,t)},n.prototype.setPosition=function(t){this.set(F.POSITION,t)},n.prototype.panIntoView=function(){var t=this.getMap();if(!(!t||!t.getTargetElement())){var e=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[Ze(i),$e(i)]),a=this.autoPanMargin;if(!et(e,r)){var o=r[0]-e[0],s=e[2]-r[2],h=r[1]-e[1],l=e[3]-r[3],u=[0,0];if(o<0?u[0]=o-a:s<0&&(u[0]=Math.abs(s)+a),h<0?u[1]=h-a:l<0&&(u[1]=Math.abs(l)+a),u[0]!==0||u[1]!==0){var f=t.getView().getCenterInternal(),g=t.getPixelFromCoordinateInternal(f),c=[g[0]+u[0],g[1]+u[1]];t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(c),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},n.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,a=i.top+window.pageYOffset;return[r,a,r+e[0],a+e[1]]},n.prototype.setPositioning=function(t){this.set(F.POSITIONING,t)},n.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},n.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}var i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)},n.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,r=this.getOffset(),a=this.getPositioning();this.setVisible(!0);var o=r[0],s=r[1];if(a==I.BOTTOM_RIGHT||a==I.CENTER_RIGHT||a==I.TOP_RIGHT){this.rendered.left_!==""&&(this.rendered.left_=i.left="");var h=Math.round(e[0]-t[0]-o)+"px";this.rendered.right_!=h&&(this.rendered.right_=i.right=h)}else{this.rendered.right_!==""&&(this.rendered.right_=i.right=""),(a==I.BOTTOM_CENTER||a==I.CENTER_CENTER||a==I.TOP_CENTER)&&(o-=this.element.offsetWidth/2);var l=Math.round(t[0]+o)+"px";this.rendered.left_!=l&&(this.rendered.left_=i.left=l)}if(a==I.BOTTOM_LEFT||a==I.BOTTOM_CENTER||a==I.BOTTOM_RIGHT){this.rendered.top_!==""&&(this.rendered.top_=i.top="");var u=Math.round(e[1]-t[1]-s)+"px";this.rendered.bottom_!=u&&(this.rendered.bottom_=i.bottom=u)}else{this.rendered.bottom_!==""&&(this.rendered.bottom_=i.bottom=""),(a==I.CENTER_LEFT||a==I.CENTER_CENTER||a==I.CENTER_RIGHT)&&(s-=this.element.offsetHeight/2);var f=Math.round(t[1]+s)+"px";this.rendered.top_!=f&&(this.rendered.top_=i.top=f)}},n.prototype.getOptions=function(){return this.options},n}(tt);const At=Gt;var kt=globalThis&&globalThis.__extends||function(){var d=function(n,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},d(n,t)};return function(n,t){d(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Me=function(d){kt(n,d);function n(t,e,i){var r=d.call(this)||this;if(i!==void 0&&e===void 0)r.setFlatCoordinates(i,t);else{var a=e||0;r.setCenterAndRadius(t,a,i)}return r}return n.prototype.clone=function(){return new n(this.flatCoordinates.slice(),void 0,this.layout)},n.prototype.closestPointXY=function(t,e,i,r){var a=this.flatCoordinates,o=t-a[0],s=e-a[1],h=o*o+s*s;if(h<r){if(h===0)for(var l=0;l<this.stride;++l)i[l]=a[l];else{var u=this.getRadius()/Math.sqrt(h);i[0]=a[0]+u*o,i[1]=a[1]+u*s;for(var l=2;l<this.stride;++l)i[l]=a[l]}return i.length=this.stride,h}else return r},n.prototype.containsXY=function(t,e){var i=this.flatCoordinates,r=t-i[0],a=e-i[1];return r*r+a*a<=this.getRadiusSquared_()},n.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},n.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return it(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)},n.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},n.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},n.prototype.getType=function(){return v.CIRCLE},n.prototype.intersectsExtent=function(t){var e=this.getExtent();if(rt(t,e)){var i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:nt(t,this.intersectsCoordinate.bind(this))}return!1},n.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+i;for(var a=1;a<e;++a)r[e+a]=t[a];this.setFlatCoordinates(this.layout,r),this.changed()},n.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var r=this.flatCoordinates,a=at(r,0,t,this.stride);r[a++]=r[0]+e;for(var o=1,s=this.stride;o<s;++o)r[a++]=r[o];r.length=a,this.changed()},n.prototype.getCoordinates=function(){return null},n.prototype.setCoordinates=function(t,e){},n.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},n.prototype.rotate=function(t,e){var i=this.getCenter(),r=this.getStride();this.setCenter(st(i,0,i.length,r,t,e,i)),this.changed()},n.prototype.translate=function(t,e){var i=this.getCenter(),r=this.getStride();this.setCenter(ot(i,0,i.length,r,t,e,i)),this.changed()},n}(lt);Me.prototype.transform;const bt=Me;var Re=globalThis&&globalThis.__extends||function(){var d=function(n,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},d(n,t)};return function(n,t){d(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),y={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},ie={DRAWSTART:"drawstart",DRAWEND:"drawend"},re=function(d){Re(n,d);function n(t,e){var i=d.call(this,t)||this;return i.feature=e,i}return n}(Te),Vt=function(d){Re(n,d);function n(t){var e=this,i=t;i.stopDown||(i.stopDown=Pe),e=d.call(this,i)||this,e.shouldHandle_=!1,e.downPx_=null,e.downTimeout_,e.lastDragTime_,e.freehand_=!1,e.source_=t.source?t.source:null,e.features_=t.features?t.features:null,e.snapTolerance_=t.snapTolerance?t.snapTolerance:12,e.type_=t.type,e.mode_=Bt(e.type_),e.stopClick_=!!t.stopClick,e.minPoints_=t.minPoints?t.minPoints:e.mode_===y.POLYGON?3:2,e.maxPoints_=t.maxPoints?t.maxPoints:1/0,e.finishCondition_=t.finishCondition?t.finishCondition:we;var r=t.geometryFunction;if(!r)if(e.type_===v.CIRCLE)r=function(s,h){var l=h||new bt([NaN,NaN]),u=D(s[0],s[1]);return l.setCenterAndRadius(s[0],Math.sqrt(u)),l};else{var a,o=e.mode_;o===y.POINT?a=oe:o===y.LINE_STRING?a=ee:o===y.POLYGON&&(a=vt),r=function(s,h){var l=h;return l?o===y.POLYGON?s[0].length?l.setCoordinates([s[0].concat([s[0][0]])]):l.setCoordinates([]):l.setCoordinates(s):l=new a(s),l}}return e.geometryFunction_=r,e.dragVertexDelay_=t.dragVertexDelay!==void 0?t.dragVertexDelay:500,e.finishCoordinate_=null,e.sketchFeature_=null,e.sketchPoint_=null,e.sketchCoords_=null,e.sketchLine_=null,e.sketchLineCoords_=null,e.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,e.overlay_=new de({source:new fe({useSpatialIndex:!1,wrapX:t.wrapX?t.wrapX:!1}),style:t.style?t.style:Dt(),updateWhileInteracting:!0}),e.geometryName_=t.geometryName,e.condition_=t.condition?t.condition:ht,e.freehandCondition_,t.freehand?e.freehandCondition_=xe:e.freehandCondition_=t.freehandCondition?t.freehandCondition:ut,e.addEventListener(W(dt.ACTIVE),e.updateState_),e}return n.prototype.setMap=function(t){d.prototype.setMap.call(this,t),this.updateState_()},n.prototype.getOverlay=function(){return this.overlay_},n.prototype.handleEvent=function(t){t.originalEvent.type===j.CONTEXTMENU&&t.preventDefault(),this.freehand_=this.mode_!==y.POINT&&this.freehandCondition_(t);var e=t.type===S.POINTERMOVE,i=!0;if(!this.freehand_&&this.lastDragTime_&&t.type===S.POINTERDRAG){var r=Date.now();r-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)}return this.freehand_&&t.type===S.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(t),i=!1):this.freehand_&&t.type===S.POINTERDOWN?i=!1:e?(i=t.type===S.POINTERMOVE,i&&this.freehand_?i=this.handlePointerMove_(t):(t.pointerEvent.pointerType=="mouse"||t.type===S.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(t)):t.type===S.DBLCLICK&&(i=!1),d.prototype.handleEvent.call(this,t)&&i},n.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((function(){this.handlePointerMove_(new ft(S.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}).bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},n.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var i=this.mode_===y.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||i?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t):(this.startDrawing_(t),this.mode_===y.POINT&&this.finishDrawing()),e=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!e&&this.stopClick_&&t.stopPropagation(),e},n.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,r=e[0]-i[0],a=e[1]-i[1],o=r*r+a*a;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},n.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,r=[this.finishCoordinate_];if(this.mode_===y.LINE_STRING)i=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===y.POLYGON){var a=this.sketchCoords_;i=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]]}if(i)for(var o=t.map,s=0,h=r.length;s<h;s++){var l=r[s],u=o.getPixelFromCoordinate(l),f=t.pixel,g=f[0]-u[0],c=f[1]-u[1],p=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(g*g+c*c)<=p,e){this.finishCoordinate_=l;break}}}return e},n.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();if(!this.sketchPoint_)this.sketchPoint_=new z(new oe(e)),this.updateSketchFeatures_();else{var i=this.sketchPoint_.getGeometry();i.setCoordinates(e)}},n.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e,this.mode_===y.POINT?this.sketchCoords_=e.slice():this.mode_===y.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new z(new ee(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new re(ie.DRAWSTART,this.sketchFeature_))},n.prototype.modifyDrawing_=function(t){var e=t.coordinate,i=this.sketchFeature_.getGeometry(),r,a;if(this.mode_===y.POINT?a=this.sketchCoords_:this.mode_===y.POLYGON?(r=this.sketchCoords_[0],a=r[r.length-1],this.atFinish_(t)&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,a=r[r.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i),this.sketchPoint_){var o=this.sketchPoint_.getGeometry();o.setCoordinates(e)}var s;if(i.getType()==v.POLYGON&&this.mode_!==y.POLYGON){this.sketchLine_||(this.sketchLine_=new z);var h=i.getLinearRing(0);s=this.sketchLine_.getGeometry(),s?(s.setFlatCoordinates(h.getLayout(),h.getFlatCoordinates()),s.changed()):(s=new ee(h.getFlatCoordinates(),h.getLayout()),this.sketchLine_.setGeometry(s))}else this.sketchLineCoords_&&(s=this.sketchLine_.getGeometry(),s.setCoordinates(this.sketchLineCoords_));this.updateSketchFeatures_()},n.prototype.addToDrawing_=function(t){var e=t.coordinate,i=this.sketchFeature_.getGeometry(),r,a;this.mode_===y.LINE_STRING?(this.finishCoordinate_=e.slice(),a=this.sketchCoords_,a.length>=this.maxPoints_&&(this.freehand_?a.pop():r=!0),a.push(e.slice()),this.geometryFunction_(a,i)):this.mode_===y.POLYGON&&(a=this.sketchCoords_[0],a.length>=this.maxPoints_&&(this.freehand_?a.pop():r=!0),a.push(e.slice()),r&&(this.finishCoordinate_=a[0]),this.geometryFunction_(this.sketchCoords_,i)),this.updateSketchFeatures_(),r&&this.finishDrawing()},n.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t=this.sketchFeature_.getGeometry(),e,i;this.mode_===y.LINE_STRING?(e=this.sketchCoords_,e.splice(-2,1),this.geometryFunction_(e,t),e.length>=2&&(this.finishCoordinate_=e[e.length-2].slice())):this.mode_===y.POLYGON&&(e=this.sketchCoords_[0],e.splice(-2,1),i=this.sketchLine_.getGeometry(),i.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t)),e.length===0&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},n.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry();this.mode_===y.LINE_STRING?(e.pop(),this.geometryFunction_(e,i)):this.mode_===y.POLYGON&&(e[0].pop(),this.geometryFunction_(e,i),e=i.getCoordinates()),this.type_===v.MULTI_POINT?t.setGeometry(new ct([e])):this.type_===v.MULTI_LINE_STRING?t.setGeometry(new _t([e])):this.type_===v.MULTI_POLYGON&&t.setGeometry(new pt([e])),this.dispatchEvent(new re(ie.DRAWEND,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},n.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return t&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),t},n.prototype.extend=function(t){var e=t.getGeometry(),i=e;this.sketchFeature_=t,this.sketchCoords_=i.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new re(ie.DRAWSTART,this.sketchFeature_))},n.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},n.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing_(),this.overlay_.setMap(e?t:null)},n}(ce);function Dt(){var d=Fe();return function(n,t){return d[n.getGeometry().getType()]}}function Bt(d){var n;return d===v.POINT||d===v.MULTI_POINT?n=y.POINT:d===v.LINE_STRING||d===v.MULTI_LINE_STRING?n=y.LINE_STRING:d===v.POLYGON||d===v.MULTI_POLYGON?n=y.POLYGON:d===v.CIRCLE&&(n=y.CIRCLE),n}const Ut=Vt;var Ge=globalThis&&globalThis.__extends||function(){var d=function(n,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},d(n,t)};return function(n,t){d(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),_e=0,K=1,pe=[0,0,0,0],H=[],ne={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},ae=function(d){Ge(n,d);function n(t,e,i){var r=d.call(this,t)||this;return r.features=e,r.mapBrowserEvent=i,r}return n}(Te),Wt=function(d){Ge(n,d);function n(t){var e=d.call(this,t)||this;e.boundHandleFeatureChange_=e.handleFeatureChange_.bind(e),e.condition_=t.condition?t.condition:gt,e.defaultDeleteCondition_=function(r){return yt(r)&&mt(r)},e.deleteCondition_=t.deleteCondition?t.deleteCondition:e.defaultDeleteCondition_,e.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:xe,e.vertexFeature_=null,e.vertexSegments_=null,e.lastPixel_=[0,0],e.ignoreNextSingleClick_=!1,e.modified_=!1,e.rBush_=new Le,e.pixelTolerance_=t.pixelTolerance!==void 0?t.pixelTolerance:10,e.snappedToVertex_=!1,e.changingFeature_=!1,e.dragSegments_=[],e.overlay_=new de({source:new fe({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:qt(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.SEGMENT_WRITERS_={Point:e.writePointGeometry_.bind(e),LineString:e.writeLineStringGeometry_.bind(e),LinearRing:e.writeLineStringGeometry_.bind(e),Polygon:e.writePolygonGeometry_.bind(e),MultiPoint:e.writeMultiPointGeometry_.bind(e),MultiLineString:e.writeMultiLineStringGeometry_.bind(e),MultiPolygon:e.writeMultiPolygonGeometry_.bind(e),Circle:e.writeCircleGeometry_.bind(e),GeometryCollection:e.writeGeometryCollectionGeometry_.bind(e)},e.source_=null;var i;if(t.source?(e.source_=t.source,i=new Ct(e.source_.getFeatures()),e.source_.addEventListener(J.ADDFEATURE,e.handleSourceAdd_.bind(e)),e.source_.addEventListener(J.REMOVEFEATURE,e.handleSourceRemove_.bind(e))):i=t.features,!i)throw new Error("The modify interaction requires features or a source");return e.features_=i,e.features_.forEach(e.addFeature_.bind(e)),e.features_.addEventListener(Z.ADD,e.handleFeatureAdd_.bind(e)),e.features_.addEventListener(Z.REMOVE,e.handleFeatureRemove_.bind(e)),e.lastPointerEvent_=null,e}return n.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),t.addEventListener(j.CHANGE,this.boundHandleFeatureChange_)},n.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new ae(ne.MODIFYSTART,this.features_,t)))},n.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(j.CHANGE,this.boundHandleFeatureChange_)},n.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,i=[];e.forEach(function(s){t===s.feature&&i.push(s)});for(var r=i.length-1;r>=0;--r){for(var a=i[r],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===a&&this.dragSegments_.splice(o,1);e.remove(a)}},n.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.prototype.setActive.call(this,t)},n.prototype.setMap=function(t){this.overlay_.setMap(t),d.prototype.setMap.call(this,t)},n.prototype.getOverlay=function(){return this.overlay_},n.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},n.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},n.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},n.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},n.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},n.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},n.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r){var o=i[r],s={feature:t,geometry:e,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},n.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length-1;r<a;++r){var o=i.slice(r,r+2),s={feature:t,geometry:e,index:r,segment:o};this.rBush_.insert(O(o),s)}},n.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length-1;s<h;++s){var l=o.slice(s,s+2),u={feature:t,geometry:e,depth:[r],index:s,segment:l};this.rBush_.insert(O(l),u)}},n.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length-1;s<h;++s){var l=o.slice(s,s+2),u={feature:t,geometry:e,depth:[r],index:s,segment:l};this.rBush_.insert(O(l),u)}},n.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length;s<h;++s)for(var l=o[s],u=0,f=l.length-1;u<f;++u){var g=l.slice(u,u+2),c={feature:t,geometry:e,depth:[s,r],index:u,segment:g};this.rBush_.insert(O(g),c)}},n.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),r={feature:t,geometry:e,index:_e,segment:[i,i]},a={feature:t,geometry:e,index:K,segment:[i,i]},o=[r,a];r.featureSegments=a.featureSegments=o,this.rBush_.insert(te(i),r),this.rBush_.insert(e.getExtent(),a)},n.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var a=i[r],o=this.SEGMENT_WRITERS_[a.getType()];o(t,a)}},n.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;if(!e)e=new z(new oe(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e);else{var i=e.getGeometry();i.setCoordinates(t)}return e},n.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;this.lastPointerEvent_=t;var e;return!t.map.getView().getInteracting()&&t.type==S.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(t.type!=S.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),t.type==S.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),d.prototype.handleEvent.call(this,t)&&!e},n.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,i=0,r=this.dragSegments_.length;i<r;++i){for(var a=this.dragSegments_[i],o=a[0],s=o.depth,h=o.geometry,l=void 0,u=o.segment,f=a[1];e.length<h.getStride();)e.push(u[f][e.length]);switch(h.getType()){case v.POINT:l=e,u[0]=u[1]=e;break;case v.MULTI_POINT:l=h.getCoordinates(),l[o.index]=e,u[0]=u[1]=e;break;case v.LINE_STRING:l=h.getCoordinates(),l[o.index+f]=e,u[f]=e;break;case v.MULTI_LINE_STRING:l=h.getCoordinates(),l[s[0]][o.index+f]=e,u[f]=e;break;case v.POLYGON:l=h.getCoordinates(),l[s[0]][o.index+f]=e,u[f]=e;break;case v.MULTI_POLYGON:l=h.getCoordinates(),l[s[1]][s[0]][o.index+f]=e,u[f]=e;break;case v.CIRCLE:u[0]=u[1]=e,o.index===_e?(this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1):(this.changingFeature_=!0,h.setRadius(le(h.getCenter(),e)),this.changingFeature_=!1);break}l&&this.setGeometryCoordinates_(h,l)}this.createOrUpdateVertexFeature_(e)},n.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.coordinate;this.dragSegments_.length=0,this.modified_=!1;var i=this.vertexFeature_;if(i){t.map.getView().getProjection();var r=[],a=i.getGeometry().getCoordinates(),o=O([a]),s=this.rBush_.getInExtent(o),h={};s.sort(Yt);for(var l=0,u=s.length;l<u;++l){var f=s[l],g=f.segment,c=V(f.feature),p=f.depth;if(p&&(c+="-"+p.join("-")),h[c]||(h[c]=new Array(2)),f.geometry.getType()===v.CIRCLE&&f.index===K){var m=ge(e,f);B(m,a)&&!h[c][0]&&(this.dragSegments_.push([f,0]),h[c][0]=f);continue}if(B(g[0],a)&&!h[c][0]){this.dragSegments_.push([f,0]),h[c][0]=f;continue}if(B(g[1],a)&&!h[c][1]){if((f.geometry.getType()===v.LINE_STRING||f.geometry.getType()===v.MULTI_LINE_STRING)&&h[c][0]&&h[c][0].index===0)continue;this.dragSegments_.push([f,1]),h[c][1]=f;continue}V(g)in this.vertexSegments_&&!h[c][0]&&!h[c][1]&&this.insertVertexCondition_(t)&&r.push([f,a])}r.length&&this.willModifyFeatures_(t);for(var T=r.length-1;T>=0;--T)this.insertVertex_.apply(this,r[T])}return!!this.vertexFeature_},n.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()===v.CIRCLE){var a=r.getCenter(),o=i.featureSegments[0],s=i.featureSegments[1];o.segment[0]=o.segment[1]=a,s.segment[0]=s.segment[1]=a,this.rBush_.update(te(a),o),this.rBush_.update(r.getExtent(),s)}else this.rBush_.update(O(i.segment),i)}return this.modified_&&(this.dispatchEvent(new ae(ne.MODIFYEND,this.features_,t)),this.modified_=!1),!1},n.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)},n.prototype.handlePointerAtPixel_=function(t,e){var i=e.getCoordinateFromPixel(t);e.getView().getProjection();var r=function(x,C){return ve(i,x)-ve(i,C)},a=Et(te(i,pe)),o=e.getView().getResolution()*this.pixelTolerance_,s=Tt(Pt(a,o,pe)),h=this.rBush_,l=h.getInExtent(s);if(l.length>0){l.sort(r);var u=l[0],f=u.segment,g=ge(i,u),c=e.getPixelFromCoordinate(g),p=le(t,c);if(p<=this.pixelTolerance_){var m={};if(u.geometry.getType()===v.CIRCLE&&u.index===K)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g);else{var T=e.getPixelFromCoordinate(f[0]),w=e.getPixelFromCoordinate(f[1]),k=D(c,T),P=D(c,w);p=Math.sqrt(Math.min(k,P)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(g=k>P?f[1]:f[0]),this.createOrUpdateVertexFeature_(g);for(var M=1,b=l.length;M<b;++M){var R=l[M].segment;if(B(f[0],R[0])&&B(f[1],R[1])||B(f[0],R[1])&&B(f[1],R[0]))m[V(R)]=!0;else break}}m[V(f)]=!0,this.vertexSegments_=m;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},n.prototype.insertVertex_=function(t,e){for(var i=t.segment,r=t.feature,a=t.geometry,o=t.depth,s=t.index,h;e.length<a.getStride();)e.push(0);switch(a.getType()){case v.MULTI_LINE_STRING:h=a.getCoordinates(),h[o[0]].splice(s+1,0,e);break;case v.POLYGON:h=a.getCoordinates(),h[o[0]].splice(s+1,0,e);break;case v.MULTI_POLYGON:h=a.getCoordinates(),h[o[1]][o[0]].splice(s+1,0,e);break;case v.LINE_STRING:h=a.getCoordinates(),h.splice(s+1,0,e);break;default:return}this.setGeometryCoordinates_(a,h);var l=this.rBush_;l.remove(t),this.updateSegmentIndices_(a,s,o,1);var u={segment:[i[0],e],feature:r,geometry:a,depth:o,index:s};l.insert(O(u.segment),u),this.dragSegments_.push([u,1]);var f={segment:[e,i[1]],feature:r,geometry:a,depth:o,index:s+1};l.insert(O(f.segment),f),this.dragSegments_.push([f,0]),this.ignoreNextSingleClick_=!0},n.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=S.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);var e=this.removeVertex_();return this.dispatchEvent(new ae(ne.MODIFYEND,this.features_,t)),this.modified_=!1,e}return!1},n.prototype.removeVertex_=function(){var t=this.dragSegments_,e={},i=!1,r,a,o,s,h,l,u,f,g,c,p;for(h=t.length-1;h>=0;--h)o=t[h],c=o[0],p=V(c.feature),c.depth&&(p+="-"+c.depth.join("-")),p in e||(e[p]={}),o[1]===0?(e[p].right=c,e[p].index=c.index):o[1]==1&&(e[p].left=c,e[p].index=c.index+1);for(p in e){switch(g=e[p].right,u=e[p].left,l=e[p].index,f=l-1,u!==void 0?c=u:c=g,f<0&&(f=0),s=c.geometry,a=s.getCoordinates(),r=a,i=!1,s.getType()){case v.MULTI_LINE_STRING:a[c.depth[0]].length>2&&(a[c.depth[0]].splice(l,1),i=!0);break;case v.LINE_STRING:a.length>2&&(a.splice(l,1),i=!0);break;case v.MULTI_POLYGON:r=r[c.depth[1]];case v.POLYGON:r=r[c.depth[0]],r.length>4&&(l==r.length-1&&(l=0),r.splice(l,1),i=!0,l===0&&(r.pop(),r.push(r[0]),f=r.length-1));break}if(i){this.setGeometryCoordinates_(s,a);var m=[];if(u!==void 0&&(this.rBush_.remove(u),m.push(u.segment[0])),g!==void 0&&(this.rBush_.remove(g),m.push(g.segment[1])),u!==void 0&&g!==void 0){var T={depth:c.depth,feature:c.feature,geometry:c.geometry,index:f,segment:m};this.rBush_.insert(O(T.segment),T)}this.updateSegmentIndices_(s,l,c.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return i},n.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},n.prototype.updateSegmentIndices_=function(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),function(a){a.geometry===t&&(i===void 0||a.depth===void 0||wt(a.depth,i))&&a.index>e&&(a.index+=r)})},n}(ce);function Yt(d,n){return d.index-n.index}function ve(d,n,t){var e=n.geometry;if(e.getType()===v.CIRCLE){var i=e;if(n.index===K){var r=D(i.getCenter(),d),a=Math.sqrt(r)-i.getRadius();return a*a}}var o=A(d);return H[0]=A(n.segment[0]),H[1]=A(n.segment[1]),Ne(o,H)}function ge(d,n,t){var e=n.geometry;if(e.getType()===v.CIRCLE&&n.index===K)return e.getClosestPoint(d);var i=A(d);return H[0]=A(n.segment[0]),H[1]=A(n.segment[1]),Oe(Ie(i,H))}function qt(){var d=Fe();return function(n,t){return d[v.POINT]}}const ye=Wt;var Ht=globalThis&&globalThis.__extends||function(){var d=function(n,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])},d(n,t)};return function(n,t){d(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();function me(d){if(d.feature)return d.feature;if(d.element)return d.element}var U=[],zt=function(d){Ht(n,d);function n(t){var e=this,i=t||{},r=i;return r.handleDownEvent||(r.handleDownEvent=we),r.stopDown||(r.stopDown=Pe),e=d.call(this,r)||this,e.source_=i.source?i.source:null,e.vertex_=i.vertex!==void 0?i.vertex:!0,e.edge_=i.edge!==void 0?i.edge:!0,e.features_=i.features?i.features:null,e.featuresListenerKeys_=[],e.featureChangeListenerKeys_={},e.indexedFeaturesExtents_={},e.pendingFeatures_={},e.pixelTolerance_=i.pixelTolerance!==void 0?i.pixelTolerance:10,e.rBush_=new Le,e.SEGMENT_WRITERS_={Point:e.writePointGeometry_.bind(e),LineString:e.writeLineStringGeometry_.bind(e),LinearRing:e.writeLineStringGeometry_.bind(e),Polygon:e.writePolygonGeometry_.bind(e),MultiPoint:e.writeMultiPointGeometry_.bind(e),MultiLineString:e.writeMultiLineStringGeometry_.bind(e),MultiPolygon:e.writeMultiPolygonGeometry_.bind(e),GeometryCollection:e.writeGeometryCollectionGeometry_.bind(e),Circle:e.writeCircleGeometry_.bind(e)},e}return n.prototype.addFeature=function(t,e){var i=e!==void 0?e:!0,r=V(t),a=t.getGeometry();if(a){var o=this.SEGMENT_WRITERS_[a.getType()];o&&(this.indexedFeaturesExtents_[r]=a.getExtent(xt()),o(t,a))}i&&(this.featureChangeListenerKeys_[r]=Y(t,j.CHANGE,this.handleFeatureChange_,this))},n.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},n.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},n.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},n.prototype.handleEvent=function(t){var e=this.snapTo(t.pixel,t.coordinate,t.map);return e.snapped&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel),d.prototype.handleEvent.call(this,t)},n.prototype.handleFeatureAdd_=function(t){var e=me(t);this.addFeature(e)},n.prototype.handleFeatureRemove_=function(t){var e=me(t);this.removeFeature(e)},n.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=V(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)},n.prototype.handleUpEvent=function(t){var e=Ft(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},n.prototype.removeFeature=function(t,e){var i=e!==void 0?e:!0,r=V(t),a=this.indexedFeaturesExtents_[r];if(a){var o=this.rBush_,s=[];o.forEachInExtent(a,function(l){t===l.feature&&s.push(l)});for(var h=s.length-1;h>=0;--h)o.remove(s[h])}i&&(se(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])},n.prototype.setMap=function(t){var e=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();e&&(i.forEach(se),i.length=0,r.forEach(this.forEachFeatureRemove_.bind(this))),d.prototype.setMap.call(this,t),t&&(this.features_?i.push(Y(this.features_,Z.ADD,this.handleFeatureAdd_,this),Y(this.features_,Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(Y(this.source_,J.ADDFEATURE,this.handleFeatureAdd_,this),Y(this.source_,J.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_.bind(this)))},n.prototype.snapTo=function(t,e,i){var r=i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),a=i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_]),o=O([r,a]),s=this.rBush_.getInExtent(o);this.vertex_&&!this.edge_&&(s=s.filter(function(C){return C.feature.getGeometry().getType()!==v.CIRCLE}));var h=!1,l=null,u=null;if(s.length===0)return{snapped:h,vertex:l,vertexPixel:u};i.getView().getProjection();for(var f=A(e),g,c=1/0,p=0;p<s.length;++p){var m=s[p];U[0]=A(m.segment[0]),U[1]=A(m.segment[1]);var T=Ne(f,U);T<c&&(g=m,c=T)}var w=g.segment;if(this.vertex_&&!this.edge_){var k=i.getPixelFromCoordinate(w[0]),P=i.getPixelFromCoordinate(w[1]),M=D(t,k),b=D(t,P),R=Math.sqrt(Math.min(M,b));R<=this.pixelTolerance_&&(h=!0,l=M>b?w[1]:w[0],u=i.getPixelFromCoordinate(l))}else if(this.edge_){var x=g.feature.getGeometry().getType()===v.CIRCLE;if(x?l=Lt(e,g.feature.getGeometry()):(U[0]=A(w[0]),U[1]=A(w[1]),l=Oe(Ie(f,U))),u=i.getPixelFromCoordinate(l),le(t,u)<=this.pixelTolerance_&&(h=!0,this.vertex_&&!x)){var k=i.getPixelFromCoordinate(w[0]),P=i.getPixelFromCoordinate(w[1]),M=D(u,k),b=D(u,P),R=Math.sqrt(Math.min(M,b));R<=this.pixelTolerance_&&(l=M>b?w[1]:w[0],u=i.getPixelFromCoordinate(l))}}return h&&(u=[Math.round(u[0]),Math.round(u[1])]),{snapped:h,vertex:l,vertexPixel:u}},n.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},n.prototype.writeCircleGeometry_=function(t,e){for(var i=Ot(e),r=i.getCoordinates()[0],a=0,o=r.length-1;a<o;++a){var s=r.slice(a,a+2),h={feature:t,segment:s};this.rBush_.insert(O(s),h)}},n.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var a=this.SEGMENT_WRITERS_[i[r].getType()];a&&a(t,i[r])}},n.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length-1;r<a;++r){var o=i.slice(r,r+2),s={feature:t,segment:o};this.rBush_.insert(O(o),s)}},n.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length-1;s<h;++s){var l=o.slice(s,s+2),u={feature:t,segment:l};this.rBush_.insert(O(l),u)}},n.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r){var o=i[r],s={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},n.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length;s<h;++s)for(var l=o[s],u=0,f=l.length-1;u<f;++u){var g=l.slice(u,u+2),c={feature:t,segment:g};this.rBush_.insert(O(g),c)}},n.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},n.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,a=i.length;r<a;++r)for(var o=i[r],s=0,h=o.length-1;s<h;++s){var l=o.slice(s,s+2),u={feature:t,segment:l};this.rBush_.insert(O(l),u)}},n}(ce);const Ce=zt,Xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAoCAYAAACIC2hQAAAAAXNSR0IArs4c6QAAAWRJREFUWEftmc9Kw0AQxr+ZxpCKoAX/nMSrSMGGUuihpc9gn6a+jfgA+hApBfEQ0uJZkJ4EPQiWRNNd6UWqkhA2CbY6OeWQ2Xz85puZXZYAwL6+nQGoLt5X8alt2lu0lkKVQoeYw1WhSqSG0HB+EBWhhikSoobgEsOEqBD93vCLaE/t0/o5M2+P/PEgL+FSPdpruR5A1ZvxXSeMolzDo2yhQ4AcEbrYPRXh0V7LFaKf+1Ehatin/n7Vt936wOaNbhogqtA+NEhr/QgNnfRtHMeTUTBJHQrGRLvNxiUznxhm8kuY0nrq+UEfc6WS1jMWigrzwV5tN03o8eHRFQDn/mHaj2ieOJmeXl6f41kYp2anzKOI9NHl47L0UcPqMy+mDD8Uj/5bj3aajQsCdjw/OIPSiZMpg4tQqkct27IsJg7D97csYn6t4ecVtxxfKlERWnTVC1EhWoAHEqu+gLVLWWKtbkU+AFjw8xgPO7HlAAAAAElFTkSuQmCC",Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAoCAYAAACIC2hQAAAAAXNSR0IArs4c6QAABFtJREFUWEftmXtMW1Ucx8999fZCoVAeHQgMFlag62MF2RC2TP9Ut5gZp9NM/+CfJSQmM9NMo4loZhadrxnjI9HMaNw0mQGCy5KFuAwQ3WjX0rUwusKopdBBWXppuX3cxzG38WrZMrGlTTDp/evm/M75fT/5nvs7595zEQAAkPWMMgAASrzfiFdxnkyBrAJFELihQCFM8N0DKghgF4Ki0Y0CiyDCMIBAngPN1IzkHM2Uk1KenKM7DNojFEkeBADBRVcEQXA53e6uO3Q4mI7bWXEUxzFsV7NxhOU5cyzO2VAUzadkskNBerl7zOX+ecOAyuWEbKdePxJmIp9YnBPfqtWqssaa2gs0Ez5uc7p6c6CpOpBzdL1bKK7Aia3lDzQTJKkS3UcgwIsKFG+GV1Y+soxPfl9WXKzS1tddjLHxPiYWNydWAY5n/XcWbYGl5cB/mbF1V70I2dag+wJDUeMqQQjp6Vlfp9e/4BHbO1qMn+Io1rYaCkZ8C4uH3Z7Z8bVg1w3arGt4toDKPxoMhd8KhJetCUGeB0s0vRhl4rFkgPKSkk0ERSTWVRJFFFXl6pMQguCQxfZ8VkHlJCnfYdD2CQI/NWyxd60ldnfc2KjZJz4iS3TwqMM1ffnfxq/L0WZd06ECijoyF1jsvHnLa08VVNwY2o36cxCAyJDF9lxWQBNu6rX9PM/f+NVqfzFVSKm/oUnzWLFC8XaApl9xuqYu3S9P2o5qaqv1FWVlp+NsvD/Gsa50QQEEWCGV3xVh431XxhzvZhxUnicjH2zSfnZPtadBDAEMzS0EXnJ7vLaMg0oJd7eazvEsN+O85elOlbFGXdahUirfWQrSrzpuTg1k5RmVku5pNQ1FY2zPFbvjw1RBE8VkMpznON48YrW/kTXQCnVphaampp8OrZyw3Zj8KVVQsX+7yfAejqH1g2bbk1kDNTZq9hYVKLpn5nzPeHy3p9IB3WnQvkyS5N7BUevDWQPtMBk+wDFMe9lsfTRZpN1kOB7nuBnz9fGvktvbjIZuXuDmR6+Pfym1/wX6+OCo9ZGsgJaqVaW6zbXnmWj0m6v28c8lEaWyULG9oX6AiURPJwOJ8T2tpouxOHvp9zHHCal/u8lwEkXR6mGL7WBWQNuMutdIGfGE6w/v/vnbgXlJxLRNs78wT/G6b2HhheSXDVVJUZF+y5aBFSZyyuyc+O7vVaNley8nCJO/We3HMg66uaqyrq5y049MLH7m6pjjY0lAVZiv1G3VnBEgnB2+ZjucLNyia+pUUFTXjN//tMc7Ny3GpE+UEBN5/5pz4oeMg5q2NRwozMs/Fo1FzwoQhCQBOSF7CMVQPctxv7Act6q4KJJ8CkEQgolGz0r9CRxvInCsze3zH/DNzXszDio6oamqOYWiqCadSpfGQAj9ocjK11anq2etPGnv9WslznQ8B5pz9O6j8f/PiTNG7EZ4PpLpKUw3332LKd2E2R73zxl+rzkM4Mb9fVNaXVnwJxXrDGBMT4wcAAAAAElFTkSuQmCC";class Qt{constructor(n,t){this.map=n,this.options=t||{},this.initData()}initData(){this.drawInteraction=null,this.clickHandler=null,this.drawLayers=[],this.delLayers=[]}startDraw(n){const t=this.options.type||"Polygon";let e=new de({source:new fe({wrapX:!1}),style:this.options.style||this.layerStyle()});console.log(this.options.style),this.drawInteraction=new Ut({source:e.getSource(),type:t,geometryFunction:this.options.geometryFunction}),this.map.addLayer(e),this.drawInteraction.on("drawend",i=>{i.feature,this.drawLayers.push(e),n&&n(this.drawLayers),this.map.removeInteraction(this.drawInteraction)}),this.map.addInteraction(this.drawInteraction)}editLayer(){this.drawInteraction.setActive(!1),this.drawLayers.forEach(n=>{const t=new ye({source:n.getSource()});this.map.addInteraction(t);let e=new Ce({source:n.getSource()});this.map.addInteraction(e)})}editLayerEnd(){this.drawInteraction.setActive(!0),this.map.getInteractions().getArray().filter(t=>t instanceof ye||t instanceof Ce).forEach(t=>this.map.removeInteraction(t))}revokeDraw(){this.drawInteraction&&this.drawInteraction.removeLastPoint()}createDeleteButton(n,t,e){let i=document.createElement("div"),r=document.createElement("img");return r.style.width="22px",r.style.height="22px",r.style.transform="translate(-50%, -100%)",r.src=n,i.appendChild(r),i.addEventListener("click",()=>{this.map.removeLayer(t);const a=this.delLayers.find(s=>s.get("layerid")===t.ol_uid);a&&(this.map.removeOverlay(a),this.delLayers.splice(this.delLayers.indexOf(a),1));let o=this.drawLayers.indexOf(t);o!=-1&&this.drawLayers.splice(o,1),e&&e(t,this.drawLayers)}),i}delDraw(n,t){t||(t=require("../../../assets/images/del.png")),this.drawInteraction.setActive(!1),this.drawLayers.forEach(e=>{const i=this.createDeleteButton(t,e,n),r=new At({element:i,position:[0,0]});r.set("layerid",e.ol_uid);const a=e.getSource().getExtent(),o=It(a);r.setPosition(o),this.delLayers.push(r),this.map.addOverlay(r)})}delDrawEnd(){this.drawInteraction.setActive(!0),this.delLayers.forEach(n=>{this.map.removeOverlay(n)}),this.delLayers=[]}clear(){this.drawLayers.forEach(n=>this.map.removeLayer(n)),this.delLayers.forEach(n=>this.map.removeLayer(n)),this.editLayerEnd(),this.map.removeInteraction(this.drawInteraction),this.initData()}layerStyle(){return new Nt({fill:new St({color:"rgba(177, 140, 83, 0.5)"}),stroke:new Mt({color:"red",width:1})})}}const jt={class:"title"},Jt={class:"sf"},Zt={class:"left"},$t={class:"right"},ei={__name:"DetailModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:""},data:{default:{plan:"",content:"",member:"",date:""}}},emits:["update:visible"],setup(d,{emit:n}){const t=d,e=n;let i;const r=L(),a=L(),o=Q(()=>t.visible),s=Q(()=>t.data);function h(){e("update:visible",!1)}function l(){a.value.validate(c=>{if(!c)return console.log("error submit!!"),!1})}function u(c){}function f(){const c=r.value.getMap();c&&(i||(i=new Qt(c)),i.startDraw(p=>{console.log(p)}))}function g(){i.clear()}return Be(()=>{Ue(()=>{})}),(c,p)=>{const m=q("el-input"),T=q("el-form-item"),w=q("el-form"),k=q("el-dialog");return X(),Ee(k,{modelValue:o.value,"onUpdate:modelValue":p[4]||(p[4]=P=>o.value=P),"before-close":h,class:"custom-dialog w-45","append-to-body":!0,"destroy-on-close":"",width:"45%"},{header:N(()=>[_("div",jt,ue(d.title),1)]),footer:N(()=>[_("div",{class:"dialog-footer flex content-center"},[_("div",{class:"reset-btn",onClick:h},"取 消"),_("div",{class:"search-btn",type:"primary",onClick:l},"确 定")])]),default:N(()=>[_("div",Jt,[_("div",Zt,[_("div",{class:"header"},[p[5]||(p[5]=_("div",{class:"img"},null,-1)),p[6]||(p[6]=_("span",{class:"title"},"围栏操作",-1)),p[7]||(p[7]=_("img",{src:Xt,alt:""},null,-1)),_("img",{src:Kt,alt:"",onClick:g,title:"清除"})]),E(w,{model:s.value,"label-width":"auto","label-position":"left",ref_key:"formRef",ref:a,class:"custom-form"},{default:N(()=>[E(T,{label:"围栏编号",prop:"plan"},{default:N(()=>[E(m,{class:"custom-input",modelValue:s.value.plan,"onUpdate:modelValue":p[0]||(p[0]=P=>s.value.plan=P)},null,8,["modelValue"])]),_:1}),E(T,{label:"报警等级",prop:"content"},{default:N(()=>[E(m,{class:"custom-input",modelValue:s.value.content,"onUpdate:modelValue":p[1]||(p[1]=P=>s.value.content=P)},null,8,["modelValue"])]),_:1}),E(T,{label:"超时时间",prop:"member"},{default:N(()=>[E(m,{class:"custom-input",modelValue:s.value.member,"onUpdate:modelValue":p[2]||(p[2]=P=>s.value.member=P)},null,8,["modelValue"])]),_:1}),E(T,{label:"围栏颜色",prop:"member"},{default:N(()=>[E(m,{class:"custom-input",modelValue:s.value.date,"onUpdate:modelValue":p[3]||(p[3]=P=>s.value.date=P)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),_("button",{onClick:f},p[8]||(p[8]=[_("span",null,"画围栏ROI",-1)]))]),_("div",$t,[E(Se,{ref_key:"mapRef",ref:r,onMapLoaded:u},null,512)])])]),_:1},8,["modelValue"])}}},ti=he(ei,[["__scopeId","data-v-82961b64"]]);const ii={class:"title"},ri={__name:"CloudModal",props:{visible:{type:Boolean,default:!1},title:{type:String,default:""},data:{default:{plan:"",content:"",member:"",date:""}}},emits:["update:visible"],setup(d,{emit:n}){const t=d,e=n,i=L(),r=Q(()=>t.visible);Q(()=>t.data);function a(){e("update:visible",!1)}function o(){i.value.validate(s=>{if(!s)return console.log("error submit!!"),!1})}return(s,h)=>{const l=q("el-dialog");return X(),Ee(l,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=u=>r.value=u),"before-close":a,class:"custom-dialog w-45","append-to-body":!0,width:"50%"},{header:N(()=>[_("div",ii,ue(d.title),1)]),footer:N(()=>[_("div",{class:"dialog-footer flex content-center"},[_("div",{class:"reset-btn",onClick:a},"取 消"),_("div",{class:"search-btn",type:"primary",onClick:o},"确 定")])]),default:N(()=>[h[1]||(h[1]=_("div",{class:"cloud"},[_("div",{class:"left"}),_("div",{class:"right"},[_("div",{class:"header"},[_("div",{class:"img"}),_("span",{class:"title"},"IP地址统计")]),_("div",{class:"detail"},[_("div",{class:"device"},[_("span",null,"设备名称："),_("span",{class:"name"})]),_("div",{class:"row"},[_("span",null,"状态："),_("span",{class:"status"},"在线")]),_("div",{class:"row"},[_("span",null,"区域："),_("span",{class:"status"},"在线")])]),_("div",{class:"header"},[_("div",{class:"img"}),_("span",{class:"title"},"云台控制")])])],-1))]),_:1},8,["modelValue"])}}},ni=he(ri,[["__scopeId","data-v-fadf6a6f"]]);const ai={class:"main"},si={class:"left"},oi={class:"video-list"},li={class:"v-wrapper"},hi={class:"btnGroup"},ui=["onClick"],di={class:"title"},fi={class:"pagination"},ci={class:"right"},_i={class:"top"},pi={class:"bottom"},vi={__name:"VisualPanel",setup(d){const n=new Date().getFullYear().toString(),t=new Date().getMonth()-1,e=L({num:230});Q(()=>b(e.value.num));const i=new Array(9).fill(0).map((x,C)=>({url:"",title:"港沟河下游-"+C+"#"})),r=[{img:"ryrq_icon.png",content:"人员闯入",location:"拦河闸下游",time:"2024-08-16  08:00",status:"未解除"},{img:"ryrq_icon.png",content:"人员闯入",location:"拦河闸下游",time:"2024-08-16  08:00",status:"未解除"},{img:"ryrq_icon.png",content:"人员闯入",location:"拦河闸下游",time:"2024-08-16  08:00",status:"未解除"},{img:"ryrq_icon.png",content:"人员闯入",location:"拦河闸下游",time:"2024-08-16  08:00",status:"未解除"}];L();const a=L(!1),o=L(!1),s=L(),h=L(!1),l=L(!1),u=L({});L({});const f=L(r),g=L(i),c=We(),p=L({total:g.value.length,pageNum:1,pageSize:10});Ye({year:n||"2024",month:n+"-"+t,status:"",member:""});function m(){c.push("/SecurityManagement/liveMonitor/dispatch")}function T(x){p.value.pageSize=x}function w(x){p.value.pageNum=x}function k(x){a.value=!0,s.value=x}function P(x){l.value=!0,u.value=x}function M(){o.value=!0}function b(x){return String(x).split("")}function R(){}return(x,C)=>{const Ae=q("el-pagination");return X(),$("div",ai,[_("div",si,[_("div",oi,[(X(!0),$(qe,null,He(g.value,G=>(X(),$("div",{class:"box",key:G.title},[_("div",li,[E(Xe)]),C[5]||(C[5]=_("div",{class:"voice"},null,-1)),_("div",hi,[C[4]||(C[4]=_("div",{class:"btn"},"全屏",-1)),_("div",{class:"btn",onClick:gi=>k(G)},"云台",8,ui)]),_("div",di,ue(G.title),1)]))),128))]),_("div",fi,[E(Ae,{class:"custom-pagination",onSizeChange:T,onCurrentChange:w,"current-page":p.value.pageNum,"page-size":p.value.pageSize,layout:"prev, pager, next, jumper",total:p.value.total,background:""},null,8,["current-page","page-size","total"])])]),_("div",ci,[_("div",_i,[E(ke,{yjList:f.value,onClickInfo:P},{header:N(()=>[_("img",{style:{width:"20px",height:"20px",cursor:"pointer"},src:Ve,alt:"",srcset:"",onClick:M})]),_:1},8,["yjList"])]),_("div",pi,[C[6]||(C[6]=_("div",{class:"header"},[_("div",{class:"img"}),_("div",{class:"title"},"监控分布图")],-1)),E(Se,{class:"dispatch-img",onClick:m,onMapLoaded:R})])]),E(ti,{visible:h.value,title:"电子围栏算法设置","onUpdate:visible":C[0]||(C[0]=G=>h.value=G)},null,8,["visible"]),E(ni,{visible:a.value,data:s.value,title:"电子围栏算法设置","onUpdate:visible":C[1]||(C[1]=G=>a.value=G)},null,8,["visible","data"]),E(be,{visible:o.value,title:"视频设备列表","onUpdate:visible":C[2]||(C[2]=G=>o.value=G)},null,8,["visible"]),E(ze,{width:"60%",visible:l.value,title:u.value.location,footer:!1,"onUpdate:visible":C[3]||(C[3]=G=>l.value=G)},{default:N(()=>[E(De,{data:u.value},null,8,["data"])]),_:1},8,["visible","title"])])}}},Li=he(vi,[["__scopeId","data-v-dfa2eb6c"]]);export{Li as default};
