import{_ as le}from"./close_icon-79cdeb99.js";import{d as ae}from"./dialogRemoveCom-acb7236a.js";import{e as oe,f as se,h as te,s as ne,i as ce,j as de,k as re}from"./systemAPI-88b64bb8.js";import{_ as ue,f as t,J as ie,g as pe,r as d,o as u,c as g,a,b as n,w as i,x as r,t as I,C as B,v as R,A as E,F as A,i as T,n as ve}from"./index-267246aa.js";import"./axios-da025460.js";const _e={class:"sys_body"},me={class:"top"},fe={class:"search"},he={class:"table"},be=["onClick"],ge=["onClick"],ke={key:0,class:"sys_dialog add"},ye={class:"content"},xe={class:"header"},Ce={class:"title"},Ne={class:"main"},Re={__name:"index",setup(we){const o=t({roleName:"",dataScope:"",resourceIds:[]});let L=["","全部数据权限","自定数据权限","本部门数据权限","本部门及以下数据权限"];const h=t(!1),O=t(null);let v=t("新增"),k=t(!1);const _=t("");let y=ie({});const P=t([{label:"名称",prop:"roleName"},{label:"级别",prop:"dataScope"},{label:"描述",prop:"desc"}]);let w=t([]);const U={children:"children",label:"resName",disabled:"disabled"};let S=t([]);const j=()=>{_.value="",m()},F=()=>{m({roleName:_.value})},J=e=>{Q(e.id),v.value="编辑",o.value.id=e.id,o.value.roleName=e.roleName,o.value.dataScope=e.dataScope,h.value=!0},M=()=>{v.value="新增",h.value=!0},x=()=>{o.value.id=null,o.value.resourceIds=[],o.value.roleName="",o.value.dataScope="",h.value=!1},$=()=>{o.value.resourceIds=b.value.getCheckedKeys(!1);const e={...o.value};v.value=="新增"?ne(e).then(l=>{V(l)}):v.value=="编辑"&&ce(e).then(l=>{V(l)})},V=e=>{E({message:e.msg,type:"success"}),x(),m({roleName:_.value})},z=e=>{e.removeText="角色名称："+e.roleName,y=e,k.value=!0},D=()=>{k.value=!1},H=()=>{de({id:y.id}).then(e=>{E({message:e.msg,type:"success"}),D(),m()})};let b=t(null),p=t(!1);const K=t([{value:"",label:"请选择"},{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"}]),q=()=>{p.value?(p.value=!1,b.value.store._getAllNodes().forEach(e=>{e.expanded=!1})):(p.value=!0,b.value.store._getAllNodes().forEach(e=>{e.expanded=!0}))};pe(()=>{m(),G()});const G=()=>{oe().then(e=>{sessionStorage.setItem("dictObject",JSON.stringify(e.data.records))}),se().then(e=>{console.log(e),S.value=e.data})},m=e=>{te(e||{}).then(l=>{console.log(l.data.records),l.data.records.forEach(c=>{c.desc=L[parseInt(c.dataScope)]}),w.value=l.data.records})},Q=e=>{re(e).then(({data:l})=>{if(console.log(l),l){let c=[];l.forEach(f=>{c.push(f.id)}),o.value.resourceIds=c}})};return(e,l)=>{const c=d("el-input"),f=d("el-table-column"),W=d("el-table"),C=d("el-form-item"),X=d("el-option"),Y=d("el-select"),Z=d("el-tree"),ee=d("el-form");return u(),g("div",_e,[a("div",me,[a("div",fe,[l[3]||(l[3]=a("div",{class:"type"},"角色名称",-1)),n(c,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=s=>_.value=s),class:"search-input",placeholder:"请输入关键字"},null,8,["modelValue"]),a("div",{class:"search-btn",onClick:F},"查询"),a("div",{class:"reset-btn",onClick:j},"重置")]),a("div",{class:"reset-btn",onClick:M},"新建")]),a("div",he,[n(W,{data:r(w),height:"100%"},{default:i(()=>[n(f,{type:"index",width:"70",label:"序号",align:"center"}),(u(!0),g(A,null,T(P.value,(s,N)=>(u(),R(f,{key:N,prop:s.prop,label:s.label,align:"center","show-overflow-tooltip":""},null,8,["prop","label"]))),128)),n(f,{label:"操作",align:"center"},{default:i(s=>[a("span",{class:"oper-span oper-edit",onClick:N=>J(s.row)},"编辑",8,be),a("span",{class:"oper-span oper-remove",onClick:N=>z(s.row)},"删除",8,ge)]),_:1})]),_:1},8,["data"])]),h.value?(u(),g("div",ke,[a("div",ye,[a("div",xe,[a("div",Ce,I(r(v)),1),a("img",{src:le,alt:"",class:"close",onClick:x})]),a("div",Ne,[n(ee,{ref_key:"formRef",ref:O,model:o.value,"label-width":"120px","label-position":"right"},{default:i(()=>[n(C,{label:"角色名称："},{default:i(()=>[n(c,{modelValue:o.value.roleName,"onUpdate:modelValue":l[1]||(l[1]=s=>o.value.roleName=s)},null,8,["modelValue"])]),_:1}),n(C,{label:"角色级别："},{default:i(()=>[n(Y,{modelValue:o.value.dataScope,"onUpdate:modelValue":l[2]||(l[2]=s=>o.value.dataScope=s)},{default:i(()=>[(u(!0),g(A,null,T(K.value,s=>(u(),R(X,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(C,{label:"角色权限：",class:"form-tree"},{default:i(()=>[a("div",{class:"expand-tree",onClick:q},[a("span",{class:ve({up:r(p),down:!r(p)})},I(r(p)?"收起":"展开"),3)]),n(Z,{ref_key:"treeRef",ref:b,style:{"max-width":"600px"},data:r(S),"show-checkbox":"","node-key":"id",indent:20,"highlight-current":"",props:U,"default-checked-keys":o.value.resourceIds},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model"])]),a("div",{class:"footer"},[a("div",{class:"reset-btn",onClick:x},"取消"),a("div",{class:"search-btn",onClick:$},"确定")])])])):B("",!0),r(k)?(u(),R(ae,{key:1,data:r(y),style:{width:"60rem"},onCloseRemove:D,onSubRemove:H},null,8,["data"])):B("",!0)])}}},Ee=ue(Re,[["__scopeId","data-v-0160e80c"]]);export{Ee as default};
