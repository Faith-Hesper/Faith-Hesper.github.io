import{c as y,f as g}from"./unit-ac192840.js";import{$ as S}from"./jquery-ce9c138c.js";let d=window.Cesium,w=window.config;d.Ion.defaultAccessToken=w.cesiumAccessToken;class F{constructor(i,n,e,a){this.id=i,this.viewer=null,this.scene=null,this.tile3d=null,this.lon=n,this.lat=e,this.height=a,this.configFlag=y()}initMap(){this.viewer=new d.Viewer(this.id,{useBrowserRecommendedResolution:!!this.configFlag,animation:!1,baseLayerPicker:!1,geocoder:!1,timeline:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,infoBox:!1,selectionIndicator:!1,imageryProvider:!1,contextOptions:{requestWebgl2:!0},msaaSamples:this.configFlag?1:2,targetFrameRate:this.configFlag?10:30,fullscreenButton:!1,navigationInstructionsInitiallyVisible:!1});let i=this.viewer.imageryLayers.addImageryProvider(new d.ArcGisMapServerImageryProvider({url:w.juntunMapServer})),n=new d.WebMapTileServiceImageryProvider({url:"http://t0.tianditu.gov.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=2c1ca83643dd7a3321d735ebe1c49c78",layer:"tdtImg_c",style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tilingScheme:new d.GeographicTilingScheme,tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],maximumLevel:17});this.viewer.imageryLayers.addImageryProvider(n),this.viewer.imageryLayers.raiseToTop(i),this.viewer.scene.blurFactor=200,this.viewer.scene.splitFactor=5,this.viewer.scene.primitives.destroyPrimitives=!1,this.viewer.scene.globe.preloadAncestors=!0,this.viewer.clock.currentTime=d.JulianDate.fromDate(new Date("2024-07-10 16:00:00.000")),this.viewer.scene.skyBox.show=!1,this.viewer.scene.globe.enableLighting=!0,(w.showRiverWater||!this.configFlag)&&(this.viewer.scene.globe.depthTestAgainstTerrain=!0,this.viewer.scene.logarithmicDepthBuffer=!0,this.viewer.scene._czmRenderGBufferPass=[4,7],this.viewer.scene.postProcessStages=new d.RenderEffectPipeline(this.viewer,{heightInscatteringFog:!1,renderLogDepth:!1,show:!1,lensFlareType:1})),this.configFlag?(this.viewer.postProcessStages.lights.enabled=!1,this.viewer.postProcessStages.fxaa.enabled=!1,this.viewer.postProcessStages.hdrBloom.enabled=!1,this.viewer.postProcessStages.skyEffect.enabled=!1,this.viewer.scene.highDynamicRange=!1):(this.viewer.postProcessStages.lights.enabled=!0,this.viewer.postProcessStages.fxaa.enabled=!0,this.viewer.postProcessStages.hdrBloom.enabled=!1,this.viewer.postProcessStages.skyEffect.enabled=!0,this.viewer.scene.highDynamicRange=!0,this.viewer.postProcessStages.tonemapper=d.Tonemapper.FILMIC,this.viewer.scene.gamma=1.3,this.viewer.postProcessStages.skyEffect.exposure=2.3,this.viewer.postProcessStages.skyEffect.volumetCloudDensity=.28,this.viewer.postProcessStages.skyEffect.volumetCloudToHeight=4e4,this.viewer.postProcessStages.skyEffect.volumetCloudToHeight2=48e3,this.viewer.postProcessStages.skyEffect.cloudViewDis=1430807,this.viewer.postProcessStages.skyEffect.windSpeed=30,this.viewer.postProcessStages.skyEffect.showCloudShadows=!1,this.viewer.postProcessStages.skyEffect._fogByDistance.z=15e4,this.viewer.postProcessStages.skyEffect._exponentialFogParam2.z=6200,this.viewer.postProcessStages.skyEffect._exponentialFogParam5.y=.218,this.viewer.postProcessStages.taa.enabled=!0,this.viewer.postProcessStages.taa.depthDiffNum=10,this.viewer.postProcessStages.taa.brightDiffNum=.01),this.viewer.cesiumWidget.creditContainer.style.display="none"}destroyMap(){this.viewer&&(this.viewer.entities.removeAll(),this.viewer.scene.primitives.removeAll(),this.viewer.destroy(),this.viewer=null,this.scene=null,this.tile3d=null)}}function I(o,i,n,e){window.map=new F(o,i,n,e)}let c=window.Cesium,b=window.config,v;const T={getPolygonInstance:function(o,i,n,e){let a=c.Cartesian3.fromDegreesArrayHeights(o.pts),t=[];for(let u=0;u<o.holes.length;u++)t.push({positions:c.Cartesian3.fromDegreesArrayHeights(o.holes[u])});let l=null;return e?l=new c.PolygonGeometry({polygonHierarchy:{positions:a,holes:t},perPositionHeight:e}):l=new c.PolygonGeometry({polygonHierarchy:{positions:a,holes:t},height:n}),new c.GeometryInstance({geometry:l,attributes:{color:c.ColorGeometryInstanceAttribute.fromColor(c.Color.fromCssColorString(i.fillColor).withAlpha(i.fillOpacity))}})},addRiverWater:function(o,i){S.ajax({url:g(b.juntunRiverUrl),success:n=>{let e=new c.Geojson;e=e.read(n);let a={};a.asynchronous=a.asynchronous?a.asynchronous:!1,a.clampToGround=a.clampToGround?a.clampToGround:!1,a.fillColor=a.fillColor?a.fillColor:"#ff0000",a.fillOpacity=a.fillOpacity?a.fillOpacity:1,a.pixelSize=a.pixelSize?a.pixelSize:10,a.strokeColor=a.strokeColor?a.strokeColor:"#ff0000",a.strokeOpacity=a.strokeOpacity?a.strokeOpacity:1,a.lineWidth=a.lineWidth?a.lineWidth:2,a.outlineWidth=a.outlineWidth?a.outlineWidth:0,a.translucent=!1,(a.fillOpacity!=1||a.strokeOpacity!=1)&&(a.translucent=!0);let t=[],l=[];for(let s=0;s<e.polygonArray.length;s++){let u=e.polygonArray[s].geometry;if(s==1){let m=this.getPolygonInstance(u,a,0,!0);t.push(m)}if(s==0){let m=this.getPolygonInstance(u,a,8,!1);l.push(m)}}v=this.addxiangjiang(o,t,i),this.addxiangjiang(o,l),setTimeout(()=>{this.startFloodUp(v)},6e3)},dataType:"json"})},addBaiShiGangUp:function(o,i){const n=new c.WaterEffect(o,{instances:i,renderPass:[4]});return n.showReflect=!0,n.reflectHeight=58,n.appearance.material.uniforms.baseColor=c.Color.fromCssColorString("#a8976a").withAlpha(0),n.appearance.material.uniforms.u_ReflectionStrength=2.6,n.appearance.material.uniforms.u_WaterDepth=.1,n.appearance.material.uniforms.u_FoamIntersectionFade=.15,n.appearance.material.uniforms.u_causticScale=3e-4,n.appearance.material.uniforms.u_FoamScale=330,n.appearance.material.uniforms.u_causticIntersectionFade=.94,n._waterEffect},addBaiShiGangDown:function(o,i,n){const e=new c.WaterEffect(o,{instances:i,renderPass:[4]});e.showReflect=!1,e.reflectHeight=58,e.appearance.material.uniforms.baseColor=c.Color.fromCssColorString("#a8976a").withAlpha(0),e.appearance.material.uniforms.u_ReflectionStrength=2.6,e.appearance.material.uniforms.u_WaterDepth=.1,e.appearance.material.uniforms.u_FoamIntersectionFade=.15,e.appearance.material.uniforms.u_causticScale=3e-4,e.appearance.material.uniforms.u_FoamScale=330,e.appearance.material.uniforms.u_causticScale=.0579,e.appearance.material.uniforms.u_causticIntersectionFade=4.6,e.appearance.material.uniforms.oceanFrequencyLowAltitude=2e3,e.appearance.material.uniforms.oceanOneOverAmplitudeLowAltitude=.365,e.appearance.material.uniforms.u_waterAngle=360,e.appearance.material.uniforms.u_waterSpeed=7e3},addxiangjiang:function(o,i,n){const e=new c.WaterEffect(o,{instances:i,centerPos:c.Cartesian3.fromDegrees(116.778536,39.79121,8),renderPass:[4]});if(e.showReflect=!0,e.reflectHeight=7,e.appearance.material.uniforms.baseColor=c.Color.fromCssColorString("#30ceff"),e.appearance.material.uniforms.u_ReflectionStrength=2.6,e.appearance.material.uniforms.u_WaterDepth=.1,e.appearance.material.uniforms.u_FoamIntersectionFade=.03,e.appearance.material.uniforms.u_causticScale=3e-4,e.appearance.material.uniforms.u_FoamScale=330,e.appearance.material.uniforms.u_causticIntersectionFade=.94,e.appearance.material.uniforms.u_center.w=4e3,!n)return;const a=n.addFolder("水面渲染");return a.add({sun:1},"sun",0,1,.1).name("光照亮度").onChange(function(t){e.appearance.material.uniforms.luminance=t}),a.addColor({color:"#fff"},"color").name("基础颜色").onChange(function(t){e.appearance.material.uniforms.baseColor=c.Color.fromCssColorString(t)}),a.add({alpha:.8},"alpha",0,1,.1).name("透明度").onChange(function(t){e.appearance.material.uniforms.alpha=t}),a.add({alpha:1e3},"alpha",1e3,1e5,1).name("lod距离").onChange(function(t){e.appearance.material.uniforms.u_center.w=t}),a.add({u_WaterDepth:.4},"u_WaterDepth",0,30,.1).name("水深值").onChange(function(t){e.appearance.material.uniforms.u_WaterDepth=t}),a.add({noiseIntensity:.1},"noiseIntensity",0,1,.001).name("扭曲度").onChange(function(t){e.appearance.material.uniforms.u_noiseIntensity=t}),a.addColor({u_WaterShallowColor:"#fff"},"u_WaterShallowColor").name("浅水区颜色").onChange(function(t){e.appearance.material.uniforms.u_WaterShallowColor=c.Color.fromCssColorString(t)}),a.add({u_WaterShallowColorAlpha:.38},"u_WaterShallowColorAlpha",0,1,.001).name("浅水区透明度").onChange(function(t){e.appearance.material.uniforms.u_WaterShallowColorAlpha=t}),a.addColor({u_WaterDeepColor:"#fff"},"u_WaterDeepColor").name("深水区颜色").onChange(function(t){e.appearance.material.uniforms.u_WaterDeepColor=c.Color.fromCssColorString(t)}),a.add({u_WaterDeepColorAlpha:.8},"u_WaterDeepColorAlpha",0,1,.001).name("深水区透明度").onChange(function(t){e.appearance.material.uniforms.u_WaterDeepColorAlpha=t}),a.addColor({u_HorizonColor:"#fff"},"u_HorizonColor").name("菲涅尔散射").onChange(function(t){e.appearance.material.uniforms.u_HorizonColor=c.Color.fromCssColorString(t)}),a.add({u_HorizonDistance:6},"u_HorizonDistance",0,15,.01).name("菲涅尔系数").onChange(function(t){e.appearance.material.uniforms.u_HorizonDistance=t}),a.add({enabled:!0},"enabled").name("开启反射").onChange(t=>{e.showReflect=t}),a.add({u_ReflectionStrength:625},"u_ReflectionStrength",10,1e3,.1).name("反射平面").onChange(function(t){e.reflectHeight=t}),a.add({u_ReflectionStrength:2.6},"u_ReflectionStrength",0,3,.01).name("反射强度").onChange(function(t){e.appearance.material.uniforms.u_ReflectionStrength=t}),a.add({u_ReflectionMix:.5},"u_ReflectionMix",0,1,.01).name("反射混合度").onChange(function(t){e.appearance.material.uniforms.u_ReflectionMix=t}),a.add({u_ReflectionFresnelPower:4},"u_ReflectionFresnelPower",0,15,.01).name("反射菲涅尔系数").onChange(function(t){e.appearance.material.uniforms.u_ReflectionFresnelPower=t}),a.add({u_FoamBlend:.63},"u_FoamBlend",0,1,.01).name("白浪混合度").onChange(function(t){e.appearance.material.uniforms.u_FoamBlend=t}),a.add({u_FoamSpeed:120},"u_FoamSpeed",60,500,.01).name("白浪速度").onChange(function(t){e.appearance.material.uniforms.u_FoamSpeed=t}),a.add({u_FoamScale:200},"u_FoamScale",.1,500,.01).name("白浪缩放").onChange(function(t){e.appearance.material.uniforms.u_FoamScale=t}),a.add({u_FoamIntersectionFade:.03},"u_FoamIntersectionFade",0,10,.01).name("白浪强度").onChange(function(t){e.appearance.material.uniforms.u_FoamIntersectionFade=t}),a.add({u_causticScale:.001},"u_causticScale",1e-4,1,1e-4).name("焦散缩放").onChange(function(t){e.appearance.material.uniforms.u_causticScale=t}),a.add({u_causticSpeed:1},"u_causticSpeed",60,500,.01).name("焦散速度").onChange(function(t){e.appearance.material.uniforms.u_causticSpeed=t}),a.add({u_causticIntersectionFade:8},"u_causticIntersectionFade",0,20,.01).name("焦散强度").onChange(function(t){e.appearance.material.uniforms.u_causticIntersectionFade=t}),a.addColor({u_causticColor:"#fff"},"u_causticColor").name("焦散颜色").onChange(function(t){e.appearance.material.uniforms.u_causticColor=c.Color.fromCssColorString(t)}),a.add({oceanOneOverAmplitudeLowAltitude:.5},"oceanOneOverAmplitudeLowAltitude",.001,2,.001).name("浪高").onChange(function(t){e.appearance.material.uniforms.oceanOneOverAmplitudeLowAltitude=t}),a.add({oceanAnimationSpeedLowAltitude:.4},"oceanAnimationSpeedLowAltitude",.001,2,.001).name("振幅").onChange(function(t){e.appearance.material.uniforms.oceanAnimationSpeedLowAltitude=t}),a.add({oceanFrequencyLowAltitude:825e3},"oceanFrequencyLowAltitude",2e3,1e6,.001).name("密度").onChange(function(t){e.appearance.material.uniforms.oceanFrequencyLowAltitude=t}),a.add({shiny:800},"shiny",.001,1e3,.001).name("平滑").onChange(function(t){e.appearance.material.uniforms.shiny=t}),a.add({spec:10},"spec",.001,20,.001).name("高光").onChange(function(t){e.appearance.material.uniforms.spec=t}),e._waterEffect},updateHeight:function(o,i){o||console.log("=============");const n=o._boundingSpheres[0];if(!n)return;let e=c.Transforms.eastNorthUpToFixedFrame(n.center),a=c.Matrix4.inverse(e,new c.Matrix4),t=c.Matrix4.fromTranslation(new c.Cartesian3(1,1,i)),l=c.Matrix4.multiply(t,a,new c.Matrix4);o.modelMatrix=c.Matrix4.multiply(e,l,new c.Matrix4)},startFloodDown:function(o){let i=35,n=45,e=33,a=.02,t=setInterval(()=>{n>e?(n-=a,n<e&&(n=e),this.updateHeight(o,n-i)):clearInterval(t)},25)},startFloodUp:function(o){console.log("水位开始上涨");let i=0,n=i,e=.8,a=.01,t=setInterval(()=>{n<e?(n+=a,n>e&&(n=e),this.updateHeight(o,n-i)):(console.log("水位上涨完成"),clearInterval(t))},25)}},D="/juntun/assets/map_osmotic_icon-ea931f6f.png",M="/juntun/assets/map_rain_icon-25ee6026.png",P="/juntun/assets/map_dzwl_icon-124020fb.png",x="/juntun/assets/map_gnss_icon-c1ce088f.png",R="/juntun/assets/map_video_icon-6eacfc6d.png";let r=window.Cesium;r.Cartesian3;let A=r.BoundingSphere;r.ScreenSpaceEventHandler;let E=window.dat,h=window.config,O=h.juntunModelUrl;y();function G(o,i,n,e){I(o,i,n,e),window.map.initMap(),L();let a=null;return a=k(i,n,e),{viewer:window.map.viewer,model:a.model}}function k(o,i,n){if(window.map){window.map.viewer;let e=B(116.815837,39.729309,4);return W(o,i,n),{model:e.model}}}function U(){if(window.map){const o=window.map.viewer;o.entities.removeAll(),o.scene.primitives.removeAll(),o.destroy(),window.map=null}}function L(o,i,n){if(window.map){const e=window.map.viewer;let a;if(h.showRiverWater){a=new E.GUI;const t=a.addFolder("HDRBloom");t.add({show:e.postProcessStages.hdrBloom.enabled},"show").name("开启").onChange(function(s){e.scene.highDynamicRange=s,e.postProcessStages.hdrBloom.enabled=s}),t.add({bloomIntensity:1},"bloomIntensity",.01,20,.01).name("辉光强度").onChange(function(s){e.postProcessStages.hdrBloom.bloomIntensity=s}),t.add({bloomThreshold:0},"bloomThreshold",0,1,.01).name("辉光阈值").onChange(function(s){e.postProcessStages.hdrBloom.bloomThreshold=s}),t.add({bloomDirtTexIntensity:0},"bloomDirtTexIntensity",0,64,1).name("辉光衰减").onChange(function(s){e.postProcessStages.hdrBloom.bloomDirtTexIntensity=s}),t.addColor({bloomColor:"#fff"},"bloomColor").name("辉光颜色").onChange(function(s){e.postProcessStages.hdrBloom._bloomColor=r.Color.fromCssColorString(s)});const l=a.addFolder("Tonemapping");l.add({autoExposureEnabled:!1},"autoExposureEnabled").name("自动曝光").onChange(function(s){e.postProcessStages._autoExposureEnabled=s}),l.add({gamma:1},"gamma",.1,5,.1).name("伽马矫正").onChange(function(s){e.scene.gamma=s}),l.add({type:"ACES"},"type",["ACES","REINHARD","MODIFIED_REINHARD","FILMIC"]).name("颜色映射").onChange(function(s){e.postProcessStages.tonemapper=r.Tonemapper[s]})}_(h.juntun3DtilesUrl,()=>{h.showRiverWater&&T.addRiverWater(e,a)}),_(h.juntun3DtilesOsgb)}}function W(o,i,n){window.map&&window.map.viewer.camera.setView({destination:r.Cartesian3.fromDegrees(o,i,n),orientation:{heading:r.Math.toRadians(0),pitch:r.Math.toRadians(-30),roll:r.Math.toRadians(0)}})}function H(){window.map.viewer.camera.flyTo({destination:r.Cartesian3.fromDegrees(116.815837,39.727359,120),orientation:{heading:r.Math.toRadians(0),pitch:r.Math.toRadians(-30),roll:0},duration:3})}function _(o,i){if(window.map){const n=window.map.viewer;let e,a=new r.Cesium3DTileset({maximumMemoryUsage:512,maximumScreenSpaceError:32,useIndexDB:!1,skipLevelOfDetail:!1,skipLevels:1,workNum:0,subdomains:[],url:o});a.readyPromise.then(function(l){e=new r.TilesetFlat(n,{tileset:a,clipOutSide:!1}),e.addPolygon([r.Cartesian3.fromDegrees(116.814299,39.729787,0),r.Cartesian3.fromDegrees(116.816408,39.73059,0),r.Cartesian3.fromDegrees(116.81726,39.729337,0),r.Cartesian3.fromDegrees(116.815156,39.728396,0)],0)}),n.scene.primitives.add(a).readyPromise.then(function(l){typeof i=="function"&&i()})}}function B(o,i,n,e){if(window.map){const a=window.map.viewer;let t=r.Cartesian3.fromDegrees(o,i,n),l=r.Transforms.eastNorthUpToFixedFrame(t),s=r.Matrix3.fromRotationZ(r.Math.toRadians(89));r.Matrix4.multiplyByMatrix3(l,s,l);let u=a.scene.primitives.add(r.Model.fromGltf({url:e||g(O),modelMatrix:l,scale:1,show:!0}));return a.scene.globe.depthTestAgainstTerrain=!0,u.readyPromise.then(function(){S.ajax({url:g("/map/ids.json"),success:function(m){let f={};for(let p=0;p<m.length;p++)f[m[p]]=!0;let C=u._featureTables[0];for(let p=0;p<C._features.length;p++)C._features[p].getProperty("id")}})}),{model:u}}}function V(o,i,n){if(window.map){const e=window.map.viewer;let a={},t=[];for(let l=0;l<i.length;l++)a[i[l]]=!0;if(o._featureTables){let l=o._featureTables[0]._features;for(let s=0;s<l.length;s++){let u=l[s],m=u.getProperty("id"),f=u.color;f.alpha=1,a[m]?(m.includes("MRoom_IndoorLines_FF_lighting")?f=r.Color.fromCssColorString("#FFFF00"):m.includes("MRoom_IndoorLines_SF_lighting")?f=r.Color.fromCssColorString("#FF00FF"):m.includes("MRoom_IndoorLines_FF_receptacle")?f=r.Color.fromCssColorString("#00FFFF"):m.includes("MRoom_IndoorLines_SF_receptacle")?f=r.Color.fromCssColorString("#00FF00"):m.includes("MRoom_IndoorLines_WaterPipe")?f=r.Color.fromCssColorString("#0000FF"):m.includes("MRoom_IndoorLines_Drainpipe")&&(f=r.Color.fromCssColorString("#FF0000")),t.push(u.getBoundingSphere())):i.length&&(f.alpha=.1,f.blue=1,f.green=1,f.red=1),u.color=f}if(n)if(i.length){const s=new A.fromBoundingSpheres(t);e.camera.flyToBoundingSphere(s)}else H()}}}function q(o){window.map&&window.map.viewer.scene.primitives.remove(o)}function $(o){const i=window.map.viewer,n=r.Cartesian3.fromDegrees(o.lon,o.lat,1e3);i.camera.flyTo({destination:n,orientation:{heading:r.Math.toRadians(0),pitch:r.Math.toRadians(-90),roll:0},duration:5})}function Y(o,i){let n=r.Cartesian3.fromDegrees(o.lon,o.lat),e=window.map.viewer.entities.add({position:n,clickType:"entity",billboard:{image:o.img,width:36,height:63,verticalOrigin:r.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY},label:{text:o.text,style:r.LabelStyle.FILL_AND_OUTLINE,fillColor:r.Color.WHITE,font:"12pt monospace",show:!0,scale:1,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.TOP,pixelOffset:new r.Cartesian2(0,-70)}});new r.ScreenSpaceEventHandler(window.map.viewer.scene.canvas).setInputAction(function(t){let l=window.map.viewer.scene.pick(t.position);r.defined(l)&&l.id===e&&i(o)},r.ScreenSpaceEventType.LEFT_CLICK)}function K(o,i){o.forEach(n=>{window.map.viewer.entities.removeById(n)}),i()}function J(o,i,n){if(window.map){const e=window.map.viewer;let a=null;switch(o.deviceType){case"sxt":a=R;break;case"gnss":a=x;break;case"dzwl":a=P;break;case"zxsshenyaji":a=D;break;case"mcu":a=M;break}let t=e.entities.add({clickType:"marker",name:o.name,extra:o,position:r.Cartesian3.fromDegrees(o.lng,o.lat,10),billboard:{image:a,scale:.4,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY,pixelOffset:new r.Cartesian2(0,20)}});typeof n=="function"&&n(t),new r.ScreenSpaceEventHandler(e.scene.canvas).setInputAction(function(s){let u=e.scene.pick(s.position);r.defined(u)&&u.id===t&&typeof i=="function"&&i(o)},r.ScreenSpaceEventType.LEFT_CLICK)}}export{U as a,J as b,G as c,B as d,q as e,$ as f,Y as g,K as r,V as s};
