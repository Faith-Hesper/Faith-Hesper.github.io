import{t as T}from"./oneTitleCom-9adb7dea.js";import{_ as F,f as _,g as P,r as g,o as k,v as L,w as f,a as t,b as e,x as V,y as B,u as I,J as D,l as j,c as S,F as R,i as A,B as O,C as N,n as U,t as z}from"./index-267246aa.js";import{c as H,a as J}from"./cesium_init-99e2d9ae.js";import"./unit-ac192840.js";import"./jquery-ce9c138c.js";const Y={class:"period-box"},$={class:"main"},W={__name:"dialogAdd",props:{data:Object},emits:["closeDialog","subSheet"],setup(x,{emit:i}){let l=_(!0);const o=i,a=_({name:"",year:""});_([{value:"汛期检查表",label:"定期汛期检查记录表"}]);function u(){o("closeDialog")}const m=()=>{};return P(()=>{}),(w,n)=>{const d=g("el-input"),c=g("el-form-item"),r=g("el-date-picker"),y=g("el-form"),C=g("el-dialog");return k(),L(C,{title:"新建",top:"17%","modal-class":"sheet-dialog",width:"33%",modelValue:V(l),"onUpdate:modelValue":n[5]||(n[5]=s=>B(l)?l.value=s:l=s),onClose:u},{default:f(()=>[t("div",Y,[t("div",$,[e(y,{model:a.value,"label-position":"right"},{default:f(()=>[e(c,{label:"方案名称"},{default:f(()=>[e(d,{modelValue:a.value.name,"onUpdate:modelValue":n[0]||(n[0]=s=>a.value.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(c,{label:"水闸"},{default:f(()=>[e(d,{modelValue:a.value.name,"onUpdate:modelValue":n[1]||(n[1]=s=>a.value.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(c,{label:"水位"},{default:f(()=>[e(d,{modelValue:a.value.name,"onUpdate:modelValue":n[2]||(n[2]=s=>a.value.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(c,{label:"开度"},{default:f(()=>[e(d,{modelValue:a.value.name,"onUpdate:modelValue":n[3]||(n[3]=s=>a.value.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(c,{label:"预计开始时间"},{default:f(()=>[e(r,{modelValue:a.value.year,"onUpdate:modelValue":n[4]||(n[4]=s=>a.value.year=s),"value-format":"YYYY--MM-DD",placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("div",{class:"footer"},[t("div",{class:"reset-btn",onClick:u},"取消"),t("div",{class:"search-btn",onClick:m},"确定")])])]),_:1},8,["modelValue"])}}},G=F(W,[["__scopeId","data-v-8f9b75f3"]]);class q{constructor(i){this.viewer=i,this.cameraInfo={lng:116.77075872717633,lat:39.79543705623965,alt:40}}initFly(){this.viewer.camera.flyTo({destination:window.Cesium.Cartesian3.fromDegrees(this.cameraInfo.lng,this.cameraInfo.lat,this.cameraInfo.alt),orientation:{heading:window.Cesium.Math.toRadians(42.74),pitch:window.Cesium.Math.toRadians(-56.95),roll:0},complete:()=>{this.doFlyByLine()}})}doFlyByLine(){let i=5,l=0,o=[[116.77075872717633,39.79543705623965,40],[116.78067217169537,39.7837211672626,40],[116.78101549444928,39.77543850582461,40],[116.77964220343365,39.77221985500674,40],[116.7765522986485,39.770589071925684,40],[116.77597294150128,39.7692586962543,40],[116.78095112143292,39.767048556026026,40],[116.78095112143292,39.75953837078433,40],[116.78056488333478,39.75790758770327,40],[116.78035030661358,39.7561480585895,40],[116.78524265585675,39.74692125957827,40],[116.78459892569317,39.74477549236636,40],[116.78580055533185,39.74129934948306,40],[116.78803215323224,39.74018355053286,40],[116.79116497336163,39.73945398968081,40],[116.7934824019505,39.7376515452228,40],[116.79717312155499,39.73606367748599,40],[116.80000553427472,39.731900889094874,40],[116.80712948141827,39.72670813244204,40],[116.80863151846661,39.72692270916323,40],[116.8148971587254,39.72930451076846,40],[116.81577692328229,39.729626375850245,40],[116.81659231482281,39.72994824093203,40],[116.77075872717633,39.79543705623965,40]];this.stopLineFly();let a=o.map((r,y)=>new window.Cesium.Cartesian3.fromDegrees(r[0],r[1],l+r[2])),u=this.getSpaceDistance(a),m=window.Cesium.JulianDate.fromDate(new Date(2022,6,12,15)),w=u/i;var n=window.Cesium.JulianDate.addSeconds(m,w,new window.Cesium.JulianDate),d=new window.Cesium.SampledPositionProperty;this.viewer.clock.startTime=m.clone(),this.viewer.clock.stopTime=n.clone(),this.viewer.clock.currentTime=m.clone(),this.viewer.clock.clockRange=window.Cesium.ClockRange.LOOP_STOP,this.viewer.clock.multiplier=1;let c=null;a.forEach((r,y)=>{if(y==0)d.addSample(m,r),c=m.clone();else if(y==a.length-1)this.stopLineFly();else{let C=this.getSpaceDistance([r,a[y-1]])/u*w;c=window.Cesium.JulianDate.addSeconds(c,C,new window.Cesium.JulianDate),d.addSample(c,r)}}),this.lastFlyTime=c,this.flyEntity=this.viewer.entities.add({position:d,orientation:new window.Cesium.VelocityOrientationProperty(d),model:{uri:"data/fly/wurenji1c.glb",minimumPixelSize:100,maximumScale:200,runAnimations:!0},path:{leadTime:0,trailTime:30,resolution:1,material:new window.Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:window.Cesium.Color.YELLOW}),width:10}}),this.flyEntity_yezi=this.viewer.entities.add({position:d,orientation:new window.Cesium.VelocityOrientationProperty(d),model:{uri:"data/fly/wurenji_fengshan.glb",minimumPixelSize:100,maximumScale:200,runAnimations:!0}}),window.kjycObj=this,this.viewer.clock.onTick.addEventListener(this.trackModel),this.viewer.clock.shouldAnimate=!0}trackModel(){if(window.unlocked)return;let i=window.kjycObj;i.isRoaming=!0;let l=i.flyEntity.position.getValue(i.viewer.clock.currentTime);if(!l||!l.x){i.stopLineFly();return}let o=i.flyEntity.orientation.getValue(i.viewer.clock.currentTime),a=window.Cesium.Transforms.eastNorthUpToFixedFrame(l);a=window.Cesium.Matrix4.fromRotationTranslation(window.Cesium.Matrix3.fromQuaternion(o),l),i.viewer.camera.lookAtTransform(a,new window.Cesium.Cartesian3(-90,0,60))}stopLineFly(){this.isRoaming=!1,this.viewer.clock.shouldAnimate=!1,this.viewer.camera.lookAtTransform(window.Cesium.Matrix4.IDENTITY),this.flyEntity&&(this.viewer.entities.remove(this.flyEntity),this.flyEntity=null,this.viewer.entities.remove(this.flyEntity_yezi),this.flyEntity_yezi=null),this.viewer.clock.onTick.removeEventListener(this.trackModel)}getSpaceDistance(i){for(var l=0,o=0;o<i.length-1;o++){var a=window.Cesium.Cartographic.fromCartesian(i[o]),u=window.Cesium.Cartographic.fromCartesian(i[o+1]),m=new window.Cesium.EllipsoidGeodesic;m.setEndPoints(a,u);var w=m.surfaceDistance;w=Math.sqrt(Math.pow(w,2)+Math.pow(u.height-a.height,2)),l=l+w}return l.toFixed(2)}clear(){this.stopLineFly()}destroy(){this.clear()}}const K={class:"ap"},Q={class:"left-com"},X={class:"plan"},Z={class:"table"},ee=["onClick"],ae=["onClick"],te={class:"plan play"},ie={class:"table"},le={class:"water-manage"},ne=["onClick"],oe={__name:"floodManage",setup(x){const i=I(),l=_(null),o=_(null);_(null);const a=()=>{l.value=new q(window.map.viewer),l.value.initFly(),o.value=window.Cesium.ScreenSpaceEventHandler(window.map.viewer.scene.canvas)};let u=D([{id:1,name:"开3孔",water:"2",kai:"2"},{id:2,name:"开3孔",water:"2",kai:"2"},{id:3,name:"开3孔",water:"2",kai:"2"},{id:4,name:"开3孔",water:"2",kai:"2"},{id:5,name:"开3孔",water:"2",kai:"2"}]),m=D([{id:1,name:"水资源调度",name1:"2",name2:"2",name3:"2027.12.03",name4:"4星"},{id:2,name:"水资源调度",name1:"2",name2:"2",name3:"2027.12.03",name4:"4星"},{id:3,name:"水资源调度",name1:"2",name2:"2",name3:"2027.12.03",name4:"4星"},{id:4,name:"水资源调度",name1:"2",name2:"2",name3:"2027.12.03",name4:"4星"},{id:5,name:"水资源调度",name1:"2",name2:"2",name3:"2027.12.03",name4:"4星"}]);D({});function w(b){}let n=D([{type:1,name:"日常调度",active:!0},{type:2,name:"防洪调度",active:!1}]);function d(b){n.forEach(p=>{p.active=!1,p.type==b.type&&(p.active=!0)}),b.type==2&&i.push("/floodControl/floodWaterManage")}const c=_({}),r=_(!1),y=()=>{r.value=!0},C=()=>{r.value=!1};function s(){i.push("/floodControl/floodmonitor")}return P(()=>{document.getElementById("cesiumHomeBg").style.display="none",window.map||H("cesiumHome",116.815837,39.585159,1e4)}),j(()=>{document.getElementById("cesiumHomeBg").style.display="block",J(),o.value&&o.value.destroy()}),(b,p)=>{const v=g("el-table-column"),E=g("el-table");return k(),S("div",K,[t("div",Q,[e(T,{titleName:"调度方案管理"}),t("div",X,[t("div",{class:"add",onClick:y},"新建"),t("div",Z,[e(E,{data:V(u),height:"100%"},{default:f(()=>[e(v,{type:"index",label:"序号",align:"center"}),e(v,{prop:"name",label:"预案名称",align:"center"}),e(v,{prop:"water",label:"水位",align:"center"}),e(v,{prop:"kai",label:"开度",align:"center"}),e(v,{label:"操作",align:"center"},{default:f(h=>[t("span",{class:"oper-span oper-edit",onClick:M=>b.handleEdit(h.row)},"编辑",8,ee),t("span",{class:"oper-span oper-remove",onClick:M=>b.handleRemove(h.row)},"删除",8,ae)]),_:1})]),_:1},8,["data"])])]),e(T,{titleName:"调度方案预演"}),t("div",te,[t("div",{class:"add",onClick:y},"新建"),t("div",ie,[e(E,{data:V(m),height:"100%",onSelectionChange:w},{default:f(()=>[e(v,{type:"selection",align:"center"}),e(v,{prop:"name",label:"方案名称",align:"center"}),e(v,{prop:"name1",label:"水位",align:"center"}),e(v,{prop:"name2",label:"开度",align:"center"}),e(v,{prop:"name3",label:"预计开始",align:"center"}),e(v,{prop:"name4",label:"推优",align:"center"})]),_:1},8,["data"])]),t("div",{class:"sub",onClick:a},"执行")])]),t("div",le,[(k(!0),S(R,null,A(V(n),h=>(k(),S("div",{class:U(["manage",{active:h.active}]),key:h.type,onClick:M=>d(h)},z(h.name),11,ne))),128))]),p[2]||(p[2]=O('<div class="water-lljc" data-v-c079fdc1><div class="title" data-v-c079fdc1>流量监测</div><div class="water-lljc-content" data-v-c079fdc1><div class="river-gate" data-v-c079fdc1><div class="name" data-v-c079fdc1>胥各庄</div><div class="text" data-v-c079fdc1><div class="arrow" data-v-c079fdc1><div class="arrow-top" data-v-c079fdc1></div><div class="arrow-line" data-v-c079fdc1></div></div><span class="value" data-v-c079fdc1>3</span><span class="unit" data-v-c079fdc1>m³/s</span></div></div><div class="river-gate" data-v-c079fdc1><div class="name" data-v-c079fdc1>军屯拦河闸</div><div class="text" data-v-c079fdc1><div class="arrow" data-v-c079fdc1><div class="arrow-top" data-v-c079fdc1></div><div class="arrow-line" data-v-c079fdc1></div></div><span class="value" data-v-c079fdc1>3</span><span class="unit" data-v-c079fdc1>m³/s</span></div></div><div class="river-gate" data-v-c079fdc1><div class="name" data-v-c079fdc1>港沟河进水闸</div><div class="text down" data-v-c079fdc1><div class="arrow" data-v-c079fdc1><div class="arrow-top" data-v-c079fdc1></div><div class="arrow-line" data-v-c079fdc1></div></div><span class="value" data-v-c079fdc1>1</span><span class="unit" data-v-c079fdc1>m³/s</span></div></div><div class="river-gate" data-v-c079fdc1><div class="name" data-v-c079fdc1>军屯拦河闸</div><div class="text up" data-v-c079fdc1><div class="arrow" data-v-c079fdc1><div class="arrow-top" data-v-c079fdc1></div><div class="arrow-line" data-v-c079fdc1></div></div><span class="value" data-v-c079fdc1>1</span><span class="unit" data-v-c079fdc1>m³/s</span></div></div></div></div>',1)),t("div",{class:"bt-box"},[t("div",{class:"bt-type",onClick:s},p[0]||(p[0]=[t("div",{class:"bt-type-color"},[t("div",{class:"bt-type-bg"},"区域防洪监测预警")],-1)])),p[1]||(p[1]=t("div",{class:"bt-type active"},[t("div",{class:"bt-type-color"},[t("div",{class:"bt-type-bg"},"水资源调度")])],-1))]),r.value?(k(),L(G,{key:0,data:c.value,onCloseDialog:C},null,8,["data"])):N("",!0)])}}},ve=F(oe,[["__scopeId","data-v-c079fdc1"]]);export{ve as default};
