import{_ as K}from"./close_icon-79cdeb99.js";import{_ as Q,u as W,f as u,g as X,r as d,o as c,c as v,a as n,b as l,w as o,C as Y,A as E,F as C,i as w,v as T,x as ee}from"./index-267246aa.js";import{e as le,g as ae,f as te,h as oe}from"./engineeringAPI-b1b8a18c.js";import{d as se,s as ne}from"./unit-ac192840.js";import"./axios-da025460.js";const de={class:"daiban"},ue={class:"top"},ie={class:"search"},ce={class:"table"},re=["onClick"],pe={key:0,class:"add"},_e={class:"content"},ve={class:"main"},me=["src"],fe={__name:"daiban",setup(be){const x=W(),m=u(""),M=u([{label:"报修编号",prop:"code"},{label:"报修时间",prop:"reportDate"},{label:"报修设备",prop:"deviceIdZh"},{label:"故障情况",prop:"reportMemo"},{label:"联系人",prop:"contactsPersonZh"},{label:"当前节点",prop:"step"}]),Z=u([]),N=()=>{f({name:m.value})},A=()=>{m.value="",f()},F=a=>{ne("maintenanceData",JSON.stringify(a)),a.step.includes("审批")||a.step.includes("分配")||a.step.includes("驳回")?x.push("/engineering/maintenance/daibanDetail"):x.push({path:"/engineering/maintenance/repairDetail",query:{type:1}})},g=u(!1),s=u({deviceId:"",assetType:"",deviceType:"",contactsPerson:"",reportMemo:""}),O=()=>{g.value=!0},h=()=>{r=[],g.value=!1;for(let a in s.value)s.value[a]=""},y=u([]),D=u([]),L=a=>{a&&y.value.forEach(e=>{e.id===a&&(s.value.assetType=e.assetType,s.value.deviceType=e.deviceType,s.value.assetTypeZh=e.assetTypeZh,s.value.deviceTypeZh=e.deviceTypeZh)})},I=u(""),V=u(!1);let r=[];const j=a=>{r.push(a)},q=a=>{r=r.filter(e=>e.uid!=a.uid)},J=a=>{I.value=a.url,V.value=!0},R=()=>{const a=new FormData;if(r.length){r.forEach(i=>{a.append("files",i.raw)});const e=se(s.value);a.append("repairInfo",JSON.stringify(e)),oe(a).then(i=>{h(),f(),E({message:i.msg,type:"success"})})}else E({message:"请上传图片",type:"warning"})};X(()=>{f(),S()});const f=a=>{le(a||{}).then(e=>{console.log(e),Z.value=e.data})},S=()=>{ae({size:100}).then(a=>{y.value=a.data.list}),te().then(a=>{console.log(a),D.value=a.data.records})};return(a,e)=>{const i=d("el-input"),k=d("el-table-column"),z=d("el-table"),U=d("el-option"),P=d("el-select"),p=d("el-form-item"),_=d("el-col"),b=d("el-row"),H=d("el-upload"),$=d("el-form"),G=d("el-dialog");return c(),v("div",de,[n("div",ue,[n("div",ie,[e[7]||(e[7]=n("div",{class:"type"},"报修设备",-1)),l(i,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),class:"search-input",placeholder:"请输入"},null,8,["modelValue"]),n("div",{class:"search-btn",onClick:N},"查询"),n("div",{class:"reset-btn",onClick:A},"重置")]),n("div",{class:"reset-btn",onClick:O},"新建")]),n("div",ce,[l(z,{data:Z.value,height:"100%"},{default:o(()=>[l(k,{type:"index",width:"70",label:"序号",align:"center"}),(c(!0),v(C,null,w(M.value,(t,B)=>(c(),T(k,{key:B,prop:t.prop,label:t.label,align:"center","show-overflow-tooltip":""},null,8,["prop","label"]))),128)),l(k,{label:"操作",align:"center"},{default:o(t=>[n("span",{class:"oper-span oper-edit",onClick:B=>F(t.row)},"办理",8,re)]),_:1})]),_:1},8,["data"])]),g.value?(c(),v("div",pe,[n("div",_e,[n("div",{class:"header"},[e[8]||(e[8]=n("div",{class:"title"},"新增",-1)),n("img",{src:K,alt:"",class:"close",onClick:h})]),n("div",ve,[l($,{model:s.value,"label-width":"120px","label-position":"right"},{default:o(()=>[l(b,null,{default:o(()=>[l(_,{span:12},{default:o(()=>[l(p,{label:"设备名称："},{default:o(()=>[l(P,{modelValue:s.value.deviceId,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.deviceId=t),class:"com-select",onChange:L},{default:o(()=>[(c(!0),v(C,null,w(y.value,t=>(c(),T(U,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:o(()=>[l(p,{label:"资产类型："},{default:o(()=>[l(i,{modelValue:s.value.assetTypeZh,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.assetTypeZh=t),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(b,null,{default:o(()=>[l(_,{span:12},{default:o(()=>[l(p,{label:"设备设施类型："},{default:o(()=>[l(i,{modelValue:s.value.deviceTypeZh,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.deviceTypeZh=t),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{span:12},{default:o(()=>[l(p,{label:"联系人："},{default:o(()=>[l(P,{modelValue:s.value.contactsPerson,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.contactsPerson=t),class:"com-select"},{default:o(()=>[(c(!0),v(C,null,w(D.value,t=>(c(),T(U,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(b,null,{default:o(()=>[l(_,{span:24},{default:o(()=>[l(p,{label:"故障描述：",class:"flex-top"},{default:o(()=>[l(i,{modelValue:s.value.reportMemo,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.reportMemo=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(b,null,{default:o(()=>[l(_,{span:24},{default:o(()=>[l(p,{label:"故障照片："},{default:o(()=>[l(H,{action:"#","file-list":ee(r),"auto-upload":!1,accept:".png,.jpg,.jpeg","list-type":"picture-card","on-change":j,"on-remove":q,"on-preview":J},null,8,["file-list"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",{class:"footer"},[n("div",{class:"reset-btn",onClick:h},"取消"),n("div",{class:"search-btn",onClick:R},"确定")])])])):Y("",!0),l(G,{"modal-class":"no-header-bg",modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=t=>V.value=t)},{default:o(()=>[n("img",{"w-full":"",src:I.value,alt:"Preview Image"},null,8,me)]),_:1},8,["modelValue"])])}}},Ce=Q(fe,[["__scopeId","data-v-3bc216eb"]]);export{Ce as default};
