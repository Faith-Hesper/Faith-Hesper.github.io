import{_ as z}from"./title_child_icon-88388056.js";import{_ as G}from"./return_icon-1226930e.js";import{a as H,_ as K}from"./repair_title_icon-0ac87a57.js";import{_ as q,u as A,f as g,g as Q,r as c,x as s,o as n,c as u,a as t,b as d,w as v,F as N,i as U,v as F,C as f,J as T,n as J,A as S,t as W}from"./index-79e36b83.js";import{S as X}from"./SheetView-0970be84.js";import{F as Z}from"./FlowView-f4245c4d.js";import{R as ee}from"./RepairInfo-6315756b.js";import{b as te}from"./systemAPI-159b07b8.js";import{b as E,g as O}from"./unit-ac192840.js";import{n as ae,p as le}from"./engineeringAPI-21148e34.js";import"./axios-c0524c3b.js";const se={key:0,class:"right"},oe={class:"repair"},ne={class:"form-content"},re={key:0,class:"content-img"},ie=["src"],de=["src"],pe={__name:"RepairInfoFormData",setup(Y,{expose:D}){const e=A().currentRoute.value.query,o=JSON.parse(E("maintenanceData")),y=g(e.type!=1||o&&o.step==="维修验收"),r=g({status:o?o.step:"",repairerDate:O(),repairerId:o?o.repairerId:"",repairMemo:""});o&&y.value&&(r.value.repairtAttachments=o.repairtAttachments,r.value.repairerDate=O(o.repairerDate),r.value.repairMemo=o.repairMemo);const x=g([]),_=g(""),I=g(!1);let V=[];const w=p=>{V.push(p)},R=p=>{V=V.filter(a=>a.uid!=p.uid)},M=p=>{_.value=p.url,I.value=!0};return D({callback:()=>({formData:{...r.value},addFile:V})}),Q(()=>{te().then(p=>{x.value=p.data.records})}),(p,a)=>{const l=c("el-input"),b=c("el-form-item"),h=c("el-date-picker"),C=c("el-option"),k=c("el-select"),B=c("el-upload"),j=c("el-form"),L=c("el-dialog");return(s(o).step==="维修中"||s(o).step==="驳回")&&s(e).type==1||s(o).step==="维修验收"||s(o).step==="已完成"?(n(),u("div",se,[t("div",oe,[a[5]||(a[5]=t("div",{class:"title"},[t("img",{src:H,class:"repair-img"}),t("span",null,"维修信息")],-1)),t("div",ne,[d(j,{model:r.value,"label-width":"140px",disabled:y.value,"label-position":"right"},{default:v(()=>[d(b,{label:"维修状态："},{default:v(()=>[d(l,{modelValue:r.value.status,"onUpdate:modelValue":a[0]||(a[0]=i=>r.value.status=i),disabled:""},null,8,["modelValue"])]),_:1}),d(b,{label:"维修时间："},{default:v(()=>[d(h,{modelValue:r.value.repairerDate,"onUpdate:modelValue":a[1]||(a[1]=i=>r.value.repairerDate=i),disabled:"",type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),d(b,{label:"维修人员："},{default:v(()=>[d(k,{modelValue:r.value.repairerId,"onUpdate:modelValue":a[2]||(a[2]=i=>r.value.repairerId=i),disabled:"",class:"com-select"},{default:v(()=>[(n(!0),u(N,null,U(x.value,i=>(n(),F(C,{key:i.id,label:i.nickName,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),d(b,{label:"维修记录："},{default:v(()=>[d(l,{modelValue:r.value.repairMemo,"onUpdate:modelValue":a[3]||(a[3]=i=>r.value.repairMemo=i),type:"textarea",placeholder:y.value?"":"请输入"},null,8,["modelValue","placeholder"])]),_:1}),d(b,{label:"维修照片：",class:"label-img"},{default:v(()=>[y.value?(n(),u("div",re,[(n(!0),u(N,null,U(r.value.repairtAttachments,i=>(n(),u("img",{key:i,src:i,class:"img"},null,8,ie))),128))])):f("",!0),s(e).type==1&&s(o).step!=="维修验收"?(n(),F(B,{key:1,action:"#","file-list":s(V),"auto-upload":!1,accept:".png,.jpg,.jpeg","list-type":"picture-card","on-change":w,"on-remove":R,"on-preview":M},null,8,["file-list"])):f("",!0)]),_:1})]),_:1},8,["model","disabled"])])]),d(L,{"modal-class":"no-header-bg",top:"4%",modelValue:I.value,"onUpdate:modelValue":a[4]||(a[4]=i=>I.value=i)},{default:v(()=>[t("img",{"w-full":"",src:_.value,alt:"Preview Image"},null,8,de)]),_:1},8,["modelValue"])])):f("",!0)}}},P=q(pe,[["__scopeId","data-v-16120c80"]]);const ue={class:"detail"},ce={class:"tab"},me=["onClick"],_e={class:"body"},ve={class:"left"},fe={class:"broken"},ge={class:"form-content"},ye={key:2},be={key:1,class:"right"},he={class:"contents"},ke={key:1,class:"content"},De={class:"flow"},Ie={__name:"repairDetail",setup(Y){const D=A(),m=D.currentRoute.value.query,e=JSON.parse(E("maintenanceData"));console.log(e);const o=T({query:m});g(m.type!=1||e&&e.step==="维修验收");const y=g([{name:"表单",type:1,active:!0},{name:"流程",type:2,active:!1}]),r=a=>{y.value.forEach(l=>{l.active=!1,l.type===a.type&&(l.active=!0)})},x=g(null),_=g({});let I=[];const V=a=>{const l=x.value.callback();if(_.value=l.formData,I=l.addFile,e){a.id=e.id,a.deviceId=e.deviceId,_.value.id=e.id,_.value.deviceId=e.deviceId,_.value.taskId=e.taskId,_.value.code=e.code,_.value.flowId=e.flowId;const b={..._.value},h=new FormData;I.length?(I.forEach(C=>{h.append("files",C.raw)}),h.append("forminfo",JSON.stringify(a)),h.append("repair",JSON.stringify(b)),le(h).then(C=>{p(),S({message:C.msg,type:"success"})})):S({message:"请上传图片",type:"warning"})}},w=g({processMethod:null,repairerId:"",flowComment:"",approve:"",flowId:e.flowId,id:e.id}),R=()=>{$(!0)},M=()=>{$(!1)},$=a=>{w.value.approve=a,ae(w.value).then(l=>{p(),S({message:l.msg,type:"success"})})},p=()=>{m.type==1&&D.push("/engineering/maintenance/daiban"),m.type==2&&D.push("/engineering/maintenance/yiban"),m.type==3&&D.push("/engineering/maintenance/banjie"),m.type==4&&D.push("/engineering/maintenance/bohui")};return(a,l)=>{const b=c("el-input"),h=c("el-form-item"),C=c("el-form");return n(),u("div",ue,[t("header",null,[l[2]||(l[2]=t("div",{class:"left"},[t("img",{src:z,class:"img",alt:""}),t("div",{class:"text"},"设备故障办理")],-1)),t("div",{class:"right",onClick:p},l[1]||(l[1]=[t("img",{src:G,class:"img",alt:""},null,-1),t("div",{class:"text"},"返回",-1)]))]),t("div",ce,[(n(!0),u(N,null,U(y.value,k=>(n(),u("div",{class:J(["tab-item",{active:k.active}]),key:k.type,onClick:B=>r(k)},W(k.name),11,me))),128))]),t("div",_e,[y.value[0].active?(n(),u("div",{key:0,class:J(["content",{"none-sheet":!(s(e).step==="维修中"&&s(m).type==1||s(e).step==="已完成"),yanshou:s(e).step==="维修验收"}])},[t("div",ve,[t("div",fe,[l[3]||(l[3]=t("div",{class:"title"},[t("img",{src:K,class:"repair-img"}),t("span",null,"故障信息")],-1)),t("div",ge,[d(ee)])]),s(e).step==="维修验收"?(n(),F(P,{key:0})):f("",!0),s(e).step==="维修中"&&s(m).type==1||s(e).step==="维修验收"||s(e).step==="已完成"?(n(),F(X,{key:1,data:o,onSubCall:V},null,8,["data"])):f("",!0),s(e).step==="维修验收"?(n(),u("div",ye," ")):f("",!0)]),s(e).step!=="维修验收"?(n(),F(P,{key:0,ref_key:"RefRepairInfoFormData",ref:x},null,512)):f("",!0),s(e).step==="维修验收"&&s(m).type==1?(n(),u("div",be,[l[4]||(l[4]=t("div",{class:"titles"},"审批",-1)),t("div",he,[d(C,{model:w.value,"label-width":"140px","label-position":"right"},{default:v(()=>[d(h,{label:"审批意见："},{default:v(()=>[d(b,{modelValue:w.value.flowComment,"onUpdate:modelValue":l[0]||(l[0]=k=>w.value.flowComment=k),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t("div",{class:"footers"},[t("div",{class:"search-btn",onClick:R},"提交"),t("div",{class:"reset-btn",onClick:M},"驳回")])])])):f("",!0)],2)):f("",!0),y.value[1].active?(n(),u("div",ke,[t("div",De,[d(Z,{data:s(e)},null,8,["data"])])])):f("",!0)])])}}},Be=q(Ie,[["__scopeId","data-v-ce8ba103"]]);export{Be as default};
