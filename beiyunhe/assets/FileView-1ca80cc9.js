import{_ as Y,a as j}from"./del_two_icon-08a90535.js";import{_ as P}from"./edit_icon-d5e91246.js";import{_ as G}from"./close_icon-79cdeb99.js";import{d as W}from"./dialogRemoveCom-acb7236a.js";import{p as T}from"./pdfView-d7418e85.js";import{l as X,u as Z,c as $}from"./engineeringAPI-b1b8a18c.js";import{b as H}from"./unit-ac192840.js";import{_ as ee,u as le,f as o,g as ae,r as _,o as i,c as n,a,x as r,C as y,F as se,i as te,n as oe,t as N,b as u,w as g,v as ie,A as m,L as ne}from"./index-267246aa.js";const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAT5JREFUSEvtlr8uREEUxn9fIRqVRG1FIhJBPIA/jUJJ4Q30OqUlCp1IiNIzKDQiQqPSUJO7D6Gg+hhxk5sYuzMXm8ju1GfmN+ebc74zostLXebRo0Db88A+MAcMZsq+I2n3uz1fJLU9DdwBz8Al8JoIHAJWgQBs2l4LZ0i6qO6PAU+ADWBS0mMiDNsNoKgAW0BL0lIn4BUwLmk0FRbifgK8BhqSwo2TVx9YShUrmr6k0UL6d0UzAewBM8BAYm8Ep1mv0/ihaBYTIbGw0tqSnaYEbgFHwEsm3JJsOws4JWnEdpB0NhN4L+khF/hhbbab7za5nQnMlvQMWACGg6cCY5nAQlKRk+EmcAAcAsc13rC83y3wlDKeQhucA8uZmcXCbzoCP2db8NiVml+MKjjIe9p2AP9CVm2P6NFv4l/K+gaRiewdrYD/SwAAAABJRU5ErkJggg==";const ce={class:"device"},re={class:"left"},ue={key:0,class:"tool"},me={class:"lists"},pe={key:0,class:"list-box"},ve=["onClick"],fe={class:"label"},_e={key:1,class:"non-data"},ge={class:"right"},Ae={key:0,class:"add"},he={class:"content"},be={class:"header"},ke={class:"title"},we={class:"main"},Ie={__name:"FileView",props:{category:String},setup(B){const E=le().currentRoute.value.query,x=B;let D=o(E.type==="1"),A=JSON.parse(H("equipmentObject")).id,h=x.category,d=null,t=o({});const p=o([]),s=o({fileName:"",deviceId:A,group:h}),F=l=>{l.url=l.url.replace(window.config.fileServerInnerIp,""),t.value=l,p.value.forEach(e=>{e.checked=!1,e.id==l.id&&(e.checked=!0)})};let b=o(""),v=o(!1);const f=o(!1),S=o(null),U=()=>{b.value="新增",f.value=!0},V=()=>{s.value.fileName=t.value.name,s.value.dataId=t.value.id,b.value="编辑",f.value=!0},k=()=>{f.value=!1,s.value.fileName="",s.value.dataId=null,d=null},J=()=>{if(!s.value.fileName)m({message:"请输入文件名",type:"warning"});else if(!d)m({message:"请上传文件",type:"warning"});else if(d.name.split(".")[d.name.split(".").length-1].toLowerCase()!=="pdf")m({message:"请上传PDF文件",type:"warning"});else{const l=new FormData;s.value.dataId&&l.append("dataId",s.value.dataId),l.append("deviceId",s.value.deviceId),l.append("fileName",s.value.fileName),l.append("files",d.raw),l.append("group",s.value.group),Z(l).then(e=>{k(),I(),m({message:e.msg,type:"success"})})}},q=()=>{t.value.removeText=t.value.name,v.value=!0},L=()=>{v.value=!1},M=()=>{$({deviceId:A,fileId:t.value.id}).then(l=>{v.value=!1,I(),m({message:l.msg,type:"success"})})},w=o(null),z=l=>{w.value.clearFiles();const e=l[0];e.uid=ne(),w.value.handleStart(e)},Q=l=>{d=l};ae(()=>{I()});const I=()=>{X({category:h,deviceId:A}).then(l=>{if(l.data.forEach((e,C)=>{e.checked=!1,e.scale=1,C==0&&(e.checked=!0)}),p.value=l.data,l.data.length>0){let e=l.data[0];e.url=e.url.replace(window.config.fileServerInnerIp,""),t.value=e}})};return(l,e)=>{const C=_("el-input"),R=_("el-form-item"),K=_("el-upload"),O=_("el-form");return i(),n("div",ce,[a("div",re,[r(D)?(i(),n("div",ue,[a("div",{class:"oper",onClick:U},e[1]||(e[1]=[a("img",{src:Y,alt:"",class:"img"},null,-1),a("div",{class:"text"},"新增",-1)])),a("div",{class:"oper",onClick:V},e[2]||(e[2]=[a("img",{src:P,alt:"",class:"img"},null,-1),a("div",{class:"text"},"编辑",-1)])),a("div",{class:"oper",onClick:q},e[3]||(e[3]=[a("img",{src:j,alt:"",class:"img"},null,-1),a("div",{class:"text"},"删除",-1)]))])):y("",!0),a("div",me,[p.value.length?(i(),n("div",pe,[(i(!0),n(se,null,te(p.value,c=>(i(),n("div",{key:c.id,class:oe(["list",{checked:c.checked}]),onClick:ye=>F(c)},[e[4]||(e[4]=a("img",{src:de,alt:"",class:"file-img"},null,-1)),a("div",fe,N(c.name),1)],10,ve))),128))])):(i(),n("div",_e,N(r(h))+"暂无数据",1))])]),a("div",ge,[u(T,{data:r(t)},null,8,["data"])]),f.value?(i(),n("div",Ae,[a("div",he,[a("div",be,[a("div",ke,N(r(b)),1),a("img",{src:G,alt:"",class:"close",onClick:k})]),a("div",we,[u(O,{ref_key:"formRef",ref:S,model:s.value,"label-width":"120px","label-position":"right"},{default:g(()=>[u(R,{label:"文件名称："},{default:g(()=>[u(C,{modelValue:s.value.fileName,"onUpdate:modelValue":e[0]||(e[0]=c=>s.value.fileName=c),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),u(R,{label:"上传附件："},{default:g(()=>[u(K,{ref_key:"upload",ref:w,class:"upload-file",limit:1,accept:".pdf",multiple:!1,"on-exceed":z,"auto-upload":!1,"on-change":Q},{trigger:g(()=>e[5]||(e[5]=[a("div",{class:"btn"},"文件上传",-1)])),_:1},512)]),_:1})]),_:1},8,["model"])]),a("div",{class:"footer"},[a("div",{class:"reset-btn",onClick:k},"取消"),a("div",{class:"search-btn",onClick:J},"确定")])])])):y("",!0),r(v)?(i(),ie(W,{key:1,data:r(t),onCloseRemove:L,onSubRemove:M},null,8,["data"])):y("",!0)])}}},Ue=ee(Ie,[["__scopeId","data-v-c588a4ba"]]);export{Ue as F};
