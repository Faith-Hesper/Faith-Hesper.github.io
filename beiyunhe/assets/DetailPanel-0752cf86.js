import{_ as Q}from"./return_icon-1226930e.js";import{_ as V}from"./rightArr-ad89d80a.js";import{_ as X}from"./tb-7f100319.js";import{_ as Z,e as ee,u as te,f as d,J as T,g as se,l as oe,r as _,o as f,c as w,a as s,t as D,D as ae,b as c,w as v,x as p,B as le,v as L,C as ie,F as N,i as B}from"./index-79e36b83.js";import{D as ne}from"./DialogView-54d1109d.js";import{D as re}from"./DialyLog-8a8c11ac.js";import{D as ce}from"./dialogDynamotorSheet-8ff66ceb.js";import{c as ue,a as me}from"./cesium_init-31e3514b.js";import{i as de}from"./patrolGuard-413be18c.js";import{c as fe}from"./securityManagementAPI-a9030ac0.js";import{E as pe}from"./engineeringAPI-21148e34.js";import"./axios-c0524c3b.js";import"./unit-ac192840.js";import"./jquery-bb5cacf4.js";import"./index-b0dc9d9c.js";const _e={class:"detail"},ve={class:"row"},ge={class:"form"},we={class:"text"},ye={class:"form"},ke={class:"text"},De={class:"form"},be={class:"bt"},he={class:"fill"},Ce={class:"left"},Te={class:"middle"},Se={key:0,class:"img-list"},xe=["src"],Ie={key:1,class:"img-list"},Pe={class:"right"},Ve={class:"text"},Le={__name:"DetailPanel",setup(Ne){let l=null;const S=ee(),R=te(),b=d(!1),x=d({}),F=d(),y=d([]),h=d(0),k=d(!1),J=d();let C=T({});const I=d([]),n=T({name:"巡查任务",userName:"王一博",status:"",back:"finishInspect"});let o=T({areas:"",formId:"",formType:"",card:"",point:"",pictures:"",status:0,mark:""});function E(){R.push(`/patrolGuard/${n.back}/view`)}function O(t){h.value=t,y.value[t].finish=!0;const e=I.value[t];P(e),console.log(t,o,e)}function M(){if(o.formType=="")return"发电机检查运行记录";if(o.formType==="0")return"日常检查运行记录";if(o.formType==="1")return"发电机检查运行记录"}function U(){if(o.formType==""){k.value=!0;return}o.formType==="0"&&q(),o.formType==="1"&&z()}async function q(){const{code:t,data:e}=await fe({id:o.formId});t===1&&(x.value=e,b.value=!0)}async function z(){const{code:t,data:e}=await pe({date:""});t===1&&(C=e.filter(a=>a.id===o.formId)[0],console.log(e,C),k.value=!0)}const A=()=>{k.value=!1};function G(t){if(h.value<=t.value-1)return"process";if(t.finish)return"finish"}function W(t){return t.map((a,r)=>({label:a.point,value:r,finish:!1}))}function P(t){o.status=String(t.eqStatus),o.mark=t.mark,o.formId=t.formId,o.formType=t.formType,t.pictures===""?o.pictures=[]:o.pictures=t.pictures.split(","),console.log(o.pictures.length)}async function $(){try{const{code:t,data:e}=await de({taskId:n.formId});if(t===1){I.value=e,y.value=W(e),y.value[0].finish=!0;const a=e[0];P(a)}}catch(t){console.log(t)}}function j(t=10){const e=[[116.81492214244265,39.7279226875299],[116.81472474725173,39.728212294702104],[116.81482287886054,39.728591424392796],[116.8147737597498,39.72883130570769],[116.81518448146079,39.729047021170594],[116.81543192077194,39.729148456587104],[116.81562929729772,39.72902283010447],[116.81584371961888,39.72878324919791],[116.81613928988534,39.72855581480517],[116.81600808977451,39.728227617368866],[116.81577763137093,39.728518162355236],[116.81558023106119,39.72883276484531],[116.81523469978731,39.72802424005509]];l.entities.add({polyline:{positions:window.Cesium.Cartesian3.fromDegreesArray(e.flat()),width:5,material:new window.Cesium.PolylineGlowMaterialProperty({glowPower:.2,color:window.Cesium.Color.YELLOW})}});const a=l.entities.add({position:new window.Cesium.CallbackProperty(r=>{const m=window.Cesium.JulianDate.secondsDifference(r,l.clock.startTime)%t/t,u=Y(e,m);return window.Cesium.Cartesian3.fromDegrees(u[0],u[1],8)},!1),model:{uri:"/running.glb",minimumPixelSize:64}});l.clock.startTime=window.Cesium.JulianDate.fromDate(new Date),l.clock.stopTime=window.Cesium.JulianDate.addSeconds(l.clock.startTime,t,new window.Cesium.JulianDate),l.clock.currentTime=l.clock.startTime.clone(),l.clock.multiplier=1,l.clock.clockRange=window.Cesium.ClockRange.LOOP_STOP,l.clock.shouldAnimate=!0,l.trackedEntity=a}function Y(t,e){const a=t.length-1,r=Math.floor(e*a),g=e*a%1,m=t[r],u=t[Math.min(r+1,t.length-1)];return[m[0]+(u[0]-m[0])*g,m[1]+(u[1]-m[1])*g]}return se(()=>{var t,e;window.map||(l=ue("model_map",116.815837,39.729159,250).viewer,l.camera.setView({destination:window.Cesium.Cartesian3.fromDegrees(116.815837,39.729159,280),orientation:{heading:6.28,pitch:-.52,roll:6.28}}),n.status&&j(60));try{n.back=((t=S.query)==null?void 0:t.back)??"finishInspect",n.formId=(e=S.query)==null?void 0:e.id;const a=localStorage.getItem("inspectData"),r=JSON.parse(a);n.name=r.name,n.userName=r.userName,n.status=r.status}catch(a){console.log(a)}$()}),oe(()=>{me()}),(t,e)=>{const a=_("el-step"),r=_("el-steps"),g=_("el-radio"),m=_("el-radio-group"),u=_("el-form-item"),H=_("el-input"),K=_("el-form");return f(),w("div",_e,[s("div",{class:"header"},[e[4]||(e[4]=s("div",{class:"img"},null,-1)),e[5]||(e[5]=s("span",{class:"title"},"办理",-1)),s("div",{class:"plan",onClick:E},e[3]||(e[3]=[s("img",{src:Q,alt:""},null,-1),s("span",{class:"text"},"返回",-1)]))]),s("div",ve,[s("div",ge,[e[6]||(e[6]=s("label",{for:""},"任务名称",-1)),s("span",we,D(n.name),1)]),s("div",ye,[e[7]||(e[7]=s("label",{for:""},"巡查人员",-1)),s("span",ke,D(n.userName),1)]),s("div",De,[e[8]||(e[8]=s("label",{for:""},"任务状态",-1)),s("span",{class:"text",style:ae({color:n.status?"#29FF64":"#FBE218"})},D(n.status?"已巡查":"待巡查"),5)])]),s("div",be,[e[11]||(e[11]=s("div",{class:"tip"},[s("img",{src:V,alt:"",srcset:""}),s("span",{class:"title"},"巡查点位")],-1)),s("div",he,[s("div",Ce,[c(r,{class:"custom-steps",direction:"vertical",active:h.value},{default:v(()=>[(f(!0),w(N,null,B(y.value,i=>(f(),L(a,{onClick:Be=>O(i.value),status:G(i),title:i.label,key:i.label},null,8,["onClick","status","title"]))),128))]),_:1},8,["active"])]),s("div",Te,[c(K,{class:"custom-form",ref_key:"formRef",ref:J,model:p(o),"label-width":"150px","label-position":"right"},{default:v(()=>[c(u,{label:"设备设施状态",prop:"status"},{default:v(()=>[c(m,{class:"radio-select",modelValue:p(o).status,"onUpdate:modelValue":e[0]||(e[0]=i=>p(o).status=i),disabled:""},{default:v(()=>[c(g,{label:"正常",value:"1"}),c(g,{label:"不正常",value:"0"})]),_:1},8,["modelValue"])]),_:1}),c(u,{label:"照片",prop:"pictures"},{default:v(()=>[p(o).pictures.length?(f(),w("div",Se,[(f(!0),w(N,null,B(p(o).pictures,i=>(f(),w("img",{key:i,src:i,alt:"",srcset:""},null,8,xe))),128))])):(f(),w("div",Ie,e[9]||(e[9]=[s("div",{class:"empty-img"},null,-1)])))]),_:1}),c(u,{label:"描述",prop:"mark"},{default:v(()=>[c(H,{class:"custom-input",readonly:"",modelValue:p(o).mark,"onUpdate:modelValue":e[1]||(e[1]=i=>p(o).mark=i),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),s("div",Pe,[s("div",{class:"btn",onClick:U},[e[10]||(e[10]=s("img",{src:X,alt:""},null,-1)),s("span",Ve,D(M()),1)])])]),e[12]||(e[12]=le('<div class="tip" data-v-ff0ed63a><img src="'+V+'" alt="" srcset="" data-v-ff0ed63a><span class="title" data-v-ff0ed63a>巡查路线</span></div><div class="route" data-v-ff0ed63a><div id="model_map" class="model_map" data-v-ff0ed63a></div></div>',2))]),c(ne,{width:"70%",visible:b.value,title:"记录表","onUpdate:visible":e[2]||(e[2]=i=>b.value=i),footer:null},{default:v(()=>[c(re,{ref_key:"sheetTabe",ref:F,data:x.value},null,8,["data"])]),_:1},8,["visible"]),k.value?(f(),L(ce,{key:0,footer:null,data:p(C),onCloseSheet:A},null,8,["data"])):ie("",!0)])}}},He=Z(Le,[["__scopeId","data-v-ff0ed63a"]]);export{He as default};
