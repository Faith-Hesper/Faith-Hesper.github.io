import{_ as V}from"./return_icon-1226930e.js";import{_ as B}from"./rightArr-ad89d80a.js";import{_ as L,f as r,e as S,u as j,J as E,g as J,r as _,o as M,c as T,a as t,t as b,b as p,w as g,x as m,A}from"./index-79e36b83.js";import{j as N}from"./patrolGuard-413be18c.js";import{g as G,a as O,b as $}from"./atentionAPI-c7a0c66e.js";import"./axios-c0524c3b.js";import"./index-b0dc9d9c.js";const z={class:"detail"},H={class:"row"},K={class:"form"},Q={class:"text"},W={class:"form"},X={class:"text"},Y={class:"form"},Z={class:"text"},ee={class:"bt"},te={class:"img-list"},se={class:"img-list"},ae={__name:"DetailPanel",setup(le){const k=r(),y=r("atentionTask"),D=S(),w=j();r("");const i=E({name:"巡查任务",userName:"王一博",status:"",back:"finishInspect"}),x=r();let l=r({qpictures:[],hpictures:[],mark:""});r([]);const v=r(!1);function U(){w.push(`/patrolGuard/${y.value}`)}let d=r([]),f=r([]);async function R(){try{const{code:s,data:e}=await G({taskId:k.value});if(s===1){if(!e){v.value=!1;return}l.value.mark=e.mark,l.value.qpictures=h(e==null?void 0:e.qpictures),d.value=l.value.qpictures,l.value.hpictures=h(e==null?void 0:e.hpictures),f.value=l.value.hpictures,v.value=!0}}catch(s){console.log(s)}}const C=async(s,e)=>{console.log(s,e);const a=new FormData;a.append("file",s.file);const{code:o,data:u}=await N(a),c=d.value.length,n=c?c-1:0;return o===1?d.value[n]={name:u.fileName,url:u.fileUrl}:d.value.slice(n+1),!0},I=async(s,e)=>{console.log(s,e);const a=new FormData;a.append("file",s.file);const{code:o,data:u}=await N(a),c=f.value.length,n=c?c-1:0;return o===1?f.value[n]={name:u.fileName,url:u.fileUrl}:f.value.slice(n+1),!0};function F(){x.value.resetFields()}function h(s){return!s||s==""?[]:s.split(",").map(e=>({name:e,url:e}))}function q(s){return s.value.map(a=>a.url).join(",")}async function P(){console.log(l.value,d);const s={taskId:k.value,mark:l.value.mark,qpictures:q(d),hpictures:q(f)};let e=v.value?O:$;const{code:a,data:o}=await e(s);a===1&&(v.value=!0,A({message:"完成养护",type:"success"}),console.log(o))}return J(()=>{var a,o;const s=localStorage.getItem("tableData"),e=JSON.parse(s);i.name=e.name,i.userName=e.userName,i.content=e.content,i.status=e.status,k.value=((a=D.query)==null?void 0:a.id)??"0",y.value=((o=D.query)==null?void 0:o.back)??"atentionTask",R()}),(s,e)=>{const a=_("el-upload"),o=_("el-form-item"),u=_("el-input"),c=_("el-form");return M(),T("div",z,[t("div",{class:"header"},[e[4]||(e[4]=t("div",{class:"img"},null,-1)),e[5]||(e[5]=t("span",{class:"title"},"养护详情",-1)),t("div",{class:"plan",onClick:U},e[3]||(e[3]=[t("img",{src:V,alt:""},null,-1),t("span",{class:"text"},"返回",-1)]))]),t("div",H,[t("div",K,[e[6]||(e[6]=t("label",{for:""},"任务名称",-1)),t("span",Q,b(i.name),1)]),t("div",W,[e[7]||(e[7]=t("label",{for:""},"养护人员",-1)),t("span",X,b(i.userName),1)]),t("div",Y,[e[8]||(e[8]=t("label",{for:""},"养护设备",-1)),t("span",Z,b(i.content),1)])]),t("div",ee,[e[9]||(e[9]=t("div",{class:"tip"},[t("img",{src:B,alt:"",srcset:""}),t("span",{class:"title"},"养护记录")],-1)),p(c,{class:"custom-form",ref_key:"formRef",ref:x,model:m(l),"label-width":"150px","label-position":"right"},{default:g(()=>[p(o,{label:"养护前照片",prop:"qpictures"},{default:g(()=>[t("div",te,[p(a,{class:"avatar-uploader",accept:"image/*","auto-upload":"false",action:"","file-list":m(l).qpictures,"onUpdate:fileList":e[0]||(e[0]=n=>m(l).qpictures=n),"list-type":"picture-card","http-request":C},null,8,["file-list"])])]),_:1}),p(o,{label:"养护后照片",prop:"hpictures"},{default:g(()=>[t("div",se,[p(a,{class:"avatar-uploader",accept:"image/*","auto-upload":"false",action:"","file-list":m(l).hpictures,"onUpdate:fileList":e[1]||(e[1]=n=>m(l).hpictures=n),"list-type":"picture-card","http-request":I},null,8,["file-list"])])]),_:1}),p(o,{label:"养护描述",prop:"mark"},{default:g(()=>[p(u,{class:"custom-input",modelValue:m(l).mark,"onUpdate:modelValue":e[2]||(e[2]=n=>m(l).mark=n),type:"textarea"},null,8,["modelValue"])]),_:1}),t("div",{class:"footer"},[t("div",{class:"reset-btn",onClick:F},"取消"),t("div",{class:"search-btn",onClick:P},"确定")])]),_:1},8,["model"])])])}}},me=L(ae,[["__scopeId","data-v-3a61c7a5"]]);export{me as default};
